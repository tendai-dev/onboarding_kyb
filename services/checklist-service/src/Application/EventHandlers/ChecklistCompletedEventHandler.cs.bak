// Temporarily commented out due to missing dependencies
// TODO: Add Confluent.Kafka and Microsoft.Extensions.Configuration.Abstractions to Application project
/*
using ChecklistService.Domain.Events;
using Confluent.Kafka;
using MediatR;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;
using System.Text.Json;

namespace ChecklistService.Application.EventHandlers;

public class ChecklistCompletedEventHandler : INotificationHandler<ChecklistCompletedEvent>
{
    private readonly ILogger<ChecklistCompletedEventHandler> _logger;
    private readonly IConfiguration _configuration;

    public ChecklistCompletedEventHandler(ILogger<ChecklistCompletedEventHandler> logger, IConfiguration configuration)
    {
        _logger = logger;
        _configuration = configuration;
    }

    public async Task Handle(ChecklistCompletedEvent notification, CancellationToken cancellationToken)
    {
        var bootstrap = _configuration["Kafka:BootstrapServers"] ?? "localhost:9092";
        var topic = _configuration["Kafka:ChecklistTopic"] ?? "kyc.checklist.events";

        var config = new ProducerConfig
        {
            BootstrapServers = bootstrap,
            Acks = Acks.All,
            EnableIdempotence = true
        };

        using var producer = new ProducerBuilder<string, string>(config).Build();

        var payload = new
        {
            eventType = "ChecklistCompleted",
            notification.ChecklistId,
            notification.CaseId,
            notification.TotalScore,
            completedAt = notification.CompletedAt
        };

        var message = new Message<string, string>
        {
            Key = notification.ChecklistId.ToString(),
            Value = JsonSerializer.Serialize(payload)
        };

        var result = await producer.ProduceAsync(topic, message, cancellationToken);
        _logger.LogInformation("Published ChecklistCompleted to {Topic} @ {Partition}/{Offset}", topic, result.Partition.Value, result.Offset.Value);
    }
}
*/


