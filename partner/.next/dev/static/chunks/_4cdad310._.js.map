{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/mukurusystemsadministrator/Desktop/onboarding_kyc%20copy/partner/src/app/auth/login/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useSearchParams } from \"next/navigation\";\nimport { Box, Spinner, Text, VStack, Alert, AlertTitle, AlertDescription, Button, Icon } from \"@chakra-ui/react\";\nimport { FiAlertCircle } from \"react-icons/fi\";\nimport { signIn, useSession } from \"next-auth/react\";\nimport { useRouter } from \"next/navigation\";\n\nexport default function LoginPage() {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const { data: session, status } = useSession();\n  const [isRedirecting, setIsRedirecting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  // Check for OAuth errors in URL\n  const oauthError = searchParams.get('error');\n  const errorDescription = searchParams.get('error_description');\n\n  useEffect(() => {\n    // If there's an OAuth error, show it\n    if (oauthError) {\n      setError(\n        errorDescription \n          ? decodeURIComponent(errorDescription)\n          : `Authentication error: ${oauthError}. Please check your Keycloak configuration.`\n      );\n      return;\n    }\n\n    // If already authenticated, redirect to dashboard\n    if (status === \"authenticated\" && session) {\n      router.replace(\"/partner/dashboard\");\n      return;\n    }\n\n    // If not authenticated and not already redirecting, start sign-in\n    // Only try once - don't loop\n    if (status === \"unauthenticated\" && !isRedirecting && !oauthError) {\n      setIsRedirecting(true);\n      signIn(\"keycloak\", { \n        callbackUrl: \"/partner/dashboard\",\n        redirect: true // Let NextAuth handle the redirect\n      }).catch((error) => {\n        console.error('Failed to start sign-in:', error);\n        setError('Failed to start authentication. Please check your configuration.');\n        setIsRedirecting(false);\n      });\n    }\n  }, [status, session, router, isRedirecting, oauthError, errorDescription]);\n\n  // Show error if present\n  if (error) {\n    return (\n      <Box minH=\"100vh\" display=\"flex\" alignItems=\"center\" justifyContent=\"center\" p={4}>\n        <VStack gap={4} maxW=\"md\" w=\"100%\">\n          <Alert.Root status=\"error\" borderRadius=\"lg\">\n            <Alert.Indicator>\n              <Icon as={FiAlertCircle} />\n            </Alert.Indicator>\n            <Alert.Content>\n              <Alert.Title>Authentication Error</Alert.Title>\n              <Alert.Description>{error}</Alert.Description>\n            </Alert.Content>\n          </Alert.Root>\n          <VStack align=\"start\" gap={2} fontSize=\"sm\" color=\"gray.500\">\n            <Text fontWeight=\"semibold\">Common issues:</Text>\n            <Text>â€¢ Missing NEXTAUTH_SECRET environment variable</Text>\n            <Text>â€¢ Incorrect NEXTAUTH_URL (should be http://localhost:3000)</Text>\n            <VStack align=\"start\" gap={1} ml={4}>\n              <Text>â€¢ Keycloak redirect URI mismatch - ensure this EXACT URI is registered in Keycloak:</Text>\n              <Box bg=\"gray.100\" p={2} borderRadius=\"md\" fontFamily=\"mono\" fontSize=\"xs\">\n                http://localhost:3000/api/auth/callback/keycloak\n              </Box>\n              <Text fontSize=\"xs\" color=\"gray.400\" mt={1}>\n                In Keycloak: Clients â†’ kyb-connect-portal â†’ Settings â†’ Valid Redirect URIs\n              </Text>\n            </VStack>\n            <Text>â€¢ Keycloak client secret incorrect (if using confidential client)</Text>\n            <Text>â€¢ Keycloak client Access Type mismatch (public vs confidential)</Text>\n            <Text>â€¢ Redis not running</Text>\n            <Text mt={2} fontSize=\"xs\" color=\"blue.400\">\n              ðŸ’¡ Check server console logs for detailed error messages\n            </Text>\n          </VStack>\n          <Button \n            onClick={() => {\n              setError(null);\n              setIsRedirecting(false);\n              router.push('/auth/login');\n            }}\n          >\n            Try Again\n          </Button>\n        </VStack>\n      </Box>\n    );\n  }\n\n  return (\n    <Box minH=\"100vh\" display=\"flex\" alignItems=\"center\" justifyContent=\"center\">\n      <VStack gap={4}>\n        <Spinner size=\"xl\" />\n        <Text>\n          {status === \"loading\" \n            ? \"Checking authentication...\" \n            : isRedirecting \n            ? \"Redirecting to sign in...\" \n            : \"Please wait...\"}\n        </Text>\n      </VStack>\n    </Box>\n  );\n}\n\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;;AANA;;;;;;;AASe,SAAS;;IACtB,MAAM,SAAS,IAAA,kJAAS;IACxB,MAAM,eAAe,IAAA,wJAAe;IACpC,MAAM,EAAE,MAAM,OAAO,EAAE,MAAM,EAAE,GAAG,IAAA,+JAAU;IAC5C,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC;IACnD,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAgB;IAElD,gCAAgC;IAChC,MAAM,aAAa,aAAa,GAAG,CAAC;IACpC,MAAM,mBAAmB,aAAa,GAAG,CAAC;IAE1C,IAAA,0KAAS;+BAAC;YACR,qCAAqC;YACrC,IAAI,YAAY;gBACd,SACE,mBACI,mBAAmB,oBACnB,CAAC,sBAAsB,EAAE,WAAW,2CAA2C,CAAC;gBAEtF;YACF;YAEA,kDAAkD;YAClD,IAAI,WAAW,mBAAmB,SAAS;gBACzC,OAAO,OAAO,CAAC;gBACf;YACF;YAEA,kEAAkE;YAClE,6BAA6B;YAC7B,IAAI,WAAW,qBAAqB,CAAC,iBAAiB,CAAC,YAAY;gBACjE,iBAAiB;gBACjB,IAAA,2JAAM,EAAC,YAAY;oBACjB,aAAa;oBACb,UAAU,KAAK,mCAAmC;gBACpD,GAAG,KAAK;2CAAC,CAAC;wBACR,QAAQ,KAAK,CAAC,4BAA4B;wBAC1C,SAAS;wBACT,iBAAiB;oBACnB;;YACF;QACF;8BAAG;QAAC;QAAQ;QAAS;QAAQ;QAAe;QAAY;KAAiB;IAEzE,wBAAwB;IACxB,IAAI,OAAO;QACT,qBACE,6LAAC,8LAAG;YAAC,MAAK;YAAQ,SAAQ;YAAO,YAAW;YAAS,gBAAe;YAAS,GAAG;sBAC9E,cAAA,6LAAC,wMAAM;gBAAC,KAAK;gBAAG,MAAK;gBAAK,GAAE;;kCAC1B,6LAAC,uOAAK,CAAC,IAAI;wBAAC,QAAO;wBAAQ,cAAa;;0CACtC,6LAAC,uOAAK,CAAC,SAAS;0CACd,cAAA,6LAAC,+LAAI;oCAAC,IAAI,kKAAa;;;;;;;;;;;0CAEzB,6LAAC,uOAAK,CAAC,OAAO;;kDACZ,6LAAC,uOAAK,CAAC,KAAK;kDAAC;;;;;;kDACb,6LAAC,uOAAK,CAAC,WAAW;kDAAE;;;;;;;;;;;;;;;;;;kCAGxB,6LAAC,wMAAM;wBAAC,OAAM;wBAAQ,KAAK;wBAAG,UAAS;wBAAK,OAAM;;0CAChD,6LAAC,gMAAI;gCAAC,YAAW;0CAAW;;;;;;0CAC5B,6LAAC,gMAAI;0CAAC;;;;;;0CACN,6LAAC,gMAAI;0CAAC;;;;;;0CACN,6LAAC,wMAAM;gCAAC,OAAM;gCAAQ,KAAK;gCAAG,IAAI;;kDAChC,6LAAC,gMAAI;kDAAC;;;;;;kDACN,6LAAC,8LAAG;wCAAC,IAAG;wCAAW,GAAG;wCAAG,cAAa;wCAAK,YAAW;wCAAO,UAAS;kDAAK;;;;;;kDAG3E,6LAAC,gMAAI;wCAAC,UAAS;wCAAK,OAAM;wCAAW,IAAI;kDAAG;;;;;;;;;;;;0CAI9C,6LAAC,gMAAI;0CAAC;;;;;;0CACN,6LAAC,gMAAI;0CAAC;;;;;;0CACN,6LAAC,gMAAI;0CAAC;;;;;;0CACN,6LAAC,gMAAI;gCAAC,IAAI;gCAAG,UAAS;gCAAK,OAAM;0CAAW;;;;;;;;;;;;kCAI9C,6LAAC,qMAAM;wBACL,SAAS;4BACP,SAAS;4BACT,iBAAiB;4BACjB,OAAO,IAAI,CAAC;wBACd;kCACD;;;;;;;;;;;;;;;;;IAMT;IAEA,qBACE,6LAAC,8LAAG;QAAC,MAAK;QAAQ,SAAQ;QAAO,YAAW;QAAS,gBAAe;kBAClE,cAAA,6LAAC,wMAAM;YAAC,KAAK;;8BACX,6LAAC,wMAAO;oBAAC,MAAK;;;;;;8BACd,6LAAC,gMAAI;8BACF,WAAW,YACR,+BACA,gBACA,8BACA;;;;;;;;;;;;;;;;;AAKd;GAzGwB;;QACP,kJAAS;QACH,wJAAe;QACF,+JAAU;;;KAHtB"}},
    {"offset": {"line": 312, "column": 0}, "map": {"version":3,"sources":["file:///Users/mukurusystemsadministrator/Desktop/onboarding_kyc%20copy/partner/node_modules/next/navigation.js"],"sourcesContent":["module.exports = require('./dist/client/components/navigation')\n"],"names":[],"mappings":"AAAA,OAAO,OAAO","ignoreList":[0]}}]
}