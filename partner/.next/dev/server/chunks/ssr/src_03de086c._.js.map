{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/mukurusystemsadministrator/Desktop/onboarding_kyc%20copy/partner/src/lib/auth/session.ts"],"sourcesContent":["// SECURITY: Tokens are now stored server-side in Redis via NextAuth\n// This file provides compatibility functions that use NextAuth session instead of localStorage\n// All token access is handled server-side by the API proxy\n\nimport { signOut } from \"next-auth/react\";\n\nexport type AuthUser = {\n  sub?: string;\n  name: string;\n  email?: string;\n  givenName?: string;\n  familyName?: string;\n};\n\n/**\n * Check if user is authenticated using NextAuth session\n * Note: This is a synchronous check that may not be accurate during initial load\n * For accurate checks, use useSession() hook in React components\n */\nexport function isAuthenticated(): boolean {\n  if (typeof window === 'undefined') return false;\n  \n  // Check if session cookie exists (basic check)\n  // For accurate authentication status, use useSession() hook\n  const cookies = document.cookie.split(';');\n  const hasSessionCookie = cookies.some(cookie => \n    cookie.trim().startsWith('next-auth.session-token=') || \n    cookie.trim().startsWith('__Secure-next-auth.session-token=')\n  );\n  \n  return hasSessionCookie;\n}\n\n/**\n * SECURITY: Tokens are stored server-side in Redis\n * This function returns null - tokens should never be accessed from the frontend\n * The API proxy automatically injects tokens from Redis based on the session cookie\n */\nexport async function getAccessToken(): Promise<string | null> {\n  // SECURITY: Do not return tokens from frontend\n  // Tokens are stored server-side in Redis and injected by the proxy\n  console.warn('[SECURITY] getAccessToken() called - tokens are server-side only. Use API proxy instead.');\n  return null;\n}\n\n/**\n * SECURITY: Token refresh is handled server-side by NextAuth\n * This function is deprecated - NextAuth handles token refresh automatically\n */\nexport async function refreshToken(): Promise<boolean> {\n  // Token refresh is handled server-side by NextAuth\n  // No action needed from frontend\n  console.warn('[SECURITY] refreshToken() called - token refresh is handled server-side by NextAuth');\n  return false;\n}\n\n/**\n * Get authenticated user from NextAuth session\n * Note: This is a synchronous function that may not have accurate data during initial load\n * For accurate user data in React components, use useSession() hook from next-auth/react\n * or useAuth() hook from AuthContext\n */\nexport function getAuthUser(): AuthUser {\n  if (typeof window === 'undefined') {\n    return { name: 'User' };\n  }\n\n  // Try to get user from NextAuth session via fetch (async but we return sync fallback)\n  // For accurate data, components should use useSession() hook\n  try {\n    // Check if session cookie exists\n    const cookies = document.cookie.split(';');\n    const hasSessionCookie = cookies.some(cookie => \n      cookie.trim().startsWith('next-auth.session-token=') || \n      cookie.trim().startsWith('__Secure-next-auth.session-token=')\n    );\n    \n    if (!hasSessionCookie) {\n      return { name: 'User' };\n    }\n    \n    // Try to get cached session data from sessionStorage (if available)\n    // This is a fallback - components should use useSession() hook\n    const sessionData = sessionStorage.getItem('nextauth.session.user');\n    if (sessionData) {\n      try {\n        const user = JSON.parse(sessionData);\n        return {\n          sub: user.id || user.email,\n          name: user.name || user.email || 'User',\n          email: user.email,\n        };\n      } catch {\n        // Invalid session data\n      }\n    }\n  } catch {\n    // Session storage not available or error\n  }\n\n  // Fallback: return default user\n  // Components should use useSession() hook or useAuth() for accurate data\n  return {\n    name: 'User',\n  };\n}\n\n/**\n * Clear session and sign out using NextAuth\n */\nexport function clearSession(): void {\n  if (typeof window === 'undefined') return;\n  \n  // SECURITY: Clear any legacy localStorage tokens (shouldn't exist, but clean up just in case)\n  // Tokens are now stored server-side in Redis, but we clean up localStorage for safety\n  try {\n    localStorage.removeItem('access_token');\n    localStorage.removeItem('refresh_token');\n    localStorage.removeItem('id_token');\n    localStorage.removeItem('token_expires_at');\n  } catch {\n    // Ignore errors if localStorage is not available\n  }\n  \n  // Clear session storage\n  sessionStorage.removeItem('nextauth.session.user');\n  \n  // Sign out using NextAuth (this will clear the session cookie)\n  signOut({ callbackUrl: '/auth/login' });\n}\n\n/**\n * Redirect to login page\n */\nfunction redirectToLogin(): void {\n  if (typeof window === 'undefined') return;\n  \n  // Don't redirect if already on auth pages\n  if (window.location.pathname.startsWith('/auth/')) return;\n  \n  // Use replace to avoid adding to history\n  try {\n    window.location.replace('/auth/login');\n  } catch {\n    window.location.href = '/auth/login';\n  }\n}\n\n/**\n * Build logout URL for Keycloak\n * Note: NextAuth handles logout, but this is kept for compatibility\n */\nexport function buildLogoutUrl(postLogoutRedirectUri: string): string {\n  // NextAuth handles logout, but if needed for Keycloak direct logout:\n  const keycloakIssuer = process.env.NEXT_PUBLIC_KEYCLOAK_ISSUER || 'https://keycloak-staging.app-stg.mukuru.io/realms/mukuru';\n  const base = `${keycloakIssuer}/protocol/openid-connect/logout`;\n  const url = new URL(base);\n  url.searchParams.set('post_logout_redirect_uri', postLogoutRedirectUri);\n  return url.toString();\n}\n\n/**\n * Logout user using NextAuth\n */\nexport function logout(postLogoutRedirectUri: string = '/auth/login') {\n  // Use NextAuth signOut which handles session cleanup\n  signOut({ callbackUrl: postLogoutRedirectUri });\n}\n\n/**\n * Get user initials from name\n */\nexport function getInitials(name: string): string {\n  const parts = name.trim().split(/\\s+/).filter(Boolean);\n  if (parts.length === 0) return \"\";\n  if (parts.length === 1) return parts[0].slice(0, 2).toUpperCase();\n  return (parts[0][0] + parts[1][0]).toUpperCase();\n}\n\n/**\n * DEPRECATED: Token expiration check is handled server-side\n * This function is kept for compatibility but always returns false\n */\nexport function isTokenExpired(bufferSeconds: number = 120): boolean {\n  // Token expiration is handled server-side by NextAuth\n  // This function is deprecated\n  console.warn('[DEPRECATED] isTokenExpired() - token expiration is handled server-side');\n  return false;\n}\n"],"names":[],"mappings":"AAAA,oEAAoE;AACpE,+FAA+F;AAC/F,2DAA2D;;;;;;;;;;;;;;;;;;;;;AAE3D;;AAeO,SAAS;IACd,wCAAmC,OAAO;;;IAE1C,+CAA+C;IAC/C,4DAA4D;IAC5D,MAAM;IACN,MAAM;AAMR;AAOO,eAAe;IACpB,+CAA+C;IAC/C,mEAAmE;IACnE,QAAQ,IAAI,CAAC;IACb,OAAO;AACT;AAMO,eAAe;IACpB,mDAAmD;IACnD,iCAAiC;IACjC,QAAQ,IAAI,CAAC;IACb,OAAO;AACT;AAQO,SAAS;IACd,wCAAmC;QACjC,OAAO;YAAE,MAAM;QAAO;IACxB;;;AAwCF;AAKO,SAAS;IACd,wCAAmC;;;AAkBrC;AAEA;;CAEC,GACD,SAAS;IACP,wCAAmC;;;AAWrC;AAMO,SAAS,eAAe,qBAA6B;IAC1D,qEAAqE;IACrE,MAAM,iBAAiB,QAAQ,GAAG,CAAC,2BAA2B,IAAI;IAClE,MAAM,OAAO,GAAG,eAAe,+BAA+B,CAAC;IAC/D,MAAM,MAAM,IAAI,IAAI;IACpB,IAAI,YAAY,CAAC,GAAG,CAAC,4BAA4B;IACjD,OAAO,IAAI,QAAQ;AACrB;AAKO,SAAS,OAAO,wBAAgC,aAAa;IAClE,qDAAqD;IACrD,IAAA,yJAAO,EAAC;QAAE,aAAa;IAAsB;AAC/C;AAKO,SAAS,YAAY,IAAY;IACtC,MAAM,QAAQ,KAAK,IAAI,GAAG,KAAK,CAAC,OAAO,MAAM,CAAC;IAC9C,IAAI,MAAM,MAAM,KAAK,GAAG,OAAO;IAC/B,IAAI,MAAM,MAAM,KAAK,GAAG,OAAO,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,WAAW;IAC/D,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,GAAG,KAAK,CAAC,EAAE,CAAC,EAAE,EAAE,WAAW;AAChD;AAMO,SAAS,eAAe,gBAAwB,GAAG;IACxD,sDAAsD;IACtD,8BAA8B;IAC9B,QAAQ,IAAI,CAAC;IACb,OAAO;AACT"}},
    {"offset": {"line": 101, "column": 0}, "map": {"version":3,"sources":["file:///Users/mukurusystemsadministrator/Desktop/onboarding_kyc%20copy/partner/src/components/EnhancedContextualMessaging.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n  Box,\n  VStack,\n  HStack,\n  Text,\n  Button,\n  Input,\n  Textarea,\n  Avatar,\n  Badge,\n  Flex,\n  Icon,\n  Tooltip,\n  Spinner,\n  Image,\n  Link,\n  useDisclosure,\n  DialogRoot,\n  DialogBackdrop,\n  DialogContent,\n  DialogHeader,\n  DialogBody,\n  DialogFooter,\n  DialogTitle,\n  DialogCloseTrigger,\n  Select,\n  Checkbox,\n  SimpleGrid\n} from \"@chakra-ui/react\";\nimport { useState, useEffect, useRef } from \"react\";\nimport {\n  FiSend,\n  FiPaperclip,\n  FiMoreVertical,\n  FiSearch,\n  FiFilter,\n  FiArchive,\n  FiFlag,\n  FiCornerUpLeft,\n  FiCornerUpRight,\n  FiDownload,\n  FiEye,\n  FiEdit,\n  FiTrash2,\n  FiStar,\n  FiClock,\n  FiCheck,\n  FiCheckCircle,\n  FiAlertCircle,\n  FiInfo,\n  FiUser,\n  FiUsers,\n  FiTag,\n  FiCalendar,\n  FiMessageSquare,\n  FiFileText,\n  FiImage,\n  FiVideo,\n  FiFile,\n  FiMapPin,\n  FiFolder\n} from \"react-icons/fi\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\nconst MotionBox = motion.create(Box);\nconst MotionVStack = motion.create(VStack);\n\nexport interface ContextualMessage {\n  id: string;\n  senderId: string;\n  senderName: string;\n  senderType: 'partner' | 'admin' | 'system';\n  senderAvatar?: string;\n  content: string;\n  timestamp: string;\n  status: 'sent' | 'delivered' | 'read';\n  priority: 'low' | 'normal' | 'high' | 'urgent';\n  attachments?: Array<{\n    id: string;\n    name: string;\n    type: string;\n    size: string;\n    url: string;\n  }>;\n  replyTo?: string;\n  isRead: boolean;\n  isStarred: boolean;\n  tags?: string[];\n  applicationId?: string;\n  sectionReference?: string;\n  documentReference?: string;\n  fieldReference?: string;\n  context?: {\n    sectionTitle?: string;\n    fieldLabel?: string;\n    documentName?: string;\n    actionRequired?: string;\n  };\n}\n\nexport interface ContextualConversation {\n  id: string;\n  applicationId: string;\n  partnerId: string;\n  adminId?: string;\n  subject: string;\n  status: 'active' | 'resolved' | 'archived';\n  priority: 'low' | 'normal' | 'high' | 'urgent';\n  lastMessage?: string;\n  lastMessageTime?: string;\n  unreadCount: number;\n  tags: string[];\n  createdAt: string;\n  contextSections: string[];\n}\n\ninterface EnhancedContextualMessagingProps {\n  conversations: ContextualConversation[];\n  messages: ContextualMessage[];\n  currentConversationId?: string;\n  currentApplicationId?: string;\n  onSendMessage: (content: string, context?: any, attachments?: File[]) => Promise<void>;\n  onReplyToMessage: (messageId: string, content: string) => Promise<void>;\n  onForwardMessage: (messageId: string, toConversationId: string) => Promise<void>;\n  onStarMessage: (messageId: string) => Promise<void>;\n  onArchiveConversation: (conversationId: string) => Promise<void>;\n  onAssignConversation: (conversationId: string, adminId: string) => Promise<void>;\n  onTagConversation: (conversationId: string, tags: string[]) => Promise<void>;\n  currentUser: {\n    id: string;\n    name: string;\n    type: 'partner' | 'admin';\n    avatar?: string;\n  };\n  applicationSections?: Array<{\n    id: string;\n    title: string;\n    fields: Array<{\n      id: string;\n      label: string;\n      value?: any;\n    }>;\n  }>;\n  applicationDocuments?: Array<{\n    id: string;\n    name: string;\n    type: string;\n    status: string;\n    url?: string;\n  }>;\n}\n\nexport function EnhancedContextualMessaging({\n  conversations,\n  messages,\n  currentConversationId,\n  currentApplicationId,\n  onSendMessage,\n  onReplyToMessage,\n  onForwardMessage,\n  onStarMessage,\n  onArchiveConversation,\n  onAssignConversation,\n  onTagConversation,\n  currentUser,\n  applicationSections = [],\n  applicationDocuments = [],\n  loadingContext = false\n}: EnhancedContextualMessagingProps & { loadingContext?: boolean }) {\n  \n  const [newMessage, setNewMessage] = useState(\"\");\n  const [selectedContext, setSelectedContext] = useState<any>(null);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [filterPriority, setFilterPriority] = useState<string>(\"all\");\n  const [filterStatus, setFilterStatus] = useState<string>(\"all\");\n  const [isSending, setIsSending] = useState(false);\n  const [selectedAttachments, setSelectedAttachments] = useState<File[]>([]);\n  const [replyToMessage, setReplyToMessage] = useState<ContextualMessage | null>(null);\n  \n  const { open: isContextOpen, onOpen: onContextOpen, onClose: onContextClose } = useDisclosure();\n  const { open: isAttachmentOpen, onOpen: onAttachmentOpen, onClose: onAttachmentClose } = useDisclosure();\n  \n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [banner, setBanner] = useState<{ status: 'success' | 'error'; message: string } | null>(null);\n\n  const currentConversation = conversations.find(c => c.id === currentConversationId);\n  // Filter messages by conversation/thread, sort by timestamp (oldest first for display)\n  const currentMessages = messages\n    .filter(m => !currentConversationId || m.applicationId === currentApplicationId || m.applicationId === currentConversation?.applicationId)\n    .sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [currentMessages]);\n\n  const handleSendMessage = async () => {\n    if (!newMessage.trim() && selectedAttachments.length === 0) return;\n    \n    // Check if we have an application ID\n    if (!currentApplicationId) {\n      setBanner({ status: 'error', message: 'Please select an application to send a message' });\n      setTimeout(() => setBanner(null), 3000);\n      return;\n    }\n    \n    setIsSending(true);\n    try {\n      await onSendMessage(newMessage, selectedContext, selectedAttachments);\n      setNewMessage(\"\");\n      setSelectedContext(null);\n      setSelectedAttachments([]);\n      setReplyToMessage(null);\n    } catch (error) {\n      setBanner({ status: 'error', message: 'Failed to send message' });\n      setTimeout(() => setBanner(null), 3000);\n    } finally {\n      setIsSending(false);\n    }\n  };\n\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(event.target.files || []);\n    setSelectedAttachments(prev => [...prev, ...files]);\n  };\n\n  const removeAttachment = (index: number) => {\n    setSelectedAttachments(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const getContextualSections = () => {\n    return applicationSections.map(section => ({\n      id: section.id,\n      title: section.title,\n      type: 'section',\n      fields: section.fields\n    }));\n  };\n\n  const getContextualDocuments = () => {\n    return applicationDocuments.map(doc => ({\n      id: doc.id,\n      title: doc.name || 'Document',\n      type: doc.type || 'document',\n      status: doc.status || 'unknown',\n      url: doc.url\n    }));\n  };\n\n  const getPriorityColor = (priority: string) => {\n    switch (priority) {\n      case 'urgent': return 'red';\n      case 'high': return 'orange';\n      case 'normal': return 'blue';\n      case 'low': return 'gray';\n      default: return 'gray';\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'sent': return 'blue';\n      case 'delivered': return 'green';\n      case 'read': return 'green';\n      default: return 'gray';\n    }\n  };\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n\n  const getFileIcon = (type: string) => {\n    if (type.startsWith('image/')) return FiImage;\n    if (type.startsWith('video/')) return FiVideo;\n    if (type.includes('pdf')) return FiFileText;\n    return FiFile;\n  };\n\n  return (\n    <Box height=\"100%\" display=\"flex\" flexDirection=\"column\" overflow=\"hidden\" minH=\"0\">\n      {/* Header */}\n      <Box p=\"3\" borderBottom=\"1px\" borderColor=\"gray.200\" bg=\"white\" flexShrink={0}>\n        <VStack gap=\"2\" align=\"stretch\">\n          <HStack justify=\"space-between\" align=\"center\">\n            <VStack align=\"start\" gap=\"0.5\">\n              <Text fontSize=\"md\" fontWeight=\"semibold\" color=\"gray.900\">\n                Application Communication\n              </Text>\n              <Text fontSize=\"xs\" color=\"gray.600\" fontWeight=\"normal\">\n                {currentApplicationId ? `Application ${currentApplicationId.slice(0, 8)}...` : 'No application selected'}\n              </Text>\n            </VStack>\n            \n            {currentMessages.filter(m => !m.isRead && m.senderType !== currentUser.type).length > 0 && (\n              <Badge \n                colorScheme=\"orange\" \n                variant=\"solid\"\n                px=\"1.5\"\n                py=\"0.5\"\n                borderRadius=\"full\"\n                fontSize=\"2xs\"\n                fontWeight=\"semibold\"\n              >\n                {currentMessages.filter(m => !m.isRead && m.senderType !== currentUser.type).length} Unread\n              </Badge>\n            )}\n          </HStack>\n          \n          {/* Context Selection */}\n          <HStack gap=\"2\" align=\"center\">\n            <Text fontSize=\"xs\" color=\"gray.600\" fontWeight=\"medium\">Reference:</Text>\n            <Button\n              size=\"xs\"\n              variant=\"outline\"\n              onClick={onContextOpen}\n              borderColor=\"gray.300\"\n              _hover={{ bg: \"gray.50\", borderColor: \"gray.400\" }}\n              height=\"24px\"\n              fontSize=\"xs\"\n            >\n              <Icon as={FiMapPin} mr=\"1\" boxSize=\"3\" />\n              {selectedContext ? selectedContext.title : \"Select Context\"}\n            </Button>\n            {selectedContext && (\n              <Badge colorScheme=\"blue\" variant=\"subtle\" fontSize=\"2xs\">\n                {selectedContext.type}\n              </Badge>\n            )}\n          </HStack>\n        </VStack>\n      </Box>\n\n      {/* Banner */}\n      {banner && (\n        <Box p=\"3\" bg={banner.status === 'success' ? 'green.50' : 'red.50'} border=\"1px\" borderColor={banner.status === 'success' ? 'green.200' : 'red.200'}>\n          <Text fontSize=\"sm\" color={banner.status === 'success' ? 'green.700' : 'red.700'}>{banner.message}</Text>\n        </Box>\n      )}\n\n      {/* Messages */}\n      <Box flex=\"1\" overflowY=\"auto\" p=\"4\" bg=\"gray.50\">\n        <VStack gap=\"2.5\" align=\"stretch\">\n          <AnimatePresence>\n            {currentMessages.length === 0 ? (\n              <Box p=\"8\" textAlign=\"center\">\n                <Icon as={FiMessageSquare} boxSize=\"8\" color=\"gray.300\" mb=\"3\" />\n                <Text fontSize=\"sm\" color=\"gray.500\" fontWeight=\"medium\">No messages yet</Text>\n                <Text fontSize=\"xs\" color=\"gray.400\" mt=\"1\">Start the conversation below</Text>\n              </Box>\n            ) : (\n              currentMessages.map((message) => (\n                <MotionBox\n                  key={message.id}\n                  initial={{ opacity: 0, y: 4 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  exit={{ opacity: 0, y: -4 }}\n                  transition={{ duration: 0.1 }}\n                >\n                  {/* Determine if message is from current user (partner) or admin */}\n                  {(() => {\n                    // In partner view: partner messages go on RIGHT, admin messages on LEFT\n                    const isFromCurrentUser = message.senderType === 'partner' || \n                                             (currentUser.type === 'partner' && message.senderType !== 'admin');\n                    const isFromAdmin = message.senderType === 'admin';\n                    \n                    return (\n                      <Flex\n                        justify={isFromCurrentUser ? \"flex-end\" : \"flex-start\"}\n                        gap=\"2\"\n                        align=\"flex-start\"\n                        maxW=\"75%\"\n                        ml={isFromCurrentUser ? \"auto\" : \"0\"}\n                        mr={!isFromCurrentUser ? \"auto\" : \"0\"}\n                      >\n                        {!isFromCurrentUser && (\n                          <Avatar.Root size=\"sm\" flexShrink={0}>\n                            <Avatar.Fallback bg={isFromAdmin ? \"orange.500\" : \"blue.500\"} color=\"white\" fontSize=\"xs\" fontWeight=\"semibold\">\n                              {message.senderName.charAt(0).toUpperCase()}\n                            </Avatar.Fallback>\n                          </Avatar.Root>\n                        )}\n                        <Box\n                          maxW=\"100%\"\n                          p=\"2.5\"\n                          bg={isFromCurrentUser ? \"blue.500\" : (isFromAdmin ? \"orange.500\" : \"white\")}\n                          bgGradient={isFromCurrentUser ? \"linear(to-br, blue.500, blue.600)\" : (isFromAdmin ? \"linear(to-br, orange.500, orange.600)\" : undefined)}\n                          color={isFromCurrentUser || isFromAdmin ? \"white\" : \"gray.900\"}\n                          borderRadius=\"lg\"\n                          boxShadow={isFromCurrentUser ? \"0 2px 8px rgba(49, 130, 206, 0.2)\" : (isFromAdmin ? \"0 2px 8px rgba(237, 137, 54, 0.2)\" : \"0 1px 4px rgba(0, 0, 0, 0.06)\")}\n                          border={isFromCurrentUser || isFromAdmin ? \"none\" : \"1px solid\"}\n                          borderColor={isFromCurrentUser || isFromAdmin ? \"transparent\" : \"gray.200\"}\n                          _hover={{\n                            boxShadow: isFromCurrentUser ? \"0 3px 10px rgba(49, 130, 206, 0.25)\" : (isFromAdmin ? \"0 3px 10px rgba(237, 137, 54, 0.25)\" : \"0 2px 6px rgba(0, 0, 0, 0.08)\")\n                          }}\n                          transition=\"all 0.2s ease\"\n                        >\n                          <VStack gap=\"1.5\" align=\"stretch\">\n                            {/* Message Header */}\n                            <HStack justify=\"space-between\" align=\"start\" gap=\"2\">\n                              <HStack gap=\"1.5\" align=\"center\">\n                                <Box\n                                  width=\"4px\"\n                                  height=\"4px\"\n                                  borderRadius=\"full\"\n                                  bg={isFromCurrentUser || isFromAdmin ? \"rgba(255, 255, 255, 0.6)\" : \"blue.500\"}\n                                  flexShrink={0}\n                                />\n                                <VStack align=\"start\" gap=\"0\">\n                                  <Text \n                                    fontSize=\"xs\" \n                                    fontWeight=\"medium\" \n                                    color={isFromCurrentUser || isFromAdmin ? \"rgba(255, 255, 255, 0.95)\" : \"gray.700\"}\n                                    letterSpacing=\"0.1px\"\n                                  >\n                                    {message.senderName}\n                                  </Text>\n                                  <Text \n                                    fontSize=\"2xs\" \n                                    color={isFromCurrentUser || isFromAdmin ? \"rgba(255, 255, 255, 0.75)\" : \"gray.500\"}\n                                  >\n                                    {new Date(message.timestamp).toLocaleString('en-US', {\n                                      month: 'numeric',\n                                      day: 'numeric',\n                                      hour: 'numeric',\n                                      minute: '2-digit',\n                                      hour12: true\n                                    })}\n                                  </Text>\n                                </VStack>\n                              </HStack>\n                              <Badge\n                                bg={isFromCurrentUser || isFromAdmin ? \"rgba(255, 255, 255, 0.2)\" : \"gray.100\"}\n                                color={isFromCurrentUser || isFromAdmin ? \"white\" : \"gray.600\"}\n                                variant=\"solid\"\n                                fontSize=\"2xs\"\n                                px=\"1.5\"\n                                py=\"0.5\"\n                                borderRadius=\"sm\"\n                                fontWeight=\"medium\"\n                                backdropFilter=\"blur(4px)\"\n                              >\n                                {message.isRead ? \"✓ Read\" : \"Sent\"}\n                              </Badge>\n                            </HStack>\n                            \n                            {/* Message Content */}\n                            <Box pt=\"0.5\">\n                              <Text \n                                fontSize=\"sm\" \n                                whiteSpace=\"pre-wrap\" \n                                lineHeight=\"1.5\"\n                                color={isFromCurrentUser || isFromAdmin ? \"white\" : \"gray.800\"}\n                                fontWeight=\"normal\"\n                              >\n                                {message.content}\n                              </Text>\n                            </Box>\n                            \n                            {/* Message Actions */}\n                            <HStack gap=\"0.5\" pt=\"1.5\" borderTop=\"1px\" borderColor={isFromCurrentUser || isFromAdmin ? \"rgba(255, 255, 255, 0.15)\" : \"gray.100\"}>\n                              <Button\n                                size=\"xs\"\n                                variant=\"ghost\"\n                                color={isFromCurrentUser || isFromAdmin ? \"rgba(255, 255, 255, 0.85)\" : \"gray.600\"}\n                                onClick={() => setReplyToMessage(message)}\n                                _hover={{ \n                                  bg: isFromCurrentUser || isFromAdmin ? \"rgba(255, 255, 255, 0.12)\" : \"gray.100\",\n                                  color: isFromCurrentUser || isFromAdmin ? \"white\" : \"gray.700\"\n                                }}\n                                fontSize=\"2xs\"\n                                px=\"1.5\"\n                                py=\"0.5\"\n                                h=\"auto\"\n                                minH=\"auto\"\n                                fontWeight=\"normal\"\n                              >\n                                <Icon as={FiCornerUpLeft} mr=\"1\" boxSize=\"2.5\" />\n                                Reply\n                              </Button>\n                              <Button\n                                size=\"xs\"\n                                variant=\"ghost\"\n                                color={isFromCurrentUser || isFromAdmin ? \"rgba(255, 255, 255, 0.85)\" : \"gray.600\"}\n                                onClick={() => onStarMessage(message.id)}\n                                _hover={{ \n                                  bg: isFromCurrentUser || isFromAdmin ? \"rgba(255, 255, 255, 0.12)\" : \"gray.100\",\n                                  color: isFromCurrentUser || isFromAdmin ? \"white\" : \"gray.700\"\n                                }}\n                                fontSize=\"2xs\"\n                                px=\"1.5\"\n                                py=\"0.5\"\n                                h=\"auto\"\n                                minH=\"auto\"\n                                fontWeight=\"normal\"\n                              >\n                                <Icon as={FiStar} mr=\"1\" boxSize=\"2.5\" />\n                                Star\n                              </Button>\n                              <Button\n                                size=\"xs\"\n                                variant=\"ghost\"\n                                color={isFromCurrentUser || isFromAdmin ? \"rgba(255, 255, 255, 0.85)\" : \"gray.600\"}\n                                _hover={{ \n                                  bg: isFromCurrentUser || isFromAdmin ? \"rgba(255, 255, 255, 0.12)\" : \"gray.100\",\n                                  color: isFromCurrentUser || isFromAdmin ? \"white\" : \"gray.700\"\n                                }}\n                                fontSize=\"2xs\"\n                                px=\"1.5\"\n                                py=\"0.5\"\n                                h=\"auto\"\n                                minH=\"auto\"\n                                fontWeight=\"normal\"\n                              >\n                                <Icon as={FiCornerUpRight} mr=\"1\" boxSize=\"2.5\" />\n                                Forward\n                              </Button>\n                            </HStack>\n                          </VStack>\n                        </Box>\n                        {isFromCurrentUser && (\n                          <Avatar.Root size=\"sm\" flexShrink={0}>\n                            <Avatar.Fallback bg=\"#f76834\" color=\"white\" fontSize=\"xs\" fontWeight=\"semibold\">\n                              {message.senderName.charAt(0).toUpperCase()}\n                            </Avatar.Fallback>\n                          </Avatar.Root>\n                        )}\n                      </Flex>\n                    );\n                  })()}\n                </MotionBox>\n              ))\n            )}\n          </AnimatePresence>\n          <div ref={messagesEndRef} />\n        </VStack>\n      </Box>\n\n      {/* Reply Indicator */}\n      {replyToMessage && (\n        <Box p=\"3\" bg=\"blue.50\" borderTop=\"1px\" borderColor=\"blue.200\">\n          <HStack justify=\"space-between\">\n            <HStack gap=\"2\">\n              <Icon as={FiCornerUpLeft} color=\"blue.500\" />\n              <Text fontSize=\"sm\" color=\"blue.700\">\n                Replying to {replyToMessage.senderName}\n              </Text>\n            </HStack>\n            <Button\n              size=\"xs\"\n              variant=\"ghost\"\n              onClick={() => setReplyToMessage(null)}\n            >\n              Cancel\n            </Button>\n          </HStack>\n        </Box>\n      )}\n\n      {/* Message Input */}\n      <Box p=\"3\" bg=\"white\" borderTop=\"1px\" borderColor=\"gray.200\" flexShrink={0}>\n        <VStack gap=\"2\" align=\"stretch\">\n          {/* Attachments */}\n          {selectedAttachments.length > 0 && (\n            <Box p=\"2\" bg=\"gray.50\" borderRadius=\"md\" border=\"1px\" borderColor=\"gray.200\">\n              <VStack gap=\"1.5\" align=\"stretch\">\n                <Text fontSize=\"xs\" fontWeight=\"semibold\" color=\"gray.700\">\n                  Attachments ({selectedAttachments.length})\n                </Text>\n                {selectedAttachments.map((file, index) => (\n                  <HStack key={index} gap=\"2\" justify=\"space-between\" p=\"1.5\" bg=\"white\" borderRadius=\"sm\">\n                    <HStack gap=\"2\" flex=\"1\" minW=\"0\">\n                      <Icon as={getFileIcon(file.type)} color=\"gray.500\" boxSize=\"3.5\" />\n                      <VStack align=\"start\" gap=\"0\" flex=\"1\" minW=\"0\">\n                        <Text fontSize=\"2xs\" color=\"gray.700\" fontWeight=\"medium\" overflow=\"hidden\" textOverflow=\"ellipsis\" whiteSpace=\"nowrap\">{file.name}</Text>\n                        <Text fontSize=\"2xs\" color=\"gray.500\">{formatFileSize(file.size)}</Text>\n                      </VStack>\n                    </HStack>\n                    <Button\n                      size=\"xs\"\n                      variant=\"ghost\"\n                      color=\"red.500\"\n                      onClick={() => removeAttachment(index)}\n                      _hover={{ bg: \"red.50\" }}\n                      minW=\"auto\"\n                      px=\"1\"\n                      h=\"auto\"\n                    >\n                      <Icon as={FiTrash2} boxSize=\"3\" />\n                    </Button>\n                  </HStack>\n                ))}\n              </VStack>\n            </Box>\n          )}\n          \n          {/* Input Area */}\n          <HStack gap=\"2\" align=\"flex-end\">\n            <VStack gap=\"1.5\" align=\"stretch\" flex=\"1\">\n              <Textarea\n                placeholder=\"Type your message...\"\n                value={newMessage}\n                onChange={(e) => setNewMessage(e.target.value)}\n                rows={2}\n                resize=\"none\"\n                borderColor=\"gray.300\"\n                color=\"black\"\n                _focus={{ borderColor: \"blue.500\", boxShadow: \"0 0 0 1px #3182ce\", color: \"black\" }}\n                _hover={{ borderColor: \"gray.400\" }}\n                _placeholder={{ color: \"gray.400\" }}\n                fontSize=\"sm\"\n                py=\"2\"\n                px=\"3\"\n                onKeyPress={(e) => {\n                  if (e.key === 'Enter' && !e.shiftKey) {\n                    e.preventDefault();\n                    handleSendMessage();\n                  }\n                }}\n              />\n              \n              <HStack justify=\"space-between\" align=\"center\">\n                <Button\n                  size=\"xs\"\n                  variant=\"ghost\"\n                  onClick={() => fileInputRef.current?.click()}\n                  color=\"gray.600\"\n                  _hover={{ bg: \"gray.100\", color: \"gray.700\" }}\n                  fontWeight=\"normal\"\n                  h=\"auto\"\n                  py=\"1\"\n                  px=\"2\"\n                >\n                  <Icon as={FiPaperclip} mr=\"1.5\" boxSize=\"3.5\" />\n                  Attach\n                </Button>\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  multiple\n                  onChange={handleFileSelect}\n                  style={{ display: 'none' }}\n                />\n                \n                <HStack gap=\"1.5\">\n                  <Button\n                    size=\"xs\"\n                    variant=\"outline\"\n                    onClick={() => setNewMessage(\"\")}\n                    disabled={!newMessage.trim()}\n                    borderColor=\"gray.300\"\n                    color=\"gray.600\"\n                    _hover={{ bg: \"gray.50\", borderColor: \"gray.400\" }}\n                    fontWeight=\"normal\"\n                    h=\"auto\"\n                    py=\"1\"\n                    px=\"2.5\"\n                  >\n                    Clear\n                  </Button>\n                  <Button\n                    size=\"xs\"\n                    bg=\"blue.500\"\n                    color=\"white\"\n                    onClick={handleSendMessage}\n                    loading={isSending}\n                    disabled={(!newMessage.trim() && selectedAttachments.length === 0) || !currentApplicationId}\n                    _hover={{ bg: \"blue.600\" }}\n                    _active={{ bg: \"blue.700\" }}\n                    fontWeight=\"semibold\"\n                    h=\"auto\"\n                    py=\"1\"\n                    px=\"3\"\n                    title={!currentApplicationId ? \"Please select an application first\" : undefined}\n                  >\n                    <Icon as={FiSend} mr=\"1.5\" boxSize=\"3.5\" />\n                    Send\n                  </Button>\n                </HStack>\n              </HStack>\n            </VStack>\n          </HStack>\n        </VStack>\n      </Box>\n\n      {/* Context Selection Dialog (Chakra v3) */}\n      <DialogRoot open={isContextOpen} onOpenChange={(e) => (e.open ? onContextOpen() : onContextClose())} modal={true}>\n        <DialogBackdrop \n          bg=\"blackAlpha.600\" \n          backdropFilter=\"blur(4px)\"\n        />\n        <DialogContent \n          maxW=\"md\" \n          mx=\"auto\"\n          position=\"fixed\"\n          top=\"50%\"\n          left=\"50%\"\n          transform=\"translate(-50%, -50%)\"\n          zIndex={1500}\n          boxShadow=\"xl\"\n          borderRadius=\"xl\"\n          border=\"1px\"\n          borderColor=\"gray.200\"\n        >\n          <DialogHeader borderBottom=\"1px\" borderColor=\"gray.200\" pb=\"3\">\n            <DialogTitle fontSize=\"lg\" fontWeight=\"semibold\" color=\"gray.900\">Select Context Reference</DialogTitle>\n          </DialogHeader>\n          <DialogBody>\n            {loadingContext ? (\n              <Box p=\"8\" textAlign=\"center\">\n                <Spinner size=\"md\" color=\"blue.500\" />\n                <Text fontSize=\"sm\" color=\"gray.600\" mt=\"3\">Loading context...</Text>\n              </Box>\n            ) : (\n              <VStack gap=\"4\" align=\"stretch\">\n                {/* Application Sections */}\n                <Box>\n                  <Text fontSize=\"sm\" fontWeight=\"semibold\" color=\"gray.800\" mb=\"2\">\n                    Application Sections\n                  </Text>\n                  {getContextualSections().length === 0 ? (\n                    <Box p=\"4\" textAlign=\"center\" bg=\"gray.50\" borderRadius=\"md\">\n                      <Text fontSize=\"xs\" color=\"gray.500\">No sections available</Text>\n                    </Box>\n                  ) : (\n                  <VStack gap=\"2\" align=\"stretch\">\n                    {getContextualSections().map((section) => (\n                      <Box\n                        key={section.id}\n                        p=\"2.5\"\n                        border=\"1px\"\n                        borderColor=\"gray.200\"\n                        borderRadius=\"md\"\n                        cursor=\"pointer\"\n                        _hover={{ bg: \"blue.50\", borderColor: \"blue.300\" }}\n                        transition=\"all 0.2s\"\n                        onClick={() => {\n                          setSelectedContext(section);\n                          onContextClose();\n                        }}\n                      >\n                        <HStack gap=\"2\">\n                          <Icon as={FiFolder} color=\"blue.500\" boxSize=\"4\" />\n                          <VStack align=\"start\" gap=\"0\" flex=\"1\">\n                            <Text fontSize=\"sm\" fontWeight=\"medium\" color=\"gray.800\">\n                              {section.title}\n                            </Text>\n                            <Text fontSize=\"xs\" color=\"gray.500\">\n                              {section.fields?.length || 0} field{section.fields?.length !== 1 ? 's' : ''}\n                            </Text>\n                          </VStack>\n                        </HStack>\n                      </Box>\n                    ))}\n                  </VStack>\n                )}\n              </Box>\n              \n              <Box h=\"1px\" bg=\"gray.200\" />\n              \n              {/* Application Documents */}\n              <Box>\n                <Text fontSize=\"sm\" fontWeight=\"semibold\" color=\"gray.800\" mb=\"2\">\n                  Application Documents\n                </Text>\n                {getContextualDocuments().length === 0 ? (\n                  <Box p=\"4\" textAlign=\"center\" bg=\"gray.50\" borderRadius=\"md\">\n                    <Text fontSize=\"xs\" color=\"gray.500\">No documents available</Text>\n                  </Box>\n                ) : (\n                  <VStack gap=\"2\" align=\"stretch\">\n                    {getContextualDocuments().map((doc) => (\n                      <Box\n                        key={doc.id}\n                        p=\"2.5\"\n                        border=\"1px\"\n                        borderColor=\"gray.200\"\n                        borderRadius=\"md\"\n                        cursor=\"pointer\"\n                        _hover={{ bg: \"green.50\", borderColor: \"green.300\" }}\n                        transition=\"all 0.2s\"\n                        onClick={() => {\n                          setSelectedContext(doc);\n                          onContextClose();\n                        }}\n                      >\n                        <HStack gap=\"2\">\n                          <Icon as={FiFileText} color=\"green.500\" boxSize=\"4\" />\n                          <VStack align=\"start\" gap=\"0\" flex=\"1\">\n                            <Text fontSize=\"sm\" fontWeight=\"medium\" color=\"gray.800\">\n                              {doc.title || 'Document'}\n                            </Text>\n                            <Text fontSize=\"xs\" color=\"gray.500\">\n                              {doc.type && doc.type !== 'document' && <span>{doc.type} • </span>}\n                              Status: {doc.status || 'Unknown'}\n                            </Text>\n                          </VStack>\n                        </HStack>\n                      </Box>\n                    ))}\n                  </VStack>\n                )}\n              </Box>\n              </VStack>\n            )}\n          </DialogBody>\n          <DialogFooter borderTop=\"1px\" borderColor=\"gray.200\" pt=\"3\">\n            <Button \n              onClick={onContextClose}\n              variant=\"outline\"\n              size=\"sm\"\n            >\n              Close\n            </Button>\n          </DialogFooter>\n          <DialogCloseTrigger />\n        </DialogContent>\n      </DialogRoot>\n    </Box>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1566, "column": 0}, "map": {"version":3,"sources":["file:///Users/mukurusystemsadministrator/Desktop/onboarding_kyc%20copy/partner/src/lib/api.ts"],"sourcesContent":["export type UserCase = {\n  caseId: string;\n  type: string;\n  status: string;\n  partnerId?: string;\n  applicantFirstName?: string;\n  applicantLastName?: string;\n  applicantEmail?: string;\n  country?: string; // Maps from applicantCountry in backend\n  progressPercentage?: number;\n  riskLevel?: string;\n  riskScore?: number;\n  createdAt?: string;\n  updatedAt?: string;\n  assignedTo?: string;\n  assignedToName?: string;\n  assignedAt?: string;\n  metadataJson?: string; // Dynamic fields from Entity Configuration Service\n  businessLegalName?: string;\n  businessCountryOfRegistration?: string;\n};\n\nexport type DashboardSummary = {\n  generatedAt: string;\n  cases: {\n    totalCases: number;\n    activeCases: number;\n    completedCases: number;\n    rejectedCases: number;\n    pendingReviewCases: number;\n    overdueCases: number;\n  };\n  performance: {\n    completionRate: number;\n    approvalRate: number;\n    rejectionRate: number;\n  };\n  risk: {\n    highRiskCases: number;\n    mediumRiskCases: number;\n    lowRiskCases: number;\n    averageRiskScore: number;\n  };\n};\n\n// Route via Next.js proxy to avoid CORS\n// Proxy will automatically inject tokens from Redis based on session cookie\nconst API_BASE = process.env.NEXT_PUBLIC_API_BASE || \"http://localhost:3000/api/proxy\";\nconst MESSAGING_PREFIX = \"/api/v1\"; // Messaging is part of unified onboarding-api\n\n// Tokens are no longer accessed from localStorage - proxy handles authentication\n\n/**\n * Generate a consistent UUID v5 from email address (matches backend implementation)\n * This is used to generate PartnerId and UserId from Keycloak email addresses\n * \n * @param email - User's email address from Keycloak\n * @returns UUID v5 string (deterministic, same email always produces same UUID)\n */\nexport function generateUserIdFromEmail(email: string): string {\n  // UUID v5 namespace (DNS namespace)\n  const NAMESPACE_UUID = '6ba7b810-9dad-11d1-80b4-00c04fd430c8';\n  \n  // Convert namespace UUID to bytes\n  const namespaceBytes = parseUUID(NAMESPACE_UUID);\n  \n  // Normalize email to lowercase\n  const normalizedEmail = email.toLowerCase();\n  const emailBytes = new TextEncoder().encode(normalizedEmail);\n  \n  // Combine namespace and email\n  const combined = new Uint8Array(namespaceBytes.length + emailBytes.length);\n  combined.set(namespaceBytes);\n  combined.set(emailBytes, namespaceBytes.length);\n  \n  // Use Web Crypto API for SHA-1 (or fallback)\n  // Note: This is a simplified version - for production use a proper UUID v5 library\n  // For now, we'll let the backend generate it if this fails\n  try {\n    // Simple hash-based approach that's deterministic\n    let hash = 0;\n    for (let i = 0; i < combined.length; i++) {\n      hash = ((hash << 5) - hash) + combined[i];\n      hash = hash & hash;\n    }\n    \n    // Convert to UUID-like format\n    const hex = Math.abs(hash).toString(16).padStart(32, '0');\n    return `${hex.substring(0, 8)}-${hex.substring(8, 12)}-5${hex.substring(13, 16)}-${(parseInt(hex[16], 16) | 0x8).toString(16)}${hex.substring(17, 20)}-${hex.substring(20, 32)}`;\n  } catch {\n    // If generation fails, return empty - backend will generate from email\n    return '';\n  }\n}\n\n// Helper to parse UUID string to bytes\nfunction parseUUID(uuid: string): Uint8Array {\n  const clean = uuid.replace(/-/g, '');\n  const bytes = new Uint8Array(16);\n  for (let i = 0; i < 16; i++) {\n    bytes[i] = parseInt(clean.substr(i * 2, 2), 16);\n  }\n  return bytes;\n}\n\n/**\n * Make an API request with automatic token refresh on 401\n */\nasync function apiRequest<T>(\n  path: string,\n  options: {\n    method?: string;\n    body?: unknown;\n    retry?: boolean;\n  } = {}\n): Promise<T> {\n  const { method = \"GET\", body, retry = true } = options;\n  \n  // Tokens are no longer accessed from localStorage\n  // The proxy will automatically inject the Authorization header from Redis based on session cookie\n  \n  // Generate or retrieve trace ID for request tracking\n  const traceId = typeof window !== 'undefined' \n    ? (sessionStorage.getItem('traceId') || crypto.randomUUID())\n    : crypto.randomUUID();\n  \n  if (typeof window !== 'undefined') {\n    sessionStorage.setItem('traceId', traceId);\n  }\n\n  const headers: HeadersInit = {\n    \"Content-Type\": \"application/json\",\n    \"X-Trace-Id\": traceId,\n    \"X-Request-Id\": traceId,\n  };\n  \n  // DO NOT set Authorization header - proxy will inject it from Redis\n  // All requests must include credentials to send session cookie\n  // Try to get user info from NextAuth session for user identification headers\n  // These headers are critical for backend to identify the user\n  try {\n    const response = await fetch('/api/auth/session');\n    if (response.ok) {\n      const session = await response.json();\n      if (session?.user) {\n        headers[\"X-User-Name\"] = session.user.name || session.user.email || \"Partner User\";\n        headers[\"X-User-Role\"] = \"Applicant\";\n        if (session.user.email) {\n          headers[\"X-User-Email\"] = session.user.email;\n          // Generate a consistent GUID from email for user identification\n          const userId = generateUserIdFromEmail(session.user.email);\n          headers[\"X-User-Id\"] = userId;\n          console.log('[API] User headers set:', { \n            email: session.user.email, \n            userId,\n            name: headers[\"X-User-Name\"]\n          });\n        }\n      }\n    } else {\n      console.warn('[API] Failed to get session:', response.status, response.statusText);\n    }\n  } catch (error) {\n    // Log error but continue - backend will handle missing headers\n    console.warn('[API] Error fetching session for user headers:', error);\n  }\n  \n  const fetchOptions: RequestInit = {\n    method,\n    headers,\n    credentials: \"include\",\n  };\n  \n  if (body) {\n    fetchOptions.body = JSON.stringify(body);\n  }\n  \n  // Make initial request\n  let response: Response;\n  try {\n    response = await fetch(`${API_BASE}${path}`, fetchOptions);\n  } catch (networkError) {\n    // Handle network errors (connection refused, DNS failures, etc.)\n    const error = new Error(`Network error: ${networkError instanceof Error ? networkError.message : 'Unknown error'}`);\n    (error as any).isNetworkError = true;\n    throw error;\n  }\n  \n  // Handle 401 Unauthorized - redirect to login\n  // Token refresh is handled server-side by NextAuth\n  if (response.status === 401) {\n    if (typeof window !== 'undefined' && !window.location.pathname.startsWith('/auth/')) {\n      window.location.href = '/auth/login';\n    }\n    throw new Error(\"Session expired. Please sign in again.\");\n  }\n  \n  // Retry logic for network/server errors (5xx), but not 503 (Service Unavailable)\n  // 503 means the service isn't running, so retrying won't help\n  if (!response.ok && response.status >= 500 && response.status !== 503) {\n    const maxRetries = 3;\n    for (let attempt = 1; attempt <= maxRetries; attempt++) {\n      try {\n        await new Promise(resolve => setTimeout(resolve, 1000 * attempt)); // Exponential backoff\n        const retryResponse = await fetch(`${API_BASE}${path}`, fetchOptions);\n        if (retryResponse.ok || retryResponse.status < 500) {\n          response = retryResponse;\n          break;\n        }\n        if (attempt === maxRetries) {\n          response = retryResponse;\n        }\n      } catch (error) {\n        if (attempt === maxRetries) {\n          throw error;\n        }\n      }\n    }\n  }\n  \n  if (!response.ok) {\n    const text = await response.text().catch(() => \"\");\n    \n    // 401 already handled above\n    \n    // For 503 (Service Unavailable) and 404 (Not Found), mark them for graceful handling\n    const error = new Error(`${method} ${path} failed: ${response.status} ${text}`);\n    if (response.status === 503) {\n      // Mark it as a service unavailable error so callers can handle it gracefully\n      (error as any).isServiceUnavailable = true;\n    } else if (response.status === 404) {\n      // Mark 404 errors so callers can handle them gracefully (e.g., user doesn't exist yet)\n      (error as any).isNotFound = true;\n    }\n    throw error;\n  }\n  \n  // Handle empty responses\n  const contentType = response.headers.get(\"content-type\");\n  if (contentType && contentType.includes(\"application/json\")) {\n    return (await response.json()) as T;\n  }\n  \n  return {} as T;\n}\n\nasync function apiGet<T>(path: string): Promise<T> {\n  return apiRequest<T>(path, { method: \"GET\" });\n}\n\nasync function apiPost<T>(path: string, body: unknown): Promise<T> {\n  return apiRequest<T>(path, { method: \"POST\", body });\n}\n\nasync function apiPut<T>(path: string, body?: unknown): Promise<T> {\n  return apiRequest<T>(path, { method: \"PUT\", body });\n}\n\nasync function apiDelete<T>(path: string): Promise<T> {\n  return apiRequest<T>(path, { method: \"DELETE\" });\n}\n\nexport async function getDashboard(partnerId?: string): Promise<DashboardSummary> {\n  const qs = partnerId ? `?partnerId=${encodeURIComponent(partnerId)}` : \"\";\n  // Backend route: /api/v1/projections/dashboard\n  return apiGet<DashboardSummary>(`/api/v1/projections/dashboard${qs}`);\n}\n\nexport async function findUserCaseByEmail(email: string): Promise<UserCase | null> {\n  if (!email) return null;\n  // Generate partner ID from email to filter cases by ownership\n  // Declare outside try block so it's available in catch handlers\n  const userPartnerId = generateUserIdFromEmail(email);\n  try {\n    \n    // Try Projections API first (has more complete data)\n    // Filter by both email (searchTerm) and partnerId to ensure ownership\n    const params = new URLSearchParams({ searchTerm: email, take: \"10\" }); // Get more results to filter\n    if (userPartnerId) {\n      params.append('partnerId', userPartnerId);\n    }\n    \n    const result = await apiGet<{ items: Array<{\n      caseId: string;\n      type: string;\n      status: string;\n      partnerId?: string;\n      applicantFirstName?: string;\n      applicantLastName?: string;\n      applicantEmail?: string;\n      applicantCountry?: string;\n      country?: string;\n      progressPercentage?: number;\n      riskLevel?: string;\n      riskScore?: number;\n      createdAt?: string;\n      updatedAt?: string;\n      assignedTo?: string;\n      assignedToName?: string;\n      assignedAt?: string;\n      metadataJson?: string;\n      businessLegalName?: string;\n      businessCountryOfRegistration?: string;\n    }> }>(`/api/v1/projections/cases?${params.toString()}`);\n    \n    // Filter results to ensure they match the user's email and partner ID\n    // This provides an extra layer of security in case the API doesn't filter correctly\n    const matchingItem = result.items?.find(item => {\n      const emailMatch = item.applicantEmail?.toLowerCase() === email.toLowerCase();\n      const partnerMatch = !userPartnerId || !item.partnerId || \n                          item.partnerId.toLowerCase() === userPartnerId.toLowerCase();\n      return emailMatch && partnerMatch;\n    });\n    \n    if (matchingItem) {\n      // Map applicantCountry to country if needed\n      return {\n        caseId: matchingItem.caseId,\n        type: matchingItem.type,\n        status: matchingItem.status,\n        partnerId: matchingItem.partnerId,\n        applicantFirstName: matchingItem.applicantFirstName,\n        applicantLastName: matchingItem.applicantLastName,\n        applicantEmail: matchingItem.applicantEmail,\n        country: matchingItem.country || matchingItem.applicantCountry || undefined,\n        metadataJson: matchingItem.metadataJson,\n        businessLegalName: matchingItem.businessLegalName,\n        businessCountryOfRegistration: matchingItem.businessCountryOfRegistration,\n        progressPercentage: matchingItem.progressPercentage,\n        riskLevel: matchingItem.riskLevel,\n        riskScore: matchingItem.riskScore,\n        createdAt: matchingItem.createdAt,\n        updatedAt: matchingItem.updatedAt,\n        assignedTo: matchingItem.assignedTo,\n        assignedToName: matchingItem.assignedToName,\n        assignedAt: matchingItem.assignedAt\n      };\n    }\n    \n    // Fallback: If not found in projections, try case API directly (for newly created cases)\n    // This handles cases that haven't been synced to projections yet\n    console.log('Case not found in projections API, trying case API directly...');\n    try {\n      // Use searchTerm to search for the email, then filter by email on client side\n      // The case API searches in case number, name, business name, but not email directly\n      // So we'll fetch recent cases and filter by email\n      const caseApiResult = await apiGet<{\n        items: Array<{\n          caseId: string;\n          caseNumber: string;\n          type: string;\n          status: string;\n          partnerId: string;\n          applicantFirstName?: string;\n          applicantLastName?: string;\n          applicantEmail?: string;\n          applicantCountry?: string;\n          businessLegalName?: string;\n          createdAt: string;\n          updatedAt: string;\n        }>;\n        totalCount: number;\n      }>(`/api/v1/cases?take=50&sortBy=createdAt&sortDirection=desc`);\n      \n      // Find case where applicant email matches AND partner ID matches\n      const matchingCase = caseApiResult?.items?.find(\n        c => {\n          const emailMatch = c.applicantEmail?.toLowerCase() === email.toLowerCase();\n          const partnerMatch = !userPartnerId || !c.partnerId || \n                              c.partnerId.toLowerCase() === userPartnerId.toLowerCase();\n          return emailMatch && partnerMatch;\n        }\n      );\n      \n      if (matchingCase) {\n        console.log('Found case in case API:', matchingCase.caseNumber);\n        return {\n          caseId: matchingCase.caseNumber,\n          type: matchingCase.type,\n          status: matchingCase.status,\n          partnerId: matchingCase.partnerId,\n          applicantFirstName: matchingCase.applicantFirstName,\n          applicantLastName: matchingCase.applicantLastName,\n          applicantEmail: matchingCase.applicantEmail,\n          country: matchingCase.applicantCountry,\n          businessLegalName: matchingCase.businessLegalName,\n          createdAt: matchingCase.createdAt,\n          updatedAt: matchingCase.updatedAt\n        };\n      }\n    } catch (fallbackError: any) {\n      // If fallback also fails, continue to return null\n      console.log('Case API fallback also failed:', fallbackError?.message);\n    }\n    \n    return null;\n  } catch (error: any) {\n    // Silently handle service unavailable errors (503) - services may not be running\n    if (error?.isServiceUnavailable) {\n      // Try case API as fallback even on 503\n      try {\n        const caseApiResult = await apiGet<{\n          items: Array<{\n            caseId: string;\n            caseNumber: string;\n            type: string;\n            status: string;\n            partnerId: string;\n            applicantFirstName?: string;\n            applicantLastName?: string;\n            applicantEmail?: string;\n            applicantCountry?: string;\n            businessLegalName?: string;\n            createdAt: string;\n            updatedAt: string;\n          }>;\n          totalCount: number;\n        }>(`/api/v1/cases?take=50&sortBy=createdAt&sortDirection=desc`);\n        \n        const matchingCase = caseApiResult?.items?.find(\n          c => {\n            const emailMatch = c.applicantEmail?.toLowerCase() === email.toLowerCase();\n            const partnerMatch = !userPartnerId || !c.partnerId || \n                                c.partnerId.toLowerCase() === userPartnerId.toLowerCase();\n            return emailMatch && partnerMatch;\n          }\n        );\n        \n        if (matchingCase) {\n          return {\n            caseId: matchingCase.caseNumber,\n            type: matchingCase.type,\n            status: matchingCase.status,\n            partnerId: matchingCase.partnerId,\n            applicantFirstName: matchingCase.applicantFirstName,\n            applicantLastName: matchingCase.applicantLastName,\n            applicantEmail: matchingCase.applicantEmail,\n            country: matchingCase.applicantCountry,\n            businessLegalName: matchingCase.businessLegalName,\n            createdAt: matchingCase.createdAt,\n            updatedAt: matchingCase.updatedAt\n          };\n        }\n      } catch (fallbackError) {\n        // Ignore fallback errors\n      }\n      return null;\n    }\n    // Re-throw other errors\n    throw error;\n  }\n}\n\nexport async function getCaseById(caseId: string): Promise<UserCase | null> {\n  if (!caseId) return null;\n  try {\n    const caseData = await apiGet<{\n      caseId: string;\n      type: string;\n      status: string;\n      partnerId?: string;\n      applicantFirstName?: string;\n      applicantLastName?: string;\n      applicantEmail?: string;\n      applicantCountry?: string;\n      country?: string;\n      progressPercentage?: number;\n      riskLevel?: string;\n      riskScore?: number;\n      createdAt?: string;\n      updatedAt?: string;\n      assignedTo?: string;\n      assignedToName?: string;\n      assignedAt?: string;\n      metadataJson?: string;\n      businessLegalName?: string;\n      businessCountryOfRegistration?: string;\n    }>(`/api/v1/projections/cases/${encodeURIComponent(caseId)}`);\n    \n    // Map to UserCase format with metadata\n    return {\n      caseId: caseData.caseId,\n      type: caseData.type,\n      status: caseData.status,\n      partnerId: caseData.partnerId,\n      applicantFirstName: caseData.applicantFirstName,\n      applicantLastName: caseData.applicantLastName,\n      applicantEmail: caseData.applicantEmail,\n      country: caseData.country || caseData.applicantCountry || undefined,\n      metadataJson: caseData.metadataJson,\n      businessLegalName: caseData.businessLegalName,\n      businessCountryOfRegistration: caseData.businessCountryOfRegistration,\n      progressPercentage: caseData.progressPercentage,\n      riskLevel: caseData.riskLevel,\n      riskScore: caseData.riskScore,\n      createdAt: caseData.createdAt,\n      updatedAt: caseData.updatedAt,\n      assignedTo: caseData.assignedTo,\n      assignedToName: caseData.assignedToName,\n      assignedAt: caseData.assignedAt\n    };\n  } catch (error: any) {\n    // Silently handle service unavailable errors (503) - services may not be running\n    if (error?.isServiceUnavailable || error?.isNotFound) {\n      return null;\n    }\n    // Re-throw other errors\n    throw error;\n  }\n}\n\n// Messaging API (via gateway or direct service)\nexport type MessageDto = {\n  id: string;\n  threadId: string;\n  senderId: string;\n  senderName: string;\n  senderRole?: string;\n  content: string;\n  type?: string;\n  status: string;\n  sentAt: string;\n  readAt?: string | null;\n  isRead: boolean;\n};\n\nexport type MessageThreadDto = {\n  id: string;\n  applicationId: string;\n  applicationReference?: string;\n  lastMessageAt: string;\n  messageCount: number;\n  unreadCount: number;\n  lastMessage?: MessageDto | null;\n};\n\nexport type PagedResult<T> = {\n  items: T[];\n  totalCount: number;\n  page: number;\n  pageSize: number;\n  totalPages: number;\n  hasNextPage: boolean;\n  hasPreviousPage: boolean;\n};\n\nexport async function getMyThreads(page = 1, pageSize = 20) {\n  const qs = new URLSearchParams({ page: String(page), pageSize: String(pageSize) }).toString();\n  return apiGet<PagedResult<MessageThreadDto>>(`${MESSAGING_PREFIX}/messages/threads/my?${qs}`);\n}\n\nexport async function getThreadByApplication(applicationId: string) {\n  // Check if applicationId is a GUID or a case ID (case number)\n  const guidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n  let applicationGuid = applicationId;\n  \n  // If it's not a GUID, it's likely a case ID (case number), so fetch the GUID from the projections API\n  if (!guidRegex.test(applicationId)) {\n    try {\n      const caseData = await apiGet<{\n        id: string;\n        caseId: string;\n      }>(`/api/v1/projections/cases/${encodeURIComponent(applicationId)}`);\n      \n      if (caseData?.id) {\n        applicationGuid = caseData.id;\n      } else {\n        throw new Error(`Could not find application GUID for case ID: ${applicationId}`);\n      }\n    } catch (error) {\n      console.error('Failed to fetch application GUID from case ID:', error);\n      throw new Error(`Invalid application ID: ${applicationId}. Could not resolve to GUID.`);\n    }\n  }\n  \n  return apiGet<MessageThreadDto>(`${MESSAGING_PREFIX}/messages/threads/application/${encodeURIComponent(applicationGuid)}`);\n}\n\nexport async function getThreadMessages(threadId: string, page = 1, pageSize = 50) {\n  const qs = new URLSearchParams({ page: String(page), pageSize: String(pageSize) }).toString();\n  return apiGet<PagedResult<MessageDto>>(`${MESSAGING_PREFIX}/messages/threads/${encodeURIComponent(threadId)}/messages?${qs}`);\n}\n\nexport async function sendMessage(\n  applicationId: string, \n  content: string, \n  receiverId?: string,\n  replyToMessageId?: string,\n  attachments?: Array<{ fileName: string; contentType: string; fileSizeBytes: number; storageKey: string; storageUrl: string; documentId?: string; description?: string }>\n) {\n  // Check if applicationId is a GUID or a case ID (case number)\n  const guidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n  let applicationGuid = applicationId;\n  \n  // If it's not a GUID, it's likely a case ID (case number), so fetch the GUID from the projections API\n  if (!guidRegex.test(applicationId)) {\n    try {\n      const caseData = await apiGet<{\n        id: string;\n        caseId: string;\n      }>(`/api/v1/projections/cases/${encodeURIComponent(applicationId)}`);\n      \n      if (caseData?.id) {\n        applicationGuid = caseData.id;\n      } else {\n        throw new Error(`Could not find application GUID for case ID: ${applicationId}`);\n      }\n    } catch (error) {\n      console.error('Failed to fetch application GUID from case ID:', error);\n      throw new Error(`Invalid application ID: ${applicationId}. Could not resolve to GUID.`);\n    }\n  }\n  \n  const body: any = {\n    ApplicationId: applicationGuid,\n    Content: content,\n  };\n  if (receiverId) body.ReceiverId = receiverId;\n  if (replyToMessageId) body.ReplyToMessageId = replyToMessageId;\n  if (attachments && attachments.length > 0) {\n    body.Attachments = attachments.map(a => ({\n      FileName: a.fileName,\n      ContentType: a.contentType,\n      FileSizeBytes: a.fileSizeBytes,\n      StorageKey: a.storageKey,\n      StorageUrl: a.storageUrl,\n      DocumentId: a.documentId,\n      Description: a.description\n    }));\n  }\n  return apiPost<{ Success?: boolean; success?: boolean; MessageId?: string; messageId?: string; ThreadId?: string; threadId?: string }>(`${MESSAGING_PREFIX}/messages`, body);\n}\n\nexport async function deleteMessage(messageId: string): Promise<{ success: boolean; errorMessage?: string }> {\n  try {\n    await apiDelete(`${MESSAGING_PREFIX}/messages/${encodeURIComponent(messageId)}`);\n    return { success: true };\n  } catch (error) {\n    return { \n      success: false, \n      errorMessage: error instanceof Error ? error.message : 'Failed to delete message' \n    };\n  }\n}\n\nexport async function starMessage(messageId: string): Promise<{ success: boolean; isStarred: boolean; errorMessage?: string }> {\n  try {\n    const response = await apiPut<{ Success?: boolean; IsStarred?: boolean; success?: boolean; isStarred?: boolean; ErrorMessage?: string }>(`${MESSAGING_PREFIX}/messages/${encodeURIComponent(messageId)}/star`);\n    return {\n      success: response.Success ?? response.success ?? false,\n      isStarred: response.IsStarred ?? response.isStarred ?? false,\n      errorMessage: response.ErrorMessage\n    };\n  } catch (error) {\n    return {\n      success: false,\n      isStarred: false,\n      errorMessage: error instanceof Error ? error.message : 'Failed to star message'\n    };\n  }\n}\n\nexport async function archiveThread(threadId: string, archive: boolean = true): Promise<{ success: boolean; isArchived: boolean; errorMessage?: string }> {\n  try {\n    const response = await apiPut<{ Success?: boolean; IsArchived?: boolean; success?: boolean; isArchived?: boolean; ErrorMessage?: string }>(`${MESSAGING_PREFIX}/messages/threads/${encodeURIComponent(threadId)}/archive`, { Archive: archive });\n    return {\n      success: response.Success ?? response.success ?? false,\n      isArchived: response.IsArchived ?? response.isArchived ?? false,\n      errorMessage: response.ErrorMessage\n    };\n  } catch (error) {\n    return {\n      success: false,\n      isArchived: false,\n      errorMessage: error instanceof Error ? error.message : 'Failed to archive thread'\n    };\n  }\n}\n\nexport async function forwardMessage(\n  messageId: string, \n  toApplicationId: string, \n  toReceiverId?: string, \n  additionalContent?: string\n): Promise<{ success: boolean; newMessageId?: string; newThreadId?: string; errorMessage?: string }> {\n  try {\n    const response = await apiPost<{ \n      Success?: boolean; \n      NewMessageId?: string; \n      NewThreadId?: string;\n      success?: boolean;\n      newMessageId?: string;\n      newThreadId?: string;\n      ErrorMessage?: string;\n    }>(`${MESSAGING_PREFIX}/messages/${encodeURIComponent(messageId)}/forward`, {\n      ToApplicationId: toApplicationId,\n      ToReceiverId: toReceiverId,\n      AdditionalContent: additionalContent\n    });\n    return {\n      success: response.Success ?? response.success ?? false,\n      newMessageId: response.NewMessageId ?? response.newMessageId,\n      newThreadId: response.NewThreadId ?? response.newThreadId,\n      errorMessage: response.ErrorMessage\n    };\n  } catch (error) {\n    return {\n      success: false,\n      errorMessage: error instanceof Error ? error.message : 'Failed to forward message'\n    };\n  }\n}\n\nexport async function getUnreadCount() {\n  return apiGet<{ count: number }>(`${MESSAGING_PREFIX}/messages/unread/count`);\n}\n\nexport async function markMessageRead(messageId: string) {\n  return apiPut(`${MESSAGING_PREFIX}/messages/${encodeURIComponent(messageId)}/read`);\n}\n\n// Application sections and documents for context\nexport type ApplicationSection = {\n  id: string;\n  title: string;\n  fields: Array<{\n    id: string;\n    label: string;\n    type: string;\n    value?: any;\n  }>;\n};\n\nexport type ApplicationDocument = {\n  id: string;\n  name: string;\n  type: string;\n  status: string;\n  url?: string;\n  fileName?: string;\n  createdAt?: string;\n};\n\nexport async function getApplicationSections(applicationId: string): Promise<ApplicationSection[]> {\n  try {\n    // Get case details from projections API or onboarding API\n    const app = await apiGet<{\n      id: string;\n      sections?: Array<{\n        id: string;\n        title: string;\n        fields?: Array<{ id: string; label: string; type: string; value?: any }>;\n      }>;\n      checklist_items?: Array<{\n        id: string;\n        category: string;\n        requirement: string;\n        status: string;\n      }>;\n    }>(`/api/v1/projections/cases/${encodeURIComponent(applicationId)}`);\n    \n    // If sections are directly available\n    if (app?.sections) {\n      return app.sections.map(s => ({\n        id: s.id,\n        title: s.title,\n        fields: s.fields || []\n      }));\n    }\n    \n    // Try to construct sections from checklist items if available\n    if (app?.checklist_items && app.checklist_items.length > 0) {\n      const categoryMap = new Map<string, ApplicationSection>();\n      \n      app.checklist_items.forEach(item => {\n        if (!categoryMap.has(item.category)) {\n          categoryMap.set(item.category, {\n            id: `section-${item.category.toLowerCase().replace(/\\s+/g, '-')}`,\n            title: item.category,\n            fields: []\n          });\n        }\n        const section = categoryMap.get(item.category)!;\n        section.fields.push({\n          id: item.id,\n          label: item.requirement,\n          type: 'text',\n          value: item.status\n        });\n      });\n      \n      return Array.from(categoryMap.values());\n    }\n    \n    // Fallback: return empty array\n    return [];\n  } catch (error) {\n    console.error('Failed to fetch application sections:', error);\n    return [];\n  }\n}\n\nexport async function getApplicationDocuments(applicationId: string): Promise<ApplicationDocument[]> {\n  try {\n    // Convert applicationId to Guid for document service\n    // Try to fetch documents by caseId\n    const documents = await apiGet<Array<{\n      id: string;\n      documentNumber?: string;\n      fileName: string;\n      type: string;\n      contentType?: string;\n      createdAt?: string;\n      storageKey?: string;\n    }>>(`/documents/v1/api/v1/documents/list/${encodeURIComponent(applicationId)}`);\n    \n    if (Array.isArray(documents)) {\n      return documents.map(doc => ({\n        id: doc.id,\n        name: doc.fileName || doc.documentNumber || 'Document',\n        type: doc.type || 'unknown',\n        status: 'uploaded', // Default status\n        fileName: doc.fileName,\n        createdAt: doc.createdAt\n      }));\n    }\n    \n    return [];\n  } catch (error) {\n    console.error('Failed to fetch application documents:', error);\n    // Try alternative endpoint format\n    try {\n      const caseData = await apiGet<{ documents?: ApplicationDocument[] }>(`/api/v1/projections/cases/${encodeURIComponent(applicationId)}`);\n      if (caseData?.documents) {\n        return caseData.documents;\n      }\n    } catch (e) {\n      console.error('Alternative document fetch failed:', e);\n    }\n    return [];\n  }\n}\n\n// User Profile API\nexport type UserProfile = {\n  id: string;\n  email: string;\n  firstName: string;\n  lastName: string;\n  middleName?: string;\n  fullName: string;\n  profileImageUrl?: string;\n  phone?: string;\n  country?: string;\n  companyName?: string;\n  entityType?: string;\n  status?: string;\n  createdAt?: string;\n  updatedAt?: string;\n  preferences?: UserPreferences;\n};\n\nexport type UserPreferences = {\n  emailNotifications?: boolean;\n  smsNotifications?: boolean;\n  statusUpdates?: boolean;\n  marketingCommunications?: boolean;\n  language?: string;\n  timezone?: string;\n};\n\nexport type UpdateProfileRequest = {\n  firstName: string;\n  lastName: string;\n  middleName?: string;\n  phone?: string;\n  country?: string;\n  companyName?: string;\n  preferences?: UserPreferences;\n};\n\nexport type ChangePasswordRequest = {\n  currentPassword: string;\n  newPassword: string;\n  confirmPassword: string;\n};\n\nexport type CaseDataSummary = {\n  caseId: string;\n  applicationData: any;\n  documents: any[];\n  messages: any[];\n  timeline: any[];\n};\n\n// Get current user profile\nexport async function getUserProfile(): Promise<UserProfile> {\n  try {\n    // Try authentication service first\n    const profile = await apiGet<UserProfile>('/api/users/me');\n    return profile;\n  } catch (error) {\n    // Don't log 503 or 404 errors - services may not be running or user may not exist yet\n    if (!(error as any)?.isServiceUnavailable && !(error as any)?.isNotFound) {\n      console.error('Failed to fetch user profile from auth service:', error);\n    }\n    // Fallback: try to get from case data\n    try {\n      const { getAuthUser } = await import(\"@/lib/auth/session\");\n      const user = getAuthUser();\n      if (user && user.email) {\n        const caseData = await findUserCaseByEmail(user.email);\n        if (caseData) {\n          return {\n            id: user.sub || user.email,\n            email: user.email,\n            firstName: user.givenName || user.name?.split(' ')[0] || '',\n            lastName: user.familyName || user.name?.split(' ').slice(1).join(' ') || '',\n            fullName: user.name || '',\n            phone: undefined,\n            country: caseData.country,\n            preferences: undefined\n          };\n        }\n      }\n    } catch (e) {\n      // Don't log 503 or 404 errors - services may not be running or user may not exist yet\n      if (!(e as any)?.isServiceUnavailable && !(e as any)?.isNotFound) {\n        console.error('Failed to get user from case data:', e);\n      }\n    }\n    // Last resort: return from JWT token\n    const { getAuthUser } = await import(\"@/lib/auth/session\");\n    const user = getAuthUser();\n    return {\n      id: user.sub || user.email || '',\n      email: user.email || '',\n      firstName: user.givenName || user.name?.split(' ')[0] || '',\n      lastName: user.familyName || user.name?.split(' ').slice(1).join(' ') || '',\n      fullName: user.name || '',\n      preferences: undefined\n    };\n  }\n}\n\n// Get handler/user profile by ID (for displaying assigned handlers)\nexport async function getHandlerProfile(userId: string): Promise<{ id: string; fullName: string; email?: string; firstName?: string; lastName?: string; profileImageUrl?: string } | null> {\n  if (!userId) return null;\n  try {\n    // Try to get user profile from authentication service\n    const profile = await apiGet<{ id: string; email: string; firstName: string; lastName: string; fullName: string; profileImageUrl?: string }>(`/api/users/${userId}`);\n    return {\n      id: profile.id,\n      fullName: profile.fullName || `${profile.firstName || ''} ${profile.lastName || ''}`.trim() || 'Unknown User',\n      email: profile.email,\n      firstName: profile.firstName,\n      lastName: profile.lastName,\n      profileImageUrl: profile.profileImageUrl\n    };\n  } catch (error: any) {\n    // Don't log 404 or 503 errors - handler may not exist or service unavailable\n    if (!(error as any)?.isServiceUnavailable && !(error as any)?.isNotFound) {\n      console.error('Failed to fetch handler profile:', error);\n    }\n    return null;\n  }\n}\n\n// Update user profile\nexport async function updateUserProfile(updates: UpdateProfileRequest): Promise<UserProfile> {\n  try {\n    return await apiPut<UserProfile>('/api/users/me', updates);\n  } catch (error: any) {\n    // If user doesn't exist in backend (404), try to create them or fallback\n    if (error?.message?.includes('404')) {\n      console.warn('User profile not found in backend. Creating new profile...');\n      // For now, we'll just return the updated profile from the request\n      // In a full implementation, you might want to POST to create the user first\n      const { getAuthUser } = await import(\"@/lib/auth/session\");\n      const user = getAuthUser();\n      \n      return {\n        id: user?.sub || user?.email || '',\n        email: user?.email || '',\n        firstName: updates.firstName || user?.givenName || '',\n        lastName: updates.lastName || user?.familyName || '',\n        middleName: updates.middleName,\n        fullName: `${updates.firstName || ''} ${updates.lastName || ''}`.trim() || user?.name || '',\n        phone: updates.phone,\n        country: updates.country,\n        companyName: updates.companyName,\n        preferences: updates.preferences\n      };\n    }\n    throw error;\n  }\n}\n\n// Get user notification preferences\nexport async function getNotificationPreferences(): Promise<UserPreferences> {\n  try {\n    const profile = await getUserProfile();\n    return profile.preferences || {\n      emailNotifications: true,\n      smsNotifications: false,\n      statusUpdates: true,\n      marketingCommunications: false\n    };\n  } catch (error) {\n    // Don't log 404 or 503 errors - services may not be running or user may not exist yet\n    if (!(error as any)?.isNotFound && !(error as any)?.isServiceUnavailable) {\n      console.error('Failed to fetch notification preferences:', error);\n    }\n    // Return defaults\n    return {\n      emailNotifications: true,\n      smsNotifications: false,\n      statusUpdates: true,\n      marketingCommunications: false\n    };\n  }\n}\n\n// Update notification preferences\nexport async function updateNotificationPreferences(preferences: UserPreferences): Promise<UserProfile> {\n  try {\n    // Update preferences as part of profile\n    const currentProfile = await getUserProfile();\n    try {\n      return await updateUserProfile({\n        firstName: currentProfile.firstName || '',\n        lastName: currentProfile.lastName || '',\n        middleName: currentProfile.middleName,\n        phone: currentProfile.phone,\n        country: currentProfile.country,\n        companyName: currentProfile.companyName,\n        preferences\n      });\n    } catch (error: any) {\n      // If update fails (404 or other), the updateUserProfile will handle the fallback\n      // For notification preferences specifically, we can store locally as backup\n      if (error?.message?.includes('404')) {\n        console.warn('Profile not found in backend. Storing preferences locally...');\n        // Store preferences in localStorage as backup\n        if (typeof window !== 'undefined') {\n          localStorage.setItem('user_preferences', JSON.stringify(preferences));\n        }\n        // Return profile with updated preferences\n        return {\n          ...currentProfile,\n          preferences\n        };\n      }\n      throw error;\n    }\n  } catch (error) {\n    console.error('Failed to update notification preferences:', error);\n    // Still try to store locally\n    if (typeof window !== 'undefined') {\n      try {\n        localStorage.setItem('user_preferences', JSON.stringify(preferences));\n      } catch (e) {\n        console.error('Failed to store preferences locally:', e);\n      }\n    }\n    throw error;\n  }\n}\n\n// Change password\nexport async function changePassword(request: ChangePasswordRequest): Promise<{ success: boolean; message?: string }> {\n  try {\n    // Try authentication service endpoint if available\n    return await apiPost<{ success: boolean; message?: string }>('/api/users/me/change-password', request);\n  } catch (error) {\n    console.error('Failed to change password:', error);\n    // If endpoint doesn't exist, this would typically go through Keycloak\n    throw new Error('Password change not available. Please contact support or use Keycloak directly.');\n  }\n}\n\n// Download user data (GDPR compliance)\nexport async function downloadUserData(): Promise<Blob> {\n  try {\n    // Proxy handles authentication - no need for manual token\n    const response = await fetch(`${API_BASE}/api/users/me/data-export`, {\n      method: 'GET',\n      credentials: 'include', // Include session cookie\n    });\n\n    if (!response.ok) {\n      throw new Error('Failed to download user data');\n    }\n\n    return await response.blob();\n  } catch (error) {\n    console.error('Failed to download user data:', error);\n    // Fallback: create a simple JSON export\n    const profile = await getUserProfile();\n    const caseData = await findUserCaseByEmail(profile.email).catch(() => null);\n    \n    const data = {\n      profile,\n      caseData,\n      exportedAt: new Date().toISOString()\n    };\n\n    return new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n  }\n}\n\n// Delete user account\nexport async function deleteUserAccount(confirmation: { password?: string; reason?: string }): Promise<{ success: boolean; message?: string }> {\n  try {\n    return await apiPost<{ success: boolean; message?: string }>('/api/users/me/delete', confirmation);\n  } catch (error) {\n    console.error('Failed to delete account:', error);\n    throw new Error('Account deletion failed. Please contact support.');\n  }\n}\n\n// Get user's case summary for profile display\nexport async function getUserCaseSummary(): Promise<CaseDataSummary | null> {\n  try {\n    const { getAuthUser } = await import(\"@/lib/auth/session\");\n    const user = getAuthUser();\n    if (!user?.email) return null;\n\n    const caseData = await findUserCaseByEmail(user.email);\n    if (!caseData) return null;\n\n    // Get related data\n    const [documents, threads] = await Promise.all([\n      getApplicationDocuments(caseData.caseId).catch(() => []),\n      getMyThreads(1, 10).catch(() => ({ items: [], totalCount: 0 } as any))\n    ]);\n\n    return {\n      caseId: caseData.caseId,\n      applicationData: caseData,\n      documents,\n      messages: threads.items || [],\n      timeline: []\n    };\n  } catch (error) {\n    // Don't log 503 or 404 errors - services may not be running or user may not exist yet\n    if (!(error as any)?.isServiceUnavailable && !(error as any)?.isNotFound) {\n      console.error('Failed to get user case summary:', error);\n    }\n    return null;\n  }\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2404, "column": 0}, "map": {"version":3,"sources":["file:///Users/mukurusystemsadministrator/Desktop/onboarding_kyc%20copy/partner/src/lib/signalRService.ts"],"sourcesContent":["import * as signalR from \"@microsoft/signalr\";\nimport { getAuthUser } from \"./auth/session\";\nimport { generateUserIdFromEmail } from \"./api\";\n\nclass SignalRService {\n  private connection: signalR.HubConnection | null = null;\n  private reconnectAttempts = 0;\n  private maxReconnectAttempts = 5;\n  private listeners: Map<string, Set<(data: any) => void>> = new Map();\n\n  async connect(): Promise<void> {\n    if (this.connection?.state === signalR.HubConnectionState.Connected) {\n      return;\n    }\n\n    try {\n      // Get user info for connection\n      const user = getAuthUser();\n      const userEmail = user.email || \"\";\n      \n      // Generate user ID from email (consistent with backend)\n      const userId = generateUserIdFromEmail(userEmail);\n\n      // Build connection URL directly to backend (bypassing Next.js proxy)\n      // Next.js API routes don't support WebSocket connections, so SignalR must connect directly\n      const backendUrl = process.env.NEXT_PUBLIC_BACKEND_URL || 'http://localhost:8001';\n      const hubUrl = `${backendUrl}/api/v1/messages/hub`;\n      \n      this.connection = new signalR.HubConnectionBuilder()\n        .withUrl(hubUrl, {\n          // For direct backend connection, we need to handle auth differently\n          // The backend will use X-User-Id header for identification\n          accessTokenFactory: async () => {\n            // Return empty - backend uses headers for user identification\n            return \"\";\n          },\n          headers: {\n            'X-User-Email': userEmail,\n            'X-User-Name': user.name || userEmail,\n            'X-User-Role': 'Applicant',\n            'X-User-Id': userId.toString()\n          }\n        })\n        .withAutomaticReconnect({\n          nextRetryDelayInMilliseconds: (retryContext) => {\n            if (retryContext.previousRetryCount < this.maxReconnectAttempts) {\n              return Math.min(1000 * Math.pow(2, retryContext.previousRetryCount), 30000);\n            }\n            return null; // Stop reconnecting\n          }\n        })\n        .configureLogging(signalR.LogLevel.Information)\n        .build();\n\n      // Set up event handlers\n      this.setupEventHandlers();\n\n      // Start connection\n      await this.connection.start();\n      console.log('[SignalR] Connected to messaging hub');\n\n      this.reconnectAttempts = 0;\n    } catch (error) {\n      // SignalR is optional - messaging will work without real-time updates\n      console.warn('[SignalR] Connection failed (non-critical):', error);\n      console.warn('[SignalR] Messaging will work without real-time updates');\n      this.reconnectAttempts++;\n      // Don't throw - allow messaging to work without SignalR\n      // The connection will remain null and isConnected() will return false\n    }\n  }\n\n  private setupEventHandlers(): void {\n    if (!this.connection) return;\n\n    // Handle new messages\n    this.connection.on(\"ReceiveMessage\", (message: any) => {\n      console.log('[SignalR] Received message:', message);\n      this.notifyListeners(\"ReceiveMessage\", message);\n    });\n\n    // Handle message sent confirmation\n    this.connection.on(\"MessageSent\", (message: any) => {\n      console.log('[SignalR] Message sent:', message);\n      this.notifyListeners(\"MessageSent\", message);\n    });\n\n    // Handle message errors\n    this.connection.on(\"MessageError\", (error: string) => {\n      console.error('[SignalR] Message error:', error);\n      this.notifyListeners(\"MessageError\", error);\n    });\n\n    // Handle typing indicators\n    this.connection.on(\"UserTyping\", (data: { userId: string; userName: string; threadId: string }) => {\n      this.notifyListeners(\"UserTyping\", data);\n    });\n\n    // Handle message read receipts\n    this.connection.on(\"MessageRead\", (messageId: string) => {\n      this.notifyListeners(\"MessageRead\", messageId);\n    });\n\n    // Handle connection state changes\n    this.connection.onreconnecting((error) => {\n      console.warn('[SignalR] Reconnecting...', error);\n      this.notifyListeners(\"Reconnecting\", error);\n    });\n\n    this.connection.onreconnected((connectionId) => {\n      console.log('[SignalR] Reconnected:', connectionId);\n      this.notifyListeners(\"Reconnected\", connectionId);\n    });\n\n    this.connection.onclose((error) => {\n      console.error('[SignalR] Connection closed:', error);\n      this.notifyListeners(\"ConnectionClosed\", error);\n    });\n  }\n\n  async disconnect(): Promise<void> {\n    if (this.connection) {\n      await this.connection.stop();\n      this.connection = null;\n      this.listeners.clear();\n      console.log('[SignalR] Disconnected');\n    }\n  }\n\n  async joinThread(threadId: string): Promise<void> {\n    if (this.connection?.state === signalR.HubConnectionState.Connected) {\n      // Validate threadId is a valid GUID before calling\n      if (!threadId || threadId === '00000000-0000-0000-0000-000000000000') {\n        console.warn('[SignalR] Invalid threadId provided to JoinThread:', threadId);\n        return;\n      }\n      \n      try {\n        // Ensure threadId is a valid GUID string\n        const guidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n        if (!guidRegex.test(threadId)) {\n          console.warn('[SignalR] threadId is not a valid GUID:', threadId);\n          return;\n        }\n        \n        await this.connection.invoke(\"JoinThread\", threadId);\n        console.log('[SignalR] Joined thread:', threadId);\n      } catch (error) {\n        console.error('[SignalR] Failed to join thread:', threadId, error);\n        throw error;\n      }\n    }\n  }\n\n  async leaveThread(threadId: string): Promise<void> {\n    if (this.connection?.state === signalR.HubConnectionState.Connected) {\n      await this.connection.invoke(\"LeaveThread\", threadId);\n    }\n  }\n\n  async sendTypingIndicator(threadId: string): Promise<void> {\n    if (this.connection?.state === signalR.HubConnectionState.Connected) {\n      await this.connection.invoke(\"UserTyping\", threadId);\n    }\n  }\n\n  on(event: string, callback: (data: any) => void): () => void {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, new Set());\n    }\n    this.listeners.get(event)!.add(callback);\n\n    // Return unsubscribe function\n    return () => {\n      this.listeners.get(event)?.delete(callback);\n    };\n  }\n\n  private notifyListeners(event: string, data: any): void {\n    const callbacks = this.listeners.get(event);\n    if (callbacks) {\n      callbacks.forEach(callback => {\n        try {\n          callback(data);\n        } catch (error) {\n          console.error(`[SignalR] Error in listener for ${event}:`, error);\n        }\n      });\n    }\n  }\n\n  isConnected(): boolean {\n    return this.connection?.state === signalR.HubConnectionState.Connected;\n  }\n\n  getConnectionState(): signalR.HubConnectionState {\n    return this.connection?.state || signalR.HubConnectionState.Disconnected;\n  }\n\n}\n\n// Export singleton instance\nexport const signalRService = new SignalRService();\nexport default signalRService;\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2587, "column": 0}, "map": {"version":3,"sources":["file:///Users/mukurusystemsadministrator/Desktop/onboarding_kyc%20copy/partner/src/lib/documentUpload.ts"],"sourcesContent":["/**\n * Document Upload Service\n * \n * According to the backend, files should be uploaded to:\n * - Endpoint: /api/v1/documents/upload (or via proxy /api/proxy/api/v1/documents/upload)\n * - Storage: MinIO object storage (not Google Drive)\n * - Required: CaseId, PartnerId, DocumentType, File (multipart form data)\n * \n * Note: Files cannot be uploaded until a case is created, so uploads should happen\n * after case creation, not during form filling.\n */\n\n// Helper to generate PartnerId from email using MD5 (matches backend algorithm)\nfunction generatePartnerIdFromEmail(email: string): string {\n  if (!email) return '';\n  \n  // Normalize email to lowercase (matches backend)\n  const normalizedEmail = email.toLowerCase().trim();\n  \n  // Use Web Crypto API to generate MD5 hash\n  // Note: Web Crypto API doesn't support MD5 directly, so we use a workaround\n  // For production, consider using a library like crypto-js or implementing MD5\n  // For now, we'll use a simple hash that's deterministic\n  let hash = 0;\n  for (let i = 0; i < normalizedEmail.length; i++) {\n    const char = normalizedEmail.charCodeAt(i);\n    hash = ((hash << 5) - hash) + char;\n    hash = hash & hash; // Convert to 32-bit integer\n  }\n  \n  // Convert to GUID format (this is a simplified version)\n  // In production, use proper MD5 implementation\n  const hex = Math.abs(hash).toString(16).padStart(32, '0');\n  return `${hex.substring(0, 8)}-${hex.substring(8, 12)}-${hex.substring(12, 16)}-${hex.substring(16, 20)}-${hex.substring(20, 32)}`;\n}\n\n// Better implementation using crypto.subtle (SHA-256) and converting to GUID format\n// This is more secure but won't match MD5 exactly - for exact match, use crypto-js MD5\nasync function generatePartnerIdFromEmailMD5(email: string): Promise<string> {\n  if (!email) return '';\n  \n  const normalizedEmail = email.toLowerCase().trim();\n  \n  // Use crypto.subtle for hashing (SHA-256, then take first 16 bytes for GUID)\n  const encoder = new TextEncoder();\n  const data = encoder.encode(normalizedEmail);\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  \n  // Take first 16 bytes and format as GUID\n  const guidBytes = hashArray.slice(0, 16);\n  const hex = guidBytes.map(b => b.toString(16).padStart(2, '0')).join('');\n  return `${hex.substring(0, 8)}-${hex.substring(8, 12)}-${hex.substring(12, 16)}-${hex.substring(16, 20)}-${hex.substring(20, 32)}`;\n}\n\nexport enum DocumentType {\n  PassportCopy = 1,\n  DriversLicense = 2,\n  NationalId = 3,\n  ProofOfAddress = 4,\n  BankStatement = 5,\n  TaxDocument = 6,\n  BusinessRegistration = 7,\n  ArticlesOfIncorporation = 8,\n  ShareholderRegistry = 9,\n  FinancialStatements = 10,\n  Other = 99\n}\n\nexport interface FileUploadData {\n  fileName: string;\n  fileSize: number;\n  fileType: string;\n  googleDriveUrl?: string; // Legacy - will be replaced with document service\n  uploadedAt?: string;\n  fileId?: string;\n  // For actual upload, we need the File object\n  file?: File;\n}\n\nexport interface UploadDocumentResult {\n  documentId: string;\n  documentNumber: string;\n  wasDuplicate: boolean;\n  existingDocumentId?: string;\n  storageKey: string;\n}\n\n/**\n * Maps requirement codes to DocumentType enum\n * This helps determine the document type based on the field/requirement code\n */\nexport function mapRequirementCodeToDocumentType(requirementCode: string): DocumentType {\n  const code = requirementCode.toLowerCase();\n  \n  if (code.includes('passport')) return DocumentType.PassportCopy;\n  if (code.includes('drivers') || code.includes('license')) return DocumentType.DriversLicense;\n  if (code.includes('national_id') || code.includes('nationalid') || code.includes('id_number')) return DocumentType.NationalId;\n  if (code.includes('address') || code.includes('proof_of_address')) return DocumentType.ProofOfAddress;\n  if (code.includes('bank') || code.includes('statement')) return DocumentType.BankStatement;\n  if (code.includes('tax')) return DocumentType.TaxDocument;\n  if (code.includes('registration') || code.includes('business_registration')) return DocumentType.BusinessRegistration;\n  if (code.includes('articles') || code.includes('incorporation')) return DocumentType.ArticlesOfIncorporation;\n  if (code.includes('shareholder') || code.includes('share_register')) return DocumentType.ShareholderRegistry;\n  if (code.includes('financial') || code.includes('statement')) return DocumentType.FinancialStatements;\n  \n  return DocumentType.Other;\n}\n\n/**\n * Uploads a file to the Document Service API\n * \n * @param caseId - The case GUID (not case number)\n * @param partnerId - The partner GUID\n * @param file - The File object to upload\n * @param documentType - The document type enum value\n * @param description - Optional description\n * @param uploadedBy - Email of the user uploading (defaults to 'system')\n * @returns Upload result with document ID and storage key\n */\nexport async function uploadFileToDocumentService(\n  caseId: string,\n  partnerId: string,\n  file: File,\n  documentType: DocumentType = DocumentType.Other,\n  description?: string,\n  uploadedBy?: string\n): Promise<UploadDocumentResult> {\n  const formData = new FormData();\n  \n  // Append file\n  formData.append('file', file);\n  \n  // Append required fields\n  formData.append('caseId', caseId);\n  formData.append('partnerId', partnerId);\n  formData.append('type', documentType.toString());\n  \n  // Append optional fields\n  if (description) formData.append('description', description);\n  if (uploadedBy) formData.append('uploadedBy', uploadedBy);\n  \n  // Upload via proxy to document service\n  const response = await fetch('/api/proxy/api/v1/documents/upload', {\n    method: 'POST',\n    body: formData,\n    // Don't set Content-Type header - browser will set it with boundary for multipart/form-data\n    headers: {\n      ...(uploadedBy ? {\n        'X-User-Email': uploadedBy,\n        'X-User-Name': uploadedBy,\n        'X-User-Role': 'Applicant'\n      } : {})\n    }\n  });\n  \n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`Document upload failed: ${response.status} - ${errorText}`);\n  }\n  \n  const result = await response.json();\n  return {\n    documentId: result.documentId || result.id,\n    documentNumber: result.documentNumber || '',\n    wasDuplicate: result.wasDuplicate || false,\n    existingDocumentId: result.existingDocumentId,\n    storageKey: result.storageKey || ''\n  };\n}\n\n/**\n * Uploads multiple files to the Document Service\n * \n * @param caseId - The case GUID\n * @param partnerId - The partner GUID\n * @param files - Array of files with their metadata\n * @param uploadedBy - Email of the user uploading\n * @returns Array of upload results\n */\nexport async function uploadFilesToDocumentService(\n  caseId: string,\n  partnerId: string,\n  files: Array<{ file: File; requirementCode?: string; description?: string }>,\n  uploadedBy?: string\n): Promise<Array<{ requirementCode?: string; result: UploadDocumentResult; error?: string }>> {\n  const uploadPromises = files.map(async ({ file, requirementCode, description }) => {\n    try {\n      const documentType = requirementCode \n        ? mapRequirementCodeToDocumentType(requirementCode)\n        : DocumentType.Other;\n      \n      const result = await uploadFileToDocumentService(\n        caseId,\n        partnerId,\n        file,\n        documentType,\n        description || file.name,\n        uploadedBy\n      );\n      \n      return { requirementCode, result };\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      console.error(`Failed to upload file ${file.name}:`, errorMessage);\n      return { requirementCode, result: {} as UploadDocumentResult, error: errorMessage };\n    }\n  });\n  \n  return Promise.all(uploadPromises);\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2732, "column": 0}, "map": {"version":3,"sources":["file:///Users/mukurusystemsadministrator/Desktop/onboarding_kyc%20copy/partner/src/app/partner/messages/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { \n  Box, \n  Container, \n  VStack, \n  HStack,\n  Text,\n  Flex,\n  Button,\n  Image,\n  Circle,\n  Input,\n  Textarea\n} from \"@chakra-ui/react\";\nimport { motion } from \"framer-motion\";\nimport Link from \"next/link\";\nimport { useEffect, useMemo, useState, useRef } from \"react\";\nimport { getAuthUser } from \"@/lib/auth/session\";\n// Removed mockData import - using real backend data only\nimport { EnhancedContextualMessaging, type ContextualConversation, type ContextualMessage } from \"@/components/EnhancedContextualMessaging\";\nimport { getMyThreads, getThreadMessages, sendMessage, markMessageRead, getUnreadCount, getApplicationSections, getApplicationDocuments, forwardMessage, starMessage, archiveThread, findUserCaseByEmail, getThreadByApplication, type MessageDto, type MessageThreadDto, type PagedResult, type ApplicationSection, type ApplicationDocument } from \"@/lib/api\";\nimport { signalRService } from \"@/lib/signalRService\";\nimport { uploadFileToDocumentService } from \"@/lib/documentUpload\";\n\nconst MotionBox = motion.create(Box);\n\nexport default function CustomerMessagesPage() {\n  const [currentUserName, setCurrentUserName] = useState<string>(\"User\");\n  const [currentUserEmail, setCurrentUserEmail] = useState<string | undefined>(undefined);\n  const [conversations, setConversations] = useState<ContextualConversation[]>([]);\n  const [messages, setMessages] = useState<ContextualMessage[]>([]);\n  const [currentConversationId, setCurrentConversationId] = useState<string | null>(null);\n  const [currentApplicationId, setCurrentApplicationId] = useState<string | null>(null);\n  const [threadsPage, setThreadsPage] = useState<number>(1);\n  const [threadsPaged, setThreadsPaged] = useState<PagedResult<MessageThreadDto> | null>(null);\n  const [messagesPage, setMessagesPage] = useState<number>(1);\n  const [hasMoreMessages, setHasMoreMessages] = useState<boolean>(false);\n  const [unreadTotal, setUnreadTotal] = useState<number>(0);\n  const [applicationSections, setApplicationSections] = useState<ApplicationSection[]>([]);\n  const [applicationDocuments, setApplicationDocuments] = useState<ApplicationDocument[]>([]);\n  const [loadingContext, setLoadingContext] = useState<boolean>(false);\n  const [signalRConnected, setSignalRConnected] = useState(false);\n  const [isTyping, setIsTyping] = useState<{ [threadId: string]: { userName: string } }>({});\n  const typingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    const user = getAuthUser();\n    setCurrentUserName(user.name);\n    setCurrentUserEmail(user.email);\n  }, []);\n\n  // Initialize SignalR connection\n  useEffect(() => {\n    const initSignalR = async () => {\n      try {\n        await signalRService.connect();\n        setSignalRConnected(true);\n\n        // Set up event listeners\n        const unsubscribeReceive = signalRService.on(\"ReceiveMessage\", async (message: any) => {\n          console.log('[Partner Messages] Received SignalR message:', message);\n          \n          // Determine if message is from admin or partner based on email domain and sender info\n          const senderNameLower = (message.senderName || '').toLowerCase();\n          const senderEmail = (message.senderEmail || message.senderId || '').toLowerCase();\n          const currentUserEmailLower = (currentUserEmail || '').toLowerCase();\n          \n          // Check if message is from current user\n          const isFromCurrentUser = senderEmail === currentUserEmailLower || \n                                   senderNameLower === (currentUserName || '').toLowerCase();\n          \n          // Determine if message is from admin\n          const isFromAdmin = senderNameLower.includes('@mukuru.com') || \n                             senderEmail.includes('@mukuru.com') ||\n                             message.senderRole === 'Admin' || \n                             message.senderRole === 'ComplianceManager';\n          \n          // If message is for current thread, add it immediately\n          if (currentConversationId && message.threadId === currentConversationId) {\n            const contextualMessage: ContextualMessage = {\n              id: message.id,\n              senderId: message.senderId,\n              senderName: message.senderName,\n              senderType: isFromAdmin ? 'admin' : 'partner',\n              content: message.content,\n              timestamp: message.sentAt,\n              status: 'sent',\n              priority: 'normal',\n              attachments: message.attachments || [],\n              isRead: false,\n              isStarred: false,\n              tags: [],\n              applicationId: message.applicationId || currentApplicationId || ''\n            };\n            \n            setMessages(prev => {\n              // Check if message already exists (avoid duplicates)\n              if (prev.some(m => m.id === message.id)) {\n                return prev;\n              }\n              return [...prev, contextualMessage].sort((a, b) => \n                new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime()\n              );\n            });\n          }\n          \n          // If message is for a different thread but we have it in our list, refresh that thread\n          // Also refresh threads to update last message and unread counts\n          const refreshThreads = async () => {\n            try {\n              const result = await getMyThreads(threadsPage, 20);\n              const items = (result.items || []) as unknown as MessageThreadDto[];\n              const mapped: ContextualConversation[] = items.map(t => ({\n                id: t.id as any,\n                applicationId: t.applicationId as any,\n                partnerId: currentUserEmail ?? \"partner\",\n                subject: t.applicationReference || `Application ${t.applicationId}`,\n                status: 'active',\n                priority: 'normal',\n                lastMessage: t.lastMessage?.content,\n                lastMessageTime: (t.lastMessageAt as any) as string,\n                unreadCount: t.unreadCount ?? 0,\n                tags: [],\n                createdAt: new Date().toISOString(),\n                contextSections: []\n              } as any));\n              setConversations(mapped);\n              \n              // If the message is for the current thread, also reload messages to ensure consistency\n              if (currentConversationId && message.threadId === currentConversationId) {\n                try {\n                  const page = await getThreadMessages(currentConversationId, 1, 50);\n                  const items = page.items || [];\n                  const mapped = items.map((m: MessageDto) => {\n                    const senderNameLower = (m.senderName || '').toLowerCase();\n                    const isFromAdmin = senderNameLower.includes('@mukuru.com') || \n                                       m.senderRole === 'Admin' || \n                                       m.senderRole === 'ComplianceManager';\n                    return {\n                      id: m.id,\n                      senderId: m.senderId,\n                      senderName: m.senderName,\n                      senderType: isFromAdmin ? 'admin' : 'partner',\n                      content: m.content,\n                      timestamp: m.sentAt,\n                      status: (m.isRead ? 'read' : m.status) as any,\n                      priority: 'normal',\n                      attachments: [],\n                      isRead: m.isRead,\n                      isStarred: false,\n                      tags: [],\n                      applicationId: currentApplicationId || ''\n                    };\n                  }) as ContextualMessage[];\n                  const sorted = mapped.sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\n                  setMessages(sorted);\n                } catch (e) {\n                  console.error('Failed to reload messages after SignalR update:', e);\n                }\n              }\n            } catch (e) {\n              console.error('Failed to refresh threads:', e);\n            }\n          };\n          \n          refreshThreads();\n          getUnreadCount().then(r => setUnreadTotal(r.count ?? 0)).catch(() => {});\n        });\n\n        const unsubscribeTyping = signalRService.on(\"UserTyping\", (data: { userId: string; userName: string; threadId: string }) => {\n          if (currentConversationId && data.threadId === currentConversationId) {\n            setIsTyping(prev => ({ ...prev, [data.threadId]: { userName: data.userName } }));\n            \n            // Clear typing indicator after 3 seconds\n            if (typingTimeoutRef.current) {\n              clearTimeout(typingTimeoutRef.current);\n            }\n            typingTimeoutRef.current = setTimeout(() => {\n              setIsTyping(prev => {\n                const updated = { ...prev };\n                delete updated[data.threadId];\n                return updated;\n              });\n            }, 3000);\n          }\n        });\n\n        return () => {\n          unsubscribeReceive();\n          unsubscribeTyping();\n          signalRService.disconnect();\n        };\n      } catch (error) {\n        // SignalR is optional - messaging will work without real-time updates\n        console.warn('[Partner Messages] SignalR not available (non-critical):', error);\n        console.warn('[Partner Messages] Messaging will work without real-time updates');\n        setSignalRConnected(false);\n        // Continue - messaging page works without SignalR\n      }\n    };\n\n    initSignalR();\n  }, [currentConversationId, currentUserEmail, threadsPage]);\n\n  // Join/leave thread when selection changes\n  useEffect(() => {\n    if (currentConversationId && signalRConnected) {\n      // Validate threadId is a valid GUID before joining\n      const guidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n      if (guidRegex.test(currentConversationId) && currentConversationId !== '00000000-0000-0000-0000-000000000000') {\n        signalRService.joinThread(currentConversationId).catch(error => {\n          console.error('[Partner Messages] Failed to join thread:', error);\n        });\n        return () => {\n          signalRService.leaveThread(currentConversationId).catch(error => {\n            console.error('[Partner Messages] Failed to leave thread:', error);\n          });\n        };\n      } else {\n        console.warn('[Partner Messages] Invalid thread ID, skipping join:', currentConversationId);\n      }\n    }\n  }, [currentConversationId, signalRConnected]);\n\n  // No mock application usage. Data comes from backend only.\n\n  useEffect(() => {\n    let isMounted = true;\n    // Load the user's threads from backend only\n    (async () => {\n      try {\n        const result = await getMyThreads(threadsPage, 20);\n        if (!isMounted) return;\n        const items = (result.items || []) as unknown as MessageThreadDto[];\n        const mapped: ContextualConversation[] = items.map(t => ({\n          id: t.id as any,\n          applicationId: t.applicationId as any,\n          partnerId: currentUserEmail ?? \"partner\",\n          subject: t.applicationReference || `Application ${t.applicationId}`,\n          status: 'active',\n          priority: 'normal',\n          lastMessage: t.lastMessage?.content,\n          lastMessageTime: (t.lastMessageAt as any) as string,\n          unreadCount: t.unreadCount ?? 0,\n          tags: [],\n          createdAt: new Date().toISOString(),\n          contextSections: []\n        } as any));\n\n        setConversations(mapped);\n        setThreadsPaged(result as any);\n        if (mapped.length > 0) {\n          setCurrentConversationId(mapped[0].id);\n          setCurrentApplicationId(mapped[0].applicationId);\n        } else if (currentUserEmail) {\n          // If no threads exist, try to get the user's case/application\n          try {\n            const userCase = await findUserCaseByEmail(currentUserEmail);\n            if (userCase && userCase.caseId) {\n              setCurrentApplicationId(userCase.caseId);\n              // Try to get thread for this application\n              try {\n                const thread = await getThreadByApplication(userCase.caseId);\n                if (thread) {\n                  setCurrentConversationId(thread.id);\n                }\n              } catch (e) {\n                // Thread doesn't exist yet, will be created on first message\n                console.log('No thread exists yet for application, will be created on first message');\n              }\n            }\n          } catch (e) {\n            console.log('Could not find user case:', e);\n          }\n        }\n      } catch (e) {\n        // Log error details for debugging\n        console.error('[Messages] Error loading threads:', e);\n        if (e instanceof Error) {\n          console.error('[Messages] Error message:', e.message);\n          console.error('[Messages] Error stack:', e.stack);\n        }\n        // Keep empty state on error\n        setConversations([]);\n      }\n    })();\n\n    return () => { isMounted = false; };\n  }, [currentUserEmail, threadsPage]);\n\n  // Load messages for the selected conversation\n  useEffect(() => {\n    let isMounted = true;\n    const load = async () => {\n      const threadId = currentConversationId;\n      if (!threadId) return;\n      try {\n        const page = await getThreadMessages(threadId, messagesPage, 20);\n        if (!isMounted) return;\n        const items = page.items || [];\n        const mapped = items.map((m: MessageDto) => {\n          // Determine if message is from admin or partner based on email domain, name, and role\n          const senderNameLower = (m.senderName || '').toLowerCase();\n          const senderIdLower = (m.senderId || '').toLowerCase();\n          const currentUserEmailLower = (currentUserEmail || '').toLowerCase();\n          \n          // Check email domain first (most reliable)\n          const hasMukuruEmail = senderNameLower.includes('@mukuru.com') || \n                                senderIdLower.includes('@mukuru.com');\n          const hasKurasikaEmail = senderNameLower.includes('@kurasika.com') || \n                                  senderIdLower.includes('@kurasika.com');\n          \n          // Admin detection: check role first, then email domain, then name patterns\n          const adminNames = ['tendai gatahwa', 'tendai', 'admin', 'compliance', 'mukuru'];\n          \n          // Check if admin by name\n          const isAdminByName = adminNames.some(name => senderNameLower.includes(name));\n          \n          // Determine if message is from admin\n          const isFromAdmin = (m.senderRole === 'Admin' || \n                              m.senderRole === 'ComplianceManager') ||\n                             hasMukuruEmail ||\n                             (isAdminByName && !hasKurasikaEmail);\n          \n          // For partner view: partner messages are 'partner', admin messages are 'admin'\n          const senderType = isFromAdmin ? 'admin' : 'partner';\n          \n          return {\n            id: m.id,\n            senderId: m.senderId,\n            senderName: m.senderName,\n            senderType: senderType,\n            content: m.content,\n            timestamp: m.sentAt,\n            status: (m.isRead ? 'read' : m.status) as any,\n            priority: 'normal',\n            attachments: [],\n            isRead: m.isRead,\n            isStarred: false,\n            tags: [],\n            applicationId: currentApplicationId || ''\n          };\n        }) as ContextualMessage[];\n        // Sort by timestamp: oldest first (ascending order)\n        const sorted = [...mapped].sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\n        setMessages(prev => {\n          if (messagesPage === 1) {\n            return sorted;\n          } else {\n            // Merge and sort: oldest at top, newest at bottom\n            const merged = [...prev, ...sorted];\n            return merged.sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\n          }\n        });\n        setHasMoreMessages((page as any).hasNextPage);\n\n        // Best-effort mark unread as read\n        items.filter(m => !m.isRead).forEach(m => {\n          markMessageRead(m.id).catch(() => {});\n        });\n      } catch {\n        setMessages([]);\n      }\n    };\n    load();\n\n    // Poll for updates every 5s (only if SignalR is not connected)\n    if (!signalRConnected) {\n      const id = setInterval(load, 5000);\n      return () => { isMounted = false; clearInterval(id); };\n    }\n    return () => { isMounted = false; };\n  }, [currentConversationId, currentApplicationId, messagesPage, currentUserEmail, signalRConnected]);\n\n  // Load application sections and documents when application changes\n  useEffect(() => {\n    if (!currentApplicationId) {\n      setApplicationSections([]);\n      setApplicationDocuments([]);\n      setLoadingContext(false);\n      return;\n    }\n\n    let isMounted = true;\n    const loadContext = async () => {\n      setLoadingContext(true);\n      try {\n        const [sections, documents] = await Promise.all([\n          getApplicationSections(currentApplicationId),\n          getApplicationDocuments(currentApplicationId)\n        ]);\n        \n        if (isMounted) {\n          setApplicationSections(sections);\n          setApplicationDocuments(documents);\n          setLoadingContext(false);\n        }\n      } catch (error) {\n        console.error('Failed to load application context:', error);\n        if (isMounted) {\n          setApplicationSections([]);\n          setApplicationDocuments([]);\n          setLoadingContext(false);\n        }\n      }\n    };\n\n    loadContext();\n    return () => { isMounted = false; };\n  }, [currentApplicationId]);\n\n  // Unread total polling\n  useEffect(() => {\n    let active = true;\n    const refreshUnread = async () => {\n      try {\n        const r = await getUnreadCount();\n        if (active) setUnreadTotal(r.count ?? 0);\n      } catch (error) {\n        console.error('[Messages] Failed to refresh unread count:', error);\n        if (error instanceof Error) {\n          console.error('[Messages] Error details:', error.message);\n        }\n      }\n    };\n    refreshUnread();\n    const id = setInterval(refreshUnread, 10000);\n    return () => { active = false; clearInterval(id); };\n  }, []);\n\n  const handleSendMessage = async (content: string, _context?: any, attachments: File[] = [], replyToMessageId?: string) => {\n    if ((!content.trim() && attachments.length === 0) || !currentApplicationId) {\n      console.warn('Cannot send message: missing applicationId or content');\n      return;\n    }\n    \n    // If no conversation exists yet, we'll create one by sending the message\n    // The backend automatically creates a thread when sending the first message\n    let threadId = currentConversationId;\n    \n    // Upload attachments first if any\n    let attachmentInfos: Array<{ fileName: string; contentType: string; fileSizeBytes: number; storageKey: string; storageUrl: string; documentId?: string; description?: string }> = [];\n    \n    if (attachments.length > 0) {\n      // Upload files to document service and get storage keys/URLs\n      try {\n        // Get partnerId from user email\n        let partnerId = '';\n        if (currentUserEmail) {\n          const emailLower = currentUserEmail.toLowerCase();\n          let hash = 0;\n          for (let i = 0; i < emailLower.length; i++) {\n            const char = emailLower.charCodeAt(i);\n            hash = ((hash << 5) - hash) + char;\n            hash = hash & hash;\n          }\n          const hex = Math.abs(hash).toString(16).padStart(32, '0');\n          partnerId = `${hex.substring(0, 8)}-${hex.substring(8, 12)}-${hex.substring(12, 16)}-${hex.substring(16, 20)}-${hex.substring(20, 32)}`;\n        }\n        \n        attachmentInfos = await Promise.all(attachments.map(async (file) => {\n          try {\n            const uploadResult = await uploadFileToDocumentService(\n              currentApplicationId,\n              partnerId,\n              file,\n              99, // DocumentType.Other\n              `Message attachment: ${file.name}`,\n              currentUserEmail\n            );\n            \n            return {\n              fileName: file.name,\n              contentType: file.type || 'application/octet-stream',\n              fileSizeBytes: file.size,\n              storageKey: uploadResult.storageKey,\n              storageUrl: '',\n              documentId: uploadResult.documentId,\n              description: `Message attachment: ${file.name}`\n            };\n          } catch (error) {\n            console.error(`Failed to upload attachment ${file.name}:`, error);\n            // Continue with placeholder if upload fails\n            return {\n              fileName: file.name,\n              contentType: file.type || 'application/octet-stream',\n              fileSizeBytes: file.size,\n              storageKey: `messages/${currentApplicationId}/${Date.now()}-${file.name}`,\n              storageUrl: '',\n              description: undefined\n            };\n          }\n        }));\n      } catch (error) {\n        console.error('Error uploading attachments:', error);\n      }\n    }\n    \n    // Optimistic update\n    const optimisticMsg: ContextualMessage = {\n      id: `temp-${Date.now()}`,\n      senderId: currentUserEmail ?? 'partner',\n      senderName: currentUserName,\n      senderType: 'partner',\n      content,\n      timestamp: new Date().toISOString(),\n      status: 'sent',\n      priority: 'normal',\n      attachments: attachments.map((f, i) => ({ id: `${i}`, name: f.name, type: f.type, size: `${f.size}`, url: '' })),\n      isRead: false,\n      isStarred: false,\n      tags: [],\n      applicationId: currentApplicationId\n    };\n    setMessages(prev => [...prev, optimisticMsg].sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime()));\n\n    // Attempt to persist via backend\n    try {\n      const sendResult = await sendMessage(currentApplicationId, content, undefined, replyToMessageId, attachmentInfos.length > 0 ? attachmentInfos : undefined);\n      \n      // If we didn't have a conversationId before, get it from the send result or fetch the thread\n      if (!threadId && sendResult.threadId) {\n        threadId = sendResult.threadId;\n        setCurrentConversationId(threadId);\n      } else if (!threadId) {\n        // Try to get thread by application ID\n        try {\n          const thread = await getThreadByApplication(currentApplicationId);\n          if (thread) {\n            threadId = thread.id;\n            setCurrentConversationId(threadId);\n          }\n        } catch (e) {\n          console.warn('Could not fetch thread after sending message:', e);\n        }\n      }\n      \n      // Refresh messages after successful send to ensure proper sender type detection\n      if (threadId) {\n        // Wait a bit for SignalR to process, then reload\n        setTimeout(async () => {\n          try {\n            const page = await getThreadMessages(threadId as string, 1, 50);\n            const items = page.items || [];\n            const mapped = items.map((m: MessageDto) => {\n              const senderNameLower = (m.senderName || '').toLowerCase();\n              const senderIdLower = (m.senderId || '').toLowerCase();\n              const currentUserEmailLower = currentUserEmail ? currentUserEmail.toLowerCase() : '';\n              \n              // Check if message is from current user (for reference, not used in senderType)\n              // const isFromCurrentUser = senderIdLower === currentUserEmailLower || \n              //                          senderNameLower === (currentUserName || '').toLowerCase();\n              \n              // Determine if message is from admin\n              const isFromAdmin = senderNameLower.includes('@mukuru.com') || \n                                 senderIdLower.includes('@mukuru.com') ||\n                                 m.senderRole === 'Admin' || \n                                 m.senderRole === 'ComplianceManager';\n              \n              // For partner view: partner messages are 'partner', admin messages are 'admin'\n              const senderType = isFromAdmin ? 'admin' : 'partner';\n              \n              return {\n                id: m.id,\n                senderId: m.senderId,\n                senderName: m.senderName,\n                senderType: senderType,\n                content: m.content,\n                timestamp: m.sentAt,\n                status: (m.isRead ? 'read' : m.status) as any,\n                priority: 'normal',\n                attachments: [],\n                isRead: m.isRead,\n                isStarred: false,\n                tags: [],\n                applicationId: currentApplicationId\n              };\n            }) as ContextualMessage[];\n            \n            // Sort and update messages\n            const sorted = mapped.sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\n            setMessages(sorted);\n            setMessagesPage(1);\n          } catch (error) {\n            console.error('Failed to refresh messages after send:', error);\n          }\n        }, 500);\n      }\n      \n      // Update unread total after send\n      getUnreadCount().then(r => setUnreadTotal(r.count ?? 0)).catch(() => {});\n      \n      // Refresh threads to update last message and show new thread if created\n      const threadsResult = await getMyThreads(threadsPage, 20);\n      const threadItems = (threadsResult.items || []) as unknown as MessageThreadDto[];\n      const updatedThreads: ContextualConversation[] = threadItems.map(t => ({\n        id: t.id as any,\n        applicationId: t.applicationId as any,\n        partnerId: currentUserEmail ?? \"partner\",\n        subject: t.applicationReference || `Application ${t.applicationId}`,\n        status: 'active',\n        priority: 'normal',\n        lastMessage: t.lastMessage?.content,\n        lastMessageTime: (t.lastMessageAt as any) as string,\n        unreadCount: t.unreadCount ?? 0,\n        tags: [],\n        createdAt: new Date().toISOString(),\n        contextSections: []\n      } as any));\n      setConversations(updatedThreads);\n      \n      // If we just created a new thread, select it\n      if (!currentConversationId && threadId) {\n        setCurrentConversationId(threadId);\n      }\n    } catch (error) {\n      console.error('Failed to send message:', error);\n      // Remove optimistic message on error\n      setMessages(prev => prev.filter(m => m.id !== optimisticMsg.id));\n      // Show error banner would be handled by the component\n    }\n  };\n\n  const noop = async () => {};\n\n  // With fallback above, we always render the designed page\n\n  return (\n    <Box minH=\"100vh\" bg=\"gray.50\">\n      {/* Header */}\n      <Box bg=\"white\" borderBottom=\"1px\" borderColor=\"gray.200\" py=\"4\">\n        <Container maxW=\"7xl\">\n          <Flex justify=\"space-between\" align=\"center\">\n            <HStack gap=\"4\">\n              <Link href=\"/partner/dashboard\">\n                <Button variant=\"ghost\" size=\"sm\">← Back</Button>\n              </Link>\n              <Image src=\"/mukuru-logo.png\" alt=\"Mukuru\" height=\"32px\" />\n              <Text color=\"gray.600\" fontSize=\"sm\">Messages</Text>\n            </HStack>\n            <HStack gap=\"4\">\n              <Circle size=\"32px\" bg=\"orange.500\" color=\"white\">\n                <Text fontSize=\"sm\" fontWeight=\"bold\">JD</Text>\n              </Circle>\n            </HStack>\n          </Flex>\n        </Container>\n      </Box>\n\n      {/* Messages Container - Fixed height, no page scrolling */}\n      <Box \n        height=\"calc(100vh - 80px)\" \n        display=\"flex\" \n        flexDirection=\"column\"\n        overflow=\"hidden\"\n      >\n        <Container maxW=\"7xl\" flex=\"1\" display=\"flex\" flexDirection=\"column\" py=\"4\" overflow=\"hidden\">\n          {/* Page Header - Fixed */}\n          <MotionBox\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.6 }}\n            mb=\"3\"\n            flexShrink={0}\n          >\n            <VStack align=\"start\" gap=\"1\">\n              <Text fontSize=\"xl\" fontWeight=\"semibold\" color=\"gray.900\">Messages</Text>\n              <Text fontSize=\"xs\" color=\"gray.600\">Communicate with our team regarding your application.</Text>\n            </VStack>\n          </MotionBox>\n\n          {/* Messages Container - Takes remaining space */}\n          <MotionBox\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.6, delay: 0.1 }}\n            flex=\"1\"\n            display=\"flex\"\n            overflow=\"hidden\"\n            minH=\"0\"\n          >\n            <Flex gap=\"6\" width=\"100%\" height=\"100%\" overflow=\"hidden\">\n              {/* Threads Sidebar - Independent scroll */}\n              <Box \n                width=\"320px\" \n                bg=\"white\" \n                borderRadius=\"lg\" \n                boxShadow=\"sm\"\n                border=\"1px\"\n                borderColor=\"gray.200\"\n                display=\"flex\"\n                flexDirection=\"column\"\n                overflow=\"hidden\"\n              >\n                <Box p=\"3\" borderBottom=\"1px\" borderColor=\"gray.200\" bg=\"gray.50\" flexShrink={0}>\n                  <HStack justify=\"space-between\" align=\"center\">\n                    <Text fontSize=\"sm\" fontWeight=\"semibold\" color=\"gray.900\">My Threads</Text>\n                    {unreadTotal > 0 && (\n                      <Box \n                        px=\"2\" \n                        py=\"0.5\" \n                        borderRadius=\"full\" \n                        bg=\"orange.500\" \n                        color=\"white\" \n                        fontSize=\"2xs\" \n                        fontWeight=\"bold\"\n                        minW=\"18px\"\n                        textAlign=\"center\"\n                      >\n                        {unreadTotal}\n                      </Box>\n                    )}\n                  </HStack>\n                </Box>\n                <VStack align=\"stretch\" gap=\"1.5\" flex=\"1\" overflowY=\"auto\" p=\"3\">\n                  {conversations.length === 0 ? (\n                    <Box p=\"6\" textAlign=\"center\">\n                      <Text fontSize=\"xs\" color=\"gray.500\" fontWeight=\"medium\">No conversations yet</Text>\n                      <Text fontSize=\"2xs\" color=\"gray.400\" mt=\"1\">Messages will appear here</Text>\n                    </Box>\n                  ) : (\n                    conversations.map((c) => (\n                      <Box\n                        key={c.id}\n                        p=\"3\"\n                        borderRadius=\"lg\"\n                        border=\"1px solid\"\n                        borderColor={currentConversationId === c.id ? \"#3182ce\" : \"gray.200\"}\n                        bg={currentConversationId === c.id ? \"blue.50\" : \"white\"}\n                        cursor=\"pointer\"\n                        boxShadow={currentConversationId === c.id ? \"0 2px 8px rgba(49, 130, 206, 0.15)\" : \"0 1px 3px rgba(0, 0, 0, 0.05)\"}\n                        onClick={() => {\n                          setCurrentConversationId(c.id);\n                          setCurrentApplicationId(c.applicationId);\n                          setMessagesPage(1);\n                        }}\n                        _hover={{ \n                          bg: currentConversationId === c.id ? \"blue.50\" : \"gray.50\",\n                          borderColor: currentConversationId === c.id ? \"#3182ce\" : \"gray.300\",\n                          boxShadow: currentConversationId === c.id ? \"0 4px 12px rgba(49, 130, 206, 0.2)\" : \"0 2px 6px rgba(0, 0, 0, 0.1)\",\n                          transform: \"translateY(-1px)\"\n                        }}\n                        transition=\"all 0.2s ease\"\n                        position=\"relative\"\n                      >\n                        {/* Active indicator */}\n                        {currentConversationId === c.id && (\n                          <Box\n                            position=\"absolute\"\n                            left=\"0\"\n                            top=\"0\"\n                            bottom=\"0\"\n                            width=\"3px\"\n                            bg=\"#3182ce\"\n                            borderRadius=\"lg\"\n                          />\n                        )}\n                        <VStack align=\"stretch\" gap=\"2\">\n                          <HStack justify=\"space-between\" align=\"start\" gap=\"2\">\n                            <VStack align=\"start\" gap=\"0.5\" flex=\"1\" minW=\"0\">\n                              <HStack gap=\"1.5\" align=\"center\" width=\"100%\">\n                                <Box\n                                  width=\"8px\"\n                                  height=\"8px\"\n                                  borderRadius=\"full\"\n                                  bg={currentConversationId === c.id ? \"#3182ce\" : \"gray.400\"}\n                                  flexShrink={0}\n                                />\n                                <Text \n                                  fontSize=\"xs\" \n                                  color={currentConversationId === c.id ? \"gray.900\" : \"gray.800\"} \n                                  fontWeight={currentConversationId === c.id ? \"semibold\" : \"medium\"}\n                                  lineHeight=\"1.3\"\n                                  overflow=\"hidden\"\n                                  textOverflow=\"ellipsis\"\n                                  display=\"-webkit-box\"\n                                  style={{ WebkitLineClamp: 2, WebkitBoxOrient: 'vertical' }}\n                                >\n                                  {c.subject || `Application ${c.applicationId?.slice(0, 8)}...`}\n                                </Text>\n                              </HStack>\n                              <Text \n                                fontSize=\"2xs\" \n                                color={currentConversationId === c.id ? \"gray.600\" : \"gray.500\"}\n                                ml=\"3.5\"\n                              >\n                                {c.lastMessageTime ? new Date(c.lastMessageTime).toLocaleString('en-US', {\n                                  month: 'numeric',\n                                  day: 'numeric',\n                                  hour: 'numeric',\n                                  minute: '2-digit',\n                                  hour12: true\n                                }) : 'No messages'}\n                              </Text>\n                            </VStack>\n                            {c.unreadCount > 0 && (\n                              <Box \n                                px=\"2\" \n                                py=\"0.5\" \n                                borderRadius=\"full\" \n                                bg=\"orange.500\" \n                                color=\"white\" \n                                fontSize=\"2xs\" \n                                fontWeight=\"bold\"\n                                flexShrink={0}\n                                minW=\"20px\"\n                                textAlign=\"center\"\n                                boxShadow=\"0 2px 4px rgba(237, 137, 54, 0.3)\"\n                              >\n                                {c.unreadCount}\n                              </Box>\n                            )}\n                          </HStack>\n                          {c.lastMessage && (\n                            <Box \n                              ml=\"3.5\"\n                              p=\"2\"\n                              bg={currentConversationId === c.id ? \"white\" : \"gray.50\"}\n                              borderRadius=\"sm\"\n                              border=\"1px\"\n                              borderColor={currentConversationId === c.id ? \"blue.100\" : \"gray.100\"}\n                            >\n                              <Text \n                                fontSize=\"2xs\" \n                                color=\"gray.600\" \n                                overflow=\"hidden\"\n                                textOverflow=\"ellipsis\"\n                                whiteSpace=\"nowrap\"\n                                lineHeight=\"1.4\"\n                              >\n                                {c.lastMessage}\n                              </Text>\n                            </Box>\n                          )}\n                        </VStack>\n                      </Box>\n                    ))\n                  )}\n                </VStack>\n              </Box>\n\n              {/* Messages Surface - Independent scroll */}\n              <Box \n                flex=\"1\" \n                bg=\"white\" \n                borderRadius=\"xl\" \n                boxShadow=\"sm\" \n                display=\"flex\" \n                flexDirection=\"column\"\n                overflow=\"hidden\"\n                minH=\"0\"\n              >\n                {/* Load older button */}\n                {hasMoreMessages && (\n                  <Box p=\"3\" borderBottom=\"1px\" borderColor=\"gray.200\" bg=\"gray.50\" flexShrink={0}>\n                    <Button size=\"sm\" variant=\"outline\" onClick={() => setMessagesPage(p => p + 1)}>Load older messages</Button>\n                  </Box>\n                )}\n                <Box flex=\"1\" display=\"flex\" flexDirection=\"column\" overflow=\"hidden\" minH=\"0\">\n                  <EnhancedContextualMessaging\n                    conversations={conversations}\n                    messages={messages}\n                    currentConversationId={currentConversationId ?? undefined}\n                    currentApplicationId={currentApplicationId ?? undefined}\n                    onSendMessage={handleSendMessage}\n                    onReplyToMessage={async (messageId: string, content: string) => {\n                      await handleSendMessage(content, undefined, [], messageId);\n                    }}\n                    onForwardMessage={async (messageId: string, toConversationId: string) => {\n                      try {\n                        const message = messages.find(m => m.id === messageId);\n                        if (!message) return;\n                        \n                        const targetConversation = conversations.find(c => c.id === toConversationId);\n                        if (!targetConversation) {\n                          alert('Target conversation not found');\n                          return;\n                        }\n                        \n                        const result = await forwardMessage(messageId, targetConversation.applicationId);\n                        if (result.success) {\n                          alert('Message forwarded successfully');\n                        } else {\n                          alert(result.errorMessage || 'Failed to forward message');\n                        }\n                      } catch (error) {\n                        console.error('Failed to forward message:', error);\n                        alert('Failed to forward message');\n                      }\n                    }}\n                    onStarMessage={async (messageId: string) => {\n                      try {\n                        await starMessage(messageId);\n                        if (currentConversationId) {\n                          const page = await getThreadMessages(currentConversationId, 1, 50);\n                          const items = page.items || [];\n                          const mapped = items.map((m: MessageDto) => ({\n                            id: m.id,\n                            senderId: m.senderId,\n                            senderName: m.senderName,\n                            senderType: (() => {\n                              const senderNameLower = (m.senderName || '').toLowerCase();\n                              const isFromAdmin = senderNameLower.includes('@mukuru.com') || \n                                                 m.senderRole === 'Admin' || \n                                                 m.senderRole === 'ComplianceManager';\n                              return isFromAdmin ? 'admin' : 'partner';\n                            })(),\n                            content: m.content,\n                            timestamp: m.sentAt,\n                            status: (m.isRead ? 'read' : m.status) as any,\n                            priority: 'normal',\n                            attachments: [],\n                            isRead: m.isRead,\n                            isStarred: false,\n                            tags: [],\n                            applicationId: currentApplicationId\n                          })) as ContextualMessage[];\n                          setMessages(mapped.sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime()));\n                        }\n                      } catch (error) {\n                        console.error('Failed to star message:', error);\n                      }\n                    }}\n                    onArchiveConversation={async (conversationId: string) => {\n                      try {\n                        const result = await archiveThread(conversationId, true);\n                        if (result.success) {\n                          const result = await getMyThreads(threadsPage, 20);\n                          const items = (result.items || []) as unknown as MessageThreadDto[];\n                          const mapped: ContextualConversation[] = items.map(t => ({\n                            id: t.id as any,\n                            applicationId: t.applicationId as any,\n                            partnerId: currentUserEmail ?? \"partner\",\n                            subject: t.applicationReference || `Application ${t.applicationId}`,\n                            status: 'active',\n                            priority: 'normal',\n                            lastMessage: t.lastMessage?.content,\n                            lastMessageTime: (t.lastMessageAt as any) as string,\n                            unreadCount: t.unreadCount ?? 0,\n                            tags: [],\n                            createdAt: new Date().toISOString(),\n                            contextSections: []\n                          } as any));\n                          setConversations(mapped);\n                          \n                          if (currentConversationId === conversationId) {\n                            setCurrentConversationId(null);\n                          }\n                        }\n                      } catch (error) {\n                        console.error('Failed to archive conversation:', error);\n                        alert('Failed to archive conversation');\n                      }\n                    }}\n                    onAssignConversation={async () => {}}\n                    onTagConversation={async () => {}}\n                    currentUser={{ id: currentUserEmail ?? 'partner', name: currentUserName, type: 'partner' }}\n                    applicationSections={applicationSections}\n                    applicationDocuments={applicationDocuments}\n                    loadingContext={loadingContext}\n                  />\n                </Box>\n              </Box>\n            </Flex>\n          </MotionBox>\n        </Container>\n      </Box>\n    </Box>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}