"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/auth/[...nextauth]/route";
exports.ids = ["app/api/auth/[...nextauth]/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "dns/promises":
/*!*******************************!*\
  !*** external "dns/promises" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("dns/promises");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("querystring");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "node:assert":
/*!******************************!*\
  !*** external "node:assert" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:assert");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:crypto");

/***/ }),

/***/ "node:diagnostics_channel":
/*!*******************************************!*\
  !*** external "node:diagnostics_channel" ***!
  \*******************************************/
/***/ ((module) => {

module.exports = require("node:diagnostics_channel");

/***/ }),

/***/ "node:events":
/*!******************************!*\
  !*** external "node:events" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:events");

/***/ }),

/***/ "node:net":
/*!***************************!*\
  !*** external "node:net" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("node:net");

/***/ }),

/***/ "node:timers/promises":
/*!***************************************!*\
  !*** external "node:timers/promises" ***!
  \***************************************/
/***/ ((module) => {

module.exports = require("node:timers/promises");

/***/ }),

/***/ "node:tls":
/*!***************************!*\
  !*** external "node:tls" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("node:tls");

/***/ }),

/***/ "node:url":
/*!***************************!*\
  !*** external "node:url" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("node:url");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&page=%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute.ts&appDir=%2FUsers%2Fmukurusystemsadministrator%2FDesktop%2Fonboarding_kyc%20copy%2Fpartner%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmukurusystemsadministrator%2FDesktop%2Fonboarding_kyc%20copy%2Fpartner&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&page=%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute.ts&appDir=%2FUsers%2Fmukurusystemsadministrator%2FDesktop%2Fonboarding_kyc%20copy%2Fpartner%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmukurusystemsadministrator%2FDesktop%2Fonboarding_kyc%20copy%2Fpartner&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_mukurusystemsadministrator_Desktop_onboarding_kyc_copy_partner_src_app_api_auth_nextauth_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/auth/[...nextauth]/route.ts */ \"(rsc)/./src/app/api/auth/[...nextauth]/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/auth/[...nextauth]/route\",\n        pathname: \"/api/auth/[...nextauth]\",\n        filename: \"route\",\n        bundlePath: \"app/api/auth/[...nextauth]/route\"\n    },\n    resolvedPagePath: \"/Users/mukurusystemsadministrator/Desktop/onboarding_kyc copy/partner/src/app/api/auth/[...nextauth]/route.ts\",\n    nextConfigOutput,\n    userland: _Users_mukurusystemsadministrator_Desktop_onboarding_kyc_copy_partner_src_app_api_auth_nextauth_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/auth/[...nextauth]/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhdXRoJTJGJTVCLi4ubmV4dGF1dGglNUQlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmF1dGglMkYlNUIuLi5uZXh0YXV0aCU1RCUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmF1dGglMkYlNUIuLi5uZXh0YXV0aCU1RCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRm11a3VydXN5c3RlbXNhZG1pbmlzdHJhdG9yJTJGRGVza3RvcCUyRm9uYm9hcmRpbmdfa3ljJTIwY29weSUyRnBhcnRuZXIlMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGbXVrdXJ1c3lzdGVtc2FkbWluaXN0cmF0b3IlMkZEZXNrdG9wJTJGb25ib2FyZGluZ19reWMlMjBjb3B5JTJGcGFydG5lciZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD1zdGFuZGFsb25lJnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQzZEO0FBQzFJO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXVrdXJ1LWFwcC8/ZjRjMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvbXVrdXJ1c3lzdGVtc2FkbWluaXN0cmF0b3IvRGVza3RvcC9vbmJvYXJkaW5nX2t5YyBjb3B5L3BhcnRuZXIvc3JjL2FwcC9hcGkvYXV0aC9bLi4ubmV4dGF1dGhdL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcInN0YW5kYWxvbmVcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvYXV0aC9bLi4ubmV4dGF1dGhdL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYXV0aC9bLi4ubmV4dGF1dGhdXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9hdXRoL1suLi5uZXh0YXV0aF0vcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvbXVrdXJ1c3lzdGVtc2FkbWluaXN0cmF0b3IvRGVza3RvcC9vbmJvYXJkaW5nX2t5YyBjb3B5L3BhcnRuZXIvc3JjL2FwcC9hcGkvYXV0aC9bLi4ubmV4dGF1dGhdL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9hdXRoL1suLi5uZXh0YXV0aF0vcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&page=%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute.ts&appDir=%2FUsers%2Fmukurusystemsadministrator%2FDesktop%2Fonboarding_kyc%20copy%2Fpartner%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmukurusystemsadministrator%2FDesktop%2Fonboarding_kyc%20copy%2Fpartner&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/auth/[...nextauth]/route.ts":
/*!*************************************************!*\
  !*** ./src/app/api/auth/[...nextauth]/route.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ handler),\n/* harmony export */   POST: () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth */ \"(rsc)/./node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./src/lib/auth.ts\");\n\n\nconst handler = next_auth__WEBPACK_IMPORTED_MODULE_0___default()(_lib_auth__WEBPACK_IMPORTED_MODULE_1__.authOptions);\n// NextAuth App Router handlers\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9hdXRoL1suLi5uZXh0YXV0aF0vcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBaUM7QUFDUTtBQUV6QyxNQUFNRSxVQUFVRixnREFBUUEsQ0FBQ0Msa0RBQVdBO0FBRXBDLCtCQUErQjtBQUNZIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXVrdXJ1LWFwcC8uL3NyYy9hcHAvYXBpL2F1dGgvWy4uLm5leHRhdXRoXS9yb3V0ZS50cz8wMDk4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBOZXh0QXV0aCBmcm9tICduZXh0LWF1dGgnO1xuaW1wb3J0IHsgYXV0aE9wdGlvbnMgfSBmcm9tICdAL2xpYi9hdXRoJztcblxuY29uc3QgaGFuZGxlciA9IE5leHRBdXRoKGF1dGhPcHRpb25zKTtcblxuLy8gTmV4dEF1dGggQXBwIFJvdXRlciBoYW5kbGVyc1xuZXhwb3J0IHsgaGFuZGxlciBhcyBHRVQsIGhhbmRsZXIgYXMgUE9TVCB9O1xuIl0sIm5hbWVzIjpbIk5leHRBdXRoIiwiYXV0aE9wdGlvbnMiLCJoYW5kbGVyIiwiR0VUIiwiUE9TVCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/auth/[...nextauth]/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authOptions: () => (/* binding */ authOptions)\n/* harmony export */ });\n/* harmony import */ var next_auth_providers_keycloak__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/providers/keycloak */ \"(rsc)/./node_modules/next-auth/providers/keycloak.js\");\n/* harmony import */ var _redis_session__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./redis-session */ \"(rsc)/./src/lib/redis-session.ts\");\n\n\n// Helper function to refresh tokens\nconst refreshAccessToken = async (token, sessionId)=>{\n    try {\n        // Get refresh token from Redis if sessionId provided\n        let refreshToken = token.refreshToken;\n        if (sessionId) {\n            const session = await (0,_redis_session__WEBPACK_IMPORTED_MODULE_1__.getTokenSession)(sessionId);\n            if (session) {\n                refreshToken = session.refreshToken;\n            }\n        }\n        if (!refreshToken) {\n            throw new Error(\"No refresh token available\");\n        }\n        const tokenUrl = process.env.KEYCLOAK_TOKEN_URL || \"https://keycloak-staging.app-stg.mukuru.io/realms/mukuru/protocol/openid-connect/token\";\n        const response = await fetch(tokenUrl, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/x-www-form-urlencoded\"\n            },\n            body: new URLSearchParams({\n                client_id: process.env.KEYCLOAK_CLIENT_ID || \"kyb-connect-portal\",\n                grant_type: \"refresh_token\",\n                refresh_token: refreshToken,\n                client_secret: process.env.KEYCLOAK_CLIENT_SECRET || \"\"\n            })\n        });\n        const refreshedTokens = await response.json();\n        if (!response.ok) {\n            throw refreshedTokens;\n        }\n        const newAccessToken = refreshedTokens.access_token;\n        const newRefreshToken = refreshedTokens.refresh_token ?? refreshToken;\n        const newExpiryTime = Date.now() + refreshedTokens.expires_in * 1000;\n        // Update Redis if sessionId provided\n        if (sessionId) {\n            await (0,_redis_session__WEBPACK_IMPORTED_MODULE_1__.updateAccessToken)(sessionId, newAccessToken, newExpiryTime);\n            if (newRefreshToken !== refreshToken) {\n                const session = await (0,_redis_session__WEBPACK_IMPORTED_MODULE_1__.getTokenSession)(sessionId);\n                if (session) {\n                    await (0,_redis_session__WEBPACK_IMPORTED_MODULE_1__.storeTokenSession)(sessionId, {\n                        ...session,\n                        refreshToken: newRefreshToken,\n                        accessToken: newAccessToken,\n                        accessTokenExpiryTime: newExpiryTime\n                    });\n                }\n            }\n        }\n        return {\n            ...token,\n            accessToken: newAccessToken,\n            accessTokenExpiryTime: newExpiryTime,\n            refreshToken: newRefreshToken\n        };\n    } catch (error) {\n        console.error(\"Error refreshing access token\", error);\n        return {\n            ...token,\n            error: \"RefreshAccessTokenError\"\n        };\n    }\n};\n// Log configuration on startup for debugging\nconst keycloakConfig = {\n    clientId: process.env.KEYCLOAK_CLIENT_ID || \"kyb-connect-portal\",\n    issuer: process.env.KEYCLOAK_ISSUER || \"https://keycloak-staging.app-stg.mukuru.io/realms/mukuru\",\n    nextAuthUrl: process.env.NEXTAUTH_URL || \"http://localhost:3000\",\n    expectedRedirectUri: `${process.env.NEXTAUTH_URL || \"http://localhost:3000\"}/api/auth/callback/keycloak`\n};\nconsole.log(\"[NextAuth Config] Keycloak Configuration:\", {\n    clientId: keycloakConfig.clientId,\n    issuer: keycloakConfig.issuer,\n    nextAuthUrl: keycloakConfig.nextAuthUrl,\n    expectedRedirectUri: keycloakConfig.expectedRedirectUri,\n    hasClientSecret: !!process.env.KEYCLOAK_CLIENT_SECRET\n});\n// Build provider config - conditionally include clientSecret only if set\nconst keycloakProviderConfig = {\n    clientId: keycloakConfig.clientId,\n    issuer: keycloakConfig.issuer,\n    authorization: {\n        params: {\n            // Ensure openid scope is first - required for id_token\n            scope: \"openid email profile\",\n            // Request access to the kyb-connect resource to get roles\n            audience: \"resource:kyb-connect\"\n        }\n    },\n    wellKnown: process.env.KEYCLOAK_WELL_KNOWN || `${keycloakConfig.issuer}/.well-known/openid-configuration`\n};\n// Only include clientSecret if it's actually set (for confidential clients)\n// For public clients, omit it entirely and use 'none' authentication\nif (process.env.KEYCLOAK_CLIENT_SECRET && process.env.KEYCLOAK_CLIENT_SECRET.trim() !== \"\") {\n    keycloakProviderConfig.clientSecret = process.env.KEYCLOAK_CLIENT_SECRET;\n    console.log(\"[NextAuth Config] Using confidential client (with secret)\");\n} else {\n    // For public clients, configure token endpoint auth method to 'none'\n    // This tells the openid-client library to not send client_secret\n    // The library will still handle PKCE automatically\n    keycloakProviderConfig.client = {\n        token_endpoint_auth_method: \"none\"\n    };\n    console.log(\"[NextAuth Config] Using public client (no secret, token_endpoint_auth_method: none)\");\n}\nconst authOptions = {\n    debug: \"development\" === \"development\",\n    logger: {\n        error (code, metadata) {\n            console.error(\"[NextAuth Error]\", code, metadata);\n        },\n        warn (code) {\n            console.warn(\"[NextAuth Warn]\", code);\n        },\n        debug (code, metadata) {\n            if (true) {\n                console.log(\"[NextAuth Debug]\", code, metadata);\n            }\n        }\n    },\n    providers: [\n        (0,next_auth_providers_keycloak__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(keycloakProviderConfig)\n    ],\n    callbacks: {\n        async signIn ({ user, account, profile }) {\n            // Log sign-in attempt for debugging\n            if (account) {\n                console.log(\"[NextAuth] Sign-in attempt:\", {\n                    provider: account.provider,\n                    type: account.type,\n                    hasAccessToken: !!account.access_token,\n                    hasRefreshToken: !!account.refresh_token\n                });\n            } else {\n                console.error(\"[NextAuth] Sign-in failed - no account object\");\n                return false;\n            }\n            // Note: Role validation happens in JWT callback after token exchange\n            // We don't validate here because id_token might not have resource_access\n            // The access_token will have the roles we need\n            return true;\n        },\n        async redirect ({ url, baseUrl }) {\n            // Log redirects for debugging\n            console.log(\"[NextAuth] Redirect:\", {\n                url,\n                baseUrl,\n                expectedBaseUrl: process.env.NEXTAUTH_URL\n            });\n            // Allows relative callback URLs\n            if (url.startsWith(\"/\")) return `${baseUrl}${url}`;\n            // Allows callback URLs on the same origin\n            if (new URL(url).origin === baseUrl) return url;\n            return baseUrl;\n        },\n        async jwt ({ token, account, user }) {\n            // Initial sign in - store tokens in Redis\n            if (account && user) {\n                console.log(\"[NextAuth] JWT callback - storing tokens:\", {\n                    hasAccessToken: !!account.access_token,\n                    hasRefreshToken: !!account.refresh_token,\n                    expiresAt: account.expires_at,\n                    userEmail: user.email\n                });\n                const sessionId = token.sub || token.jti || `session-${Date.now()}-${Math.random()}`;\n                token.sessionId = sessionId;\n                token.accessTokenExpiryTime = account.expires_at ? account.expires_at * 1000 : Date.now() + 3600 * 1000;\n                // Ensure user object is properly set with all required fields\n                token.user = {\n                    id: user.id || user.email || sessionId,\n                    name: user.name || user.email || \"User\",\n                    email: user.email || undefined,\n                    image: user.image || undefined\n                };\n                // Also store email and name directly in token for fallback\n                token.email = user.email;\n                token.name = user.name || user.email || \"User\";\n                // Store tokens in Redis (not in JWT)\n                if (!account.access_token) {\n                    console.error(\"[NextAuth] No access token received from Keycloak - this will cause Callback error\");\n                    // Don't throw - let NextAuth handle the error, but log it\n                    token.error = \"NoAccessToken\";\n                    return token;\n                }\n                // Validate required role from access token\n                try {\n                    const tokenParts = account.access_token.split(\".\");\n                    if (tokenParts.length === 3) {\n                        const payload = JSON.parse(Buffer.from(tokenParts[1], \"base64\").toString());\n                        const resourceAccess = payload.resource_access || {};\n                        const kybConnectRoles = resourceAccess[\"resource:kyb-connect\"]?.roles || [];\n                        console.log(\"[NextAuth] Token payload resource_access:\", JSON.stringify(resourceAccess, null, 2));\n                        console.log(\"[NextAuth] kyb-connect roles:\", kybConnectRoles);\n                        if (!kybConnectRoles.includes(\"business-user\")) {\n                            console.warn(\"[NextAuth] User missing required role: business-user\");\n                            console.warn(\"[NextAuth] Available roles:\", kybConnectRoles);\n                            console.warn(\"[NextAuth] Full resource_access:\", JSON.stringify(resourceAccess, null, 2));\n                        // Don't fail auth - just log warning for now\n                        // You can uncomment the next lines to enforce role requirement:\n                        // token.error = 'MissingRole';\n                        // return token;\n                        } else {\n                            // Store role info in token for session\n                            token.roles = kybConnectRoles;\n                            console.log(\"[NextAuth] âœ… User has required role: business-user\");\n                        }\n                    }\n                } catch (error) {\n                    console.error(\"[NextAuth] Failed to parse access token for role validation:\", error);\n                // Continue anyway - don't block auth on parsing errors\n                }\n                try {\n                    await (0,_redis_session__WEBPACK_IMPORTED_MODULE_1__.storeTokenSession)(sessionId, {\n                        accessToken: account.access_token,\n                        refreshToken: account.refresh_token || \"\",\n                        accessTokenExpiryTime: token.accessTokenExpiryTime || Date.now() + 3600 * 1000,\n                        provider: \"keycloak\",\n                        userEmail: user.email || undefined,\n                        userId: user.id || user.email || undefined\n                    });\n                    console.log(\"[NextAuth] Tokens stored in Redis successfully\");\n                } catch (error) {\n                    console.error(\"[NextAuth] Failed to store tokens in Redis:\", error);\n                // Don't fail the auth flow if Redis fails - log it but continue\n                // The tokens are still in the account object, so auth can proceed\n                }\n                // DO NOT store accessToken/refreshToken in JWT - only in Redis\n                return token;\n            }\n            // Check if we need to refresh token\n            const sessionId = token.sessionId;\n            if (sessionId) {\n                try {\n                    const redisSession = await (0,_redis_session__WEBPACK_IMPORTED_MODULE_1__.getTokenSession)(sessionId);\n                    if (redisSession) {\n                        // Check if token needs refresh\n                        if (redisSession.accessTokenExpiryTime && Date.now() < redisSession.accessTokenExpiryTime - 60 * 1000) {\n                            // Token still valid\n                            return token;\n                        }\n                        // Token expired, refresh it\n                        return refreshAccessToken(token, sessionId);\n                    }\n                } catch (error) {\n                    console.error(\"[NextAuth] Failed to get Redis session:\", error);\n                // Continue with fallback logic\n                }\n            }\n            // Fallback: if no Redis session, check JWT expiry (legacy support)\n            if (token.accessTokenExpiryTime && Date.now() < token.accessTokenExpiryTime - 60 * 1000) {\n                return token;\n            }\n            // Access token has expired, try to update it\n            try {\n                return refreshAccessToken(token, sessionId);\n            } catch (error) {\n                console.error(\"[NextAuth] Failed to refresh token:\", error);\n                // Return token with error instead of throwing\n                token.error = \"RefreshTokenError\";\n                return token;\n            }\n        },\n        async session ({ session, token }) {\n            try {\n                // DO NOT expose accessToken to frontend - only user info\n                session.user = token.user;\n                session.error = token.error;\n                // session.accessToken is removed - tokens are only in Redis\n                // Log session creation for debugging\n                console.log(\"[NextAuth] Session callback:\", {\n                    hasUser: !!session.user,\n                    userEmail: session.user?.email,\n                    hasError: !!session.error,\n                    error: session.error,\n                    hasSessionId: !!token.sessionId\n                });\n                // Ensure user is set - if not, session will be invalid\n                if (!session.user) {\n                    console.error(\"[NextAuth] Session callback: No user in token! Token keys:\", Object.keys(token));\n                    // Try to get user from token directly\n                    if (token.email || token.name) {\n                        session.user = {\n                            email: token.email,\n                            name: token.name,\n                            id: token.sub\n                        };\n                        console.log(\"[NextAuth] Session callback: Reconstructed user from token\");\n                    } else {\n                        console.error(\"[NextAuth] Session callback: Cannot create valid session - no user data\");\n                    // Return session anyway - let NextAuth handle it\n                    }\n                }\n                if (token.error) {\n                    console.error(\"[NextAuth] Session error:\", token.error);\n                    console.error(\"[NextAuth] Token details:\", {\n                        hasSessionId: !!token.sessionId,\n                        hasUser: !!token.user,\n                        error: token.error\n                    });\n                }\n                return session;\n            } catch (error) {\n                console.error(\"[NextAuth] Session callback error:\", error);\n                console.error(\"[NextAuth] Session callback error stack:\", error?.stack);\n                // Return a minimal session to prevent 500 error\n                return {\n                    ...session,\n                    user: token.user || {\n                        email: token.email,\n                        name: token.name,\n                        id: token.sub\n                    },\n                    error: \"SessionError\"\n                };\n            }\n        }\n    },\n    pages: {\n        signIn: \"/auth/login\"\n    },\n    session: {\n        strategy: \"jwt\",\n        maxAge: 7 * 24 * 60 * 60\n    },\n    cookies: {\n        sessionToken: {\n            name:  false ? 0 : `next-auth.session-token`,\n            options: {\n                httpOnly: true,\n                sameSite: \"lax\",\n                path: \"/\",\n                secure: \"development\" === \"production\"\n            }\n        }\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2F1dGgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQzREO0FBQzRCO0FBRXhGLG9DQUFvQztBQUNwQyxNQUFNSSxxQkFBcUIsT0FBT0MsT0FBWUM7SUFDNUMsSUFBSTtRQUNGLHFEQUFxRDtRQUNyRCxJQUFJQyxlQUFlRixNQUFNRSxZQUFZO1FBQ3JDLElBQUlELFdBQVc7WUFDYixNQUFNRSxVQUFVLE1BQU1OLCtEQUFlQSxDQUFDSTtZQUN0QyxJQUFJRSxTQUFTO2dCQUNYRCxlQUFlQyxRQUFRRCxZQUFZO1lBQ3JDO1FBQ0Y7UUFFQSxJQUFJLENBQUNBLGNBQWM7WUFDakIsTUFBTSxJQUFJRSxNQUFNO1FBQ2xCO1FBRUEsTUFBTUMsV0FBV0MsUUFBUUMsR0FBRyxDQUFDQyxrQkFBa0IsSUFDOUI7UUFFakIsTUFBTUMsV0FBVyxNQUFNQyxNQUFNTCxVQUFVO1lBQ3JDTSxRQUFRO1lBQ1JDLFNBQVM7Z0JBQ1AsZ0JBQWdCO1lBQ2xCO1lBQ0FDLE1BQU0sSUFBSUMsZ0JBQWdCO2dCQUN4QkMsV0FBV1QsUUFBUUMsR0FBRyxDQUFDUyxrQkFBa0IsSUFBSTtnQkFDN0NDLFlBQVk7Z0JBQ1pDLGVBQWVoQjtnQkFDZmlCLGVBQWViLFFBQVFDLEdBQUcsQ0FBQ2Esc0JBQXNCLElBQUk7WUFDdkQ7UUFDRjtRQUVBLE1BQU1DLGtCQUFrQixNQUFNWixTQUFTYSxJQUFJO1FBRTNDLElBQUksQ0FBQ2IsU0FBU2MsRUFBRSxFQUFFO1lBQ2hCLE1BQU1GO1FBQ1I7UUFFQSxNQUFNRyxpQkFBaUJILGdCQUFnQkksWUFBWTtRQUNuRCxNQUFNQyxrQkFBa0JMLGdCQUFnQkgsYUFBYSxJQUFJaEI7UUFDekQsTUFBTXlCLGdCQUFnQkMsS0FBS0MsR0FBRyxLQUFNUixnQkFBZ0JTLFVBQVUsR0FBRztRQUVqRSxxQ0FBcUM7UUFDckMsSUFBSTdCLFdBQVc7WUFDYixNQUFNSCxpRUFBaUJBLENBQUNHLFdBQVd1QixnQkFBZ0JHO1lBQ25ELElBQUlELG9CQUFvQnhCLGNBQWM7Z0JBQ3BDLE1BQU1DLFVBQVUsTUFBTU4sK0RBQWVBLENBQUNJO2dCQUN0QyxJQUFJRSxTQUFTO29CQUNYLE1BQU1QLGlFQUFpQkEsQ0FBQ0ssV0FBVzt3QkFDakMsR0FBR0UsT0FBTzt3QkFDVkQsY0FBY3dCO3dCQUNkSyxhQUFhUDt3QkFDYlEsdUJBQXVCTDtvQkFDekI7Z0JBQ0Y7WUFDRjtRQUNGO1FBRUEsT0FBTztZQUNMLEdBQUczQixLQUFLO1lBQ1IrQixhQUFhUDtZQUNiUSx1QkFBdUJMO1lBQ3ZCekIsY0FBY3dCO1FBQ2hCO0lBQ0YsRUFBRSxPQUFPTyxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQyxpQ0FBaUNBO1FBQy9DLE9BQU87WUFDTCxHQUFHakMsS0FBSztZQUNSaUMsT0FBTztRQUNUO0lBQ0Y7QUFDRjtBQUVBLDZDQUE2QztBQUM3QyxNQUFNRSxpQkFBaUI7SUFDckJDLFVBQVU5QixRQUFRQyxHQUFHLENBQUNTLGtCQUFrQixJQUFJO0lBQzVDcUIsUUFBUS9CLFFBQVFDLEdBQUcsQ0FBQytCLGVBQWUsSUFBSTtJQUN2Q0MsYUFBYWpDLFFBQVFDLEdBQUcsQ0FBQ2lDLFlBQVksSUFBSTtJQUN6Q0MscUJBQXFCLENBQUMsRUFBRW5DLFFBQVFDLEdBQUcsQ0FBQ2lDLFlBQVksSUFBSSx3QkFBd0IsMkJBQTJCLENBQUM7QUFDMUc7QUFFQU4sUUFBUVEsR0FBRyxDQUFDLDZDQUE2QztJQUN2RE4sVUFBVUQsZUFBZUMsUUFBUTtJQUNqQ0MsUUFBUUYsZUFBZUUsTUFBTTtJQUM3QkUsYUFBYUosZUFBZUksV0FBVztJQUN2Q0UscUJBQXFCTixlQUFlTSxtQkFBbUI7SUFDdkRFLGlCQUFpQixDQUFDLENBQUNyQyxRQUFRQyxHQUFHLENBQUNhLHNCQUFzQjtBQUN2RDtBQUVBLHlFQUF5RTtBQUN6RSxNQUFNd0IseUJBQThCO0lBQ2xDUixVQUFVRCxlQUFlQyxRQUFRO0lBQ2pDQyxRQUFRRixlQUFlRSxNQUFNO0lBQzdCUSxlQUFlO1FBQ2JDLFFBQVE7WUFDTix1REFBdUQ7WUFDdkRDLE9BQU87WUFDUCwwREFBMEQ7WUFDMURDLFVBQVU7UUFDWjtJQUNGO0lBQ0FDLFdBQVczQyxRQUFRQyxHQUFHLENBQUMyQyxtQkFBbUIsSUFBSSxDQUFDLEVBQUVmLGVBQWVFLE1BQU0sQ0FBQyxpQ0FBaUMsQ0FBQztBQUMzRztBQUVBLDRFQUE0RTtBQUM1RSxxRUFBcUU7QUFDckUsSUFBSS9CLFFBQVFDLEdBQUcsQ0FBQ2Esc0JBQXNCLElBQUlkLFFBQVFDLEdBQUcsQ0FBQ2Esc0JBQXNCLENBQUMrQixJQUFJLE9BQU8sSUFBSTtJQUMxRlAsdUJBQXVCUSxZQUFZLEdBQUc5QyxRQUFRQyxHQUFHLENBQUNhLHNCQUFzQjtJQUN4RWMsUUFBUVEsR0FBRyxDQUFDO0FBQ2QsT0FBTztJQUNMLHFFQUFxRTtJQUNyRSxpRUFBaUU7SUFDakUsbURBQW1EO0lBQ25ERSx1QkFBdUJTLE1BQU0sR0FBRztRQUM5QkMsNEJBQTRCO0lBQzlCO0lBQ0FwQixRQUFRUSxHQUFHLENBQUM7QUFDZDtBQUVPLE1BQU1hLGNBQStCO0lBQzFDQyxPQUFPbEQsa0JBQXlCO0lBQ2hDbUQsUUFBUTtRQUNOeEIsT0FBTXlCLElBQUksRUFBRUMsUUFBUTtZQUNsQnpCLFFBQVFELEtBQUssQ0FBQyxvQkFBb0J5QixNQUFNQztRQUMxQztRQUNBQyxNQUFLRixJQUFJO1lBQ1B4QixRQUFRMEIsSUFBSSxDQUFDLG1CQUFtQkY7UUFDbEM7UUFDQUYsT0FBTUUsSUFBSSxFQUFFQyxRQUFRO1lBQ2xCLElBQUlyRCxJQUF5QixFQUFlO2dCQUMxQzRCLFFBQVFRLEdBQUcsQ0FBQyxvQkFBb0JnQixNQUFNQztZQUN4QztRQUNGO0lBQ0Y7SUFDQUUsV0FBVztRQUNUbEUsd0VBQWdCQSxDQUFDaUQ7S0FDbEI7SUFDRGtCLFdBQVc7UUFDVCxNQUFNQyxRQUFPLEVBQUVDLElBQUksRUFBRUMsT0FBTyxFQUFFQyxPQUFPLEVBQUU7WUFDckMsb0NBQW9DO1lBQ3BDLElBQUlELFNBQVM7Z0JBQ1gvQixRQUFRUSxHQUFHLENBQUMsK0JBQStCO29CQUN6Q3lCLFVBQVVGLFFBQVFFLFFBQVE7b0JBQzFCQyxNQUFNSCxRQUFRRyxJQUFJO29CQUNsQkMsZ0JBQWdCLENBQUMsQ0FBQ0osUUFBUXhDLFlBQVk7b0JBQ3RDNkMsaUJBQWlCLENBQUMsQ0FBQ0wsUUFBUS9DLGFBQWE7Z0JBQzFDO1lBQ0YsT0FBTztnQkFDTGdCLFFBQVFELEtBQUssQ0FBQztnQkFDZCxPQUFPO1lBQ1Q7WUFFQSxxRUFBcUU7WUFDckUseUVBQXlFO1lBQ3pFLCtDQUErQztZQUMvQyxPQUFPO1FBQ1Q7UUFDQSxNQUFNc0MsVUFBUyxFQUFFQyxHQUFHLEVBQUVDLE9BQU8sRUFBRTtZQUM3Qiw4QkFBOEI7WUFDOUJ2QyxRQUFRUSxHQUFHLENBQUMsd0JBQXdCO2dCQUFFOEI7Z0JBQUtDO2dCQUFTQyxpQkFBaUJwRSxRQUFRQyxHQUFHLENBQUNpQyxZQUFZO1lBQUM7WUFDOUYsZ0NBQWdDO1lBQ2hDLElBQUlnQyxJQUFJRyxVQUFVLENBQUMsTUFBTSxPQUFPLENBQUMsRUFBRUYsUUFBUSxFQUFFRCxJQUFJLENBQUM7WUFDbEQsMENBQTBDO1lBQzFDLElBQUksSUFBSUksSUFBSUosS0FBS0ssTUFBTSxLQUFLSixTQUFTLE9BQU9EO1lBQzVDLE9BQU9DO1FBQ1Q7UUFDQSxNQUFNSyxLQUFJLEVBQUU5RSxLQUFLLEVBQUVpRSxPQUFPLEVBQUVELElBQUksRUFBRTtZQUNoQywwQ0FBMEM7WUFDMUMsSUFBSUMsV0FBV0QsTUFBTTtnQkFDbkI5QixRQUFRUSxHQUFHLENBQUMsNkNBQTZDO29CQUN2RDJCLGdCQUFnQixDQUFDLENBQUNKLFFBQVF4QyxZQUFZO29CQUN0QzZDLGlCQUFpQixDQUFDLENBQUNMLFFBQVEvQyxhQUFhO29CQUN4QzZELFdBQVdkLFFBQVFlLFVBQVU7b0JBQzdCQyxXQUFXakIsS0FBS2tCLEtBQUs7Z0JBQ3ZCO2dCQUVBLE1BQU1qRixZQUFZLE1BQU9rRixHQUFHLElBQWdCbkYsTUFBTW9GLEdBQUcsSUFBZSxDQUFDLFFBQVEsRUFBRXhELEtBQUtDLEdBQUcsR0FBRyxDQUFDLEVBQUV3RCxLQUFLQyxNQUFNLEdBQUcsQ0FBQztnQkFDNUd0RixNQUFNQyxTQUFTLEdBQUdBO2dCQUNsQkQsTUFBTWdDLHFCQUFxQixHQUFHaUMsUUFBUWUsVUFBVSxHQUFHZixRQUFRZSxVQUFVLEdBQUcsT0FBT3BELEtBQUtDLEdBQUcsS0FBSyxPQUFPO2dCQUNuRyw4REFBOEQ7Z0JBQzlEN0IsTUFBTWdFLElBQUksR0FBRztvQkFDWHVCLElBQUl2QixLQUFLdUIsRUFBRSxJQUFJdkIsS0FBS2tCLEtBQUssSUFBSWpGO29CQUM3QnVGLE1BQU14QixLQUFLd0IsSUFBSSxJQUFJeEIsS0FBS2tCLEtBQUssSUFBSTtvQkFDakNBLE9BQU9sQixLQUFLa0IsS0FBSyxJQUFJTztvQkFDckJDLE9BQU8xQixLQUFLMEIsS0FBSyxJQUFJRDtnQkFDdkI7Z0JBQ0EsMkRBQTJEO2dCQUMzRHpGLE1BQU1rRixLQUFLLEdBQUdsQixLQUFLa0IsS0FBSztnQkFDeEJsRixNQUFNd0YsSUFBSSxHQUFHeEIsS0FBS3dCLElBQUksSUFBSXhCLEtBQUtrQixLQUFLLElBQUk7Z0JBRXhDLHFDQUFxQztnQkFDckMsSUFBSSxDQUFDakIsUUFBUXhDLFlBQVksRUFBRTtvQkFDekJTLFFBQVFELEtBQUssQ0FBQztvQkFDZCwwREFBMEQ7b0JBQzFEakMsTUFBTWlDLEtBQUssR0FBRztvQkFDZCxPQUFPakM7Z0JBQ1Q7Z0JBRUEsMkNBQTJDO2dCQUMzQyxJQUFJO29CQUNGLE1BQU0yRixhQUFhMUIsUUFBUXhDLFlBQVksQ0FBQ21FLEtBQUssQ0FBQztvQkFDOUMsSUFBSUQsV0FBV0UsTUFBTSxLQUFLLEdBQUc7d0JBQzNCLE1BQU1DLFVBQVVDLEtBQUtDLEtBQUssQ0FBQ0MsT0FBT0MsSUFBSSxDQUFDUCxVQUFVLENBQUMsRUFBRSxFQUFFLFVBQVVRLFFBQVE7d0JBQ3hFLE1BQU1DLGlCQUFpQk4sUUFBUU8sZUFBZSxJQUFJLENBQUM7d0JBQ25ELE1BQU1DLGtCQUFrQkYsY0FBYyxDQUFDLHVCQUF1QixFQUFFRyxTQUFTLEVBQUU7d0JBRTNFckUsUUFBUVEsR0FBRyxDQUFDLDZDQUE2Q3FELEtBQUtTLFNBQVMsQ0FBQ0osZ0JBQWdCLE1BQU07d0JBQzlGbEUsUUFBUVEsR0FBRyxDQUFDLGlDQUFpQzREO3dCQUU3QyxJQUFJLENBQUNBLGdCQUFnQkcsUUFBUSxDQUFDLGtCQUFrQjs0QkFDOUN2RSxRQUFRMEIsSUFBSSxDQUFDOzRCQUNiMUIsUUFBUTBCLElBQUksQ0FBQywrQkFBK0IwQzs0QkFDNUNwRSxRQUFRMEIsSUFBSSxDQUFDLG9DQUFvQ21DLEtBQUtTLFNBQVMsQ0FBQ0osZ0JBQWdCLE1BQU07d0JBQ3RGLDZDQUE2Qzt3QkFDN0MsZ0VBQWdFO3dCQUNoRSwrQkFBK0I7d0JBQy9CLGdCQUFnQjt3QkFDbEIsT0FBTzs0QkFDTCx1Q0FBdUM7NEJBQ3ZDcEcsTUFBTXVHLEtBQUssR0FBR0Q7NEJBQ2RwRSxRQUFRUSxHQUFHLENBQUM7d0JBQ2Q7b0JBQ0Y7Z0JBQ0YsRUFBRSxPQUFPVCxPQUFPO29CQUNkQyxRQUFRRCxLQUFLLENBQUMsZ0VBQWdFQTtnQkFDOUUsdURBQXVEO2dCQUN6RDtnQkFFQSxJQUFJO29CQUNGLE1BQU1yQyxpRUFBaUJBLENBQUNLLFdBQVc7d0JBQ2pDOEIsYUFBYWtDLFFBQVF4QyxZQUFZO3dCQUNqQ3ZCLGNBQWMrRCxRQUFRL0MsYUFBYSxJQUFJO3dCQUN2Q2MsdUJBQXVCaEMsTUFBTWdDLHFCQUFxQixJQUFJSixLQUFLQyxHQUFHLEtBQUssT0FBTzt3QkFDMUVzQyxVQUFVO3dCQUNWYyxXQUFXakIsS0FBS2tCLEtBQUssSUFBSU87d0JBQ3pCaUIsUUFBUTFDLEtBQUt1QixFQUFFLElBQUl2QixLQUFLa0IsS0FBSyxJQUFJTztvQkFDbkM7b0JBQ0F2RCxRQUFRUSxHQUFHLENBQUM7Z0JBQ2QsRUFBRSxPQUFPVCxPQUFPO29CQUNkQyxRQUFRRCxLQUFLLENBQUMsK0NBQStDQTtnQkFDN0QsZ0VBQWdFO2dCQUNoRSxrRUFBa0U7Z0JBQ3BFO2dCQUVBLCtEQUErRDtnQkFDL0QsT0FBT2pDO1lBQ1Q7WUFFQSxvQ0FBb0M7WUFDcEMsTUFBTUMsWUFBWUQsTUFBTUMsU0FBUztZQUNqQyxJQUFJQSxXQUFXO2dCQUNiLElBQUk7b0JBQ0YsTUFBTTBHLGVBQWUsTUFBTTlHLCtEQUFlQSxDQUFDSTtvQkFDM0MsSUFBSTBHLGNBQWM7d0JBQ2hCLCtCQUErQjt3QkFDL0IsSUFBSUEsYUFBYTNFLHFCQUFxQixJQUFJSixLQUFLQyxHQUFHLEtBQUs4RSxhQUFhM0UscUJBQXFCLEdBQUcsS0FBSyxNQUFNOzRCQUNyRyxvQkFBb0I7NEJBQ3BCLE9BQU9oQzt3QkFDVDt3QkFDQSw0QkFBNEI7d0JBQzVCLE9BQU9ELG1CQUFtQkMsT0FBT0M7b0JBQ25DO2dCQUNGLEVBQUUsT0FBT2dDLE9BQU87b0JBQ2RDLFFBQVFELEtBQUssQ0FBQywyQ0FBMkNBO2dCQUN6RCwrQkFBK0I7Z0JBQ2pDO1lBQ0Y7WUFFQSxtRUFBbUU7WUFDbkUsSUFBSWpDLE1BQU1nQyxxQkFBcUIsSUFBSUosS0FBS0MsR0FBRyxLQUFLN0IsTUFBTWdDLHFCQUFxQixHQUFHLEtBQUssTUFBTTtnQkFDdkYsT0FBT2hDO1lBQ1Q7WUFFQSw2Q0FBNkM7WUFDN0MsSUFBSTtnQkFDRixPQUFPRCxtQkFBbUJDLE9BQU9DO1lBQ25DLEVBQUUsT0FBT2dDLE9BQU87Z0JBQ2RDLFFBQVFELEtBQUssQ0FBQyx1Q0FBdUNBO2dCQUNyRCw4Q0FBOEM7Z0JBQzlDakMsTUFBTWlDLEtBQUssR0FBRztnQkFDZCxPQUFPakM7WUFDVDtRQUNGO1FBQ0EsTUFBTUcsU0FBUSxFQUFFQSxPQUFPLEVBQUVILEtBQUssRUFBRTtZQUM5QixJQUFJO2dCQUNGLHlEQUF5RDtnQkFDekRHLFFBQVE2RCxJQUFJLEdBQUdoRSxNQUFNZ0UsSUFBSTtnQkFDekI3RCxRQUFROEIsS0FBSyxHQUFHakMsTUFBTWlDLEtBQUs7Z0JBQzNCLDREQUE0RDtnQkFFNUQscUNBQXFDO2dCQUNyQ0MsUUFBUVEsR0FBRyxDQUFDLGdDQUFnQztvQkFDMUNrRSxTQUFTLENBQUMsQ0FBQ3pHLFFBQVE2RCxJQUFJO29CQUN2QmlCLFdBQVc5RSxRQUFRNkQsSUFBSSxFQUFFa0I7b0JBQ3pCMkIsVUFBVSxDQUFDLENBQUMxRyxRQUFROEIsS0FBSztvQkFDekJBLE9BQU85QixRQUFROEIsS0FBSztvQkFDcEI2RSxjQUFjLENBQUMsQ0FBQzlHLE1BQU1DLFNBQVM7Z0JBQ2pDO2dCQUVBLHVEQUF1RDtnQkFDdkQsSUFBSSxDQUFDRSxRQUFRNkQsSUFBSSxFQUFFO29CQUNqQjlCLFFBQVFELEtBQUssQ0FBQyw4REFBOEQ4RSxPQUFPQyxJQUFJLENBQUNoSDtvQkFDeEYsc0NBQXNDO29CQUN0QyxJQUFJQSxNQUFNa0YsS0FBSyxJQUFJbEYsTUFBTXdGLElBQUksRUFBRTt3QkFDN0JyRixRQUFRNkQsSUFBSSxHQUFHOzRCQUNia0IsT0FBT2xGLE1BQU1rRixLQUFLOzRCQUNsQk0sTUFBTXhGLE1BQU13RixJQUFJOzRCQUNoQkQsSUFBSXZGLE1BQU1tRixHQUFHO3dCQUNmO3dCQUNBakQsUUFBUVEsR0FBRyxDQUFDO29CQUNkLE9BQU87d0JBQ0xSLFFBQVFELEtBQUssQ0FBQztvQkFDZCxpREFBaUQ7b0JBQ25EO2dCQUNGO2dCQUVBLElBQUlqQyxNQUFNaUMsS0FBSyxFQUFFO29CQUNmQyxRQUFRRCxLQUFLLENBQUMsNkJBQTZCakMsTUFBTWlDLEtBQUs7b0JBQ3REQyxRQUFRRCxLQUFLLENBQUMsNkJBQTZCO3dCQUN6QzZFLGNBQWMsQ0FBQyxDQUFDOUcsTUFBTUMsU0FBUzt3QkFDL0IyRyxTQUFTLENBQUMsQ0FBQzVHLE1BQU1nRSxJQUFJO3dCQUNyQi9CLE9BQU9qQyxNQUFNaUMsS0FBSztvQkFDcEI7Z0JBQ0Y7Z0JBRUEsT0FBTzlCO1lBQ1QsRUFBRSxPQUFPOEIsT0FBWTtnQkFDbkJDLFFBQVFELEtBQUssQ0FBQyxzQ0FBc0NBO2dCQUNwREMsUUFBUUQsS0FBSyxDQUFDLDRDQUE0Q0EsT0FBT2dGO2dCQUNqRSxnREFBZ0Q7Z0JBQ2hELE9BQU87b0JBQ0wsR0FBRzlHLE9BQU87b0JBQ1Y2RCxNQUFNaEUsTUFBTWdFLElBQUksSUFBVzt3QkFDekJrQixPQUFPbEYsTUFBTWtGLEtBQUs7d0JBQ2xCTSxNQUFNeEYsTUFBTXdGLElBQUk7d0JBQ2hCRCxJQUFJdkYsTUFBTW1GLEdBQUc7b0JBQ2Y7b0JBQ0FsRCxPQUFPO2dCQUNUO1lBQ0Y7UUFDRjtJQUNGO0lBQ0FpRixPQUFPO1FBQ0xuRCxRQUFRO0lBQ1Y7SUFDQTVELFNBQVM7UUFDUGdILFVBQVU7UUFDVkMsUUFBUSxJQUFJLEtBQUssS0FBSztJQUN4QjtJQUNBQyxTQUFTO1FBQ1BDLGNBQWM7WUFDWjlCLE1BQU1sRixNQUF5QixHQUMzQixDQUFrQyxHQUNsQyxDQUFDLHVCQUF1QixDQUFDO1lBQzdCaUgsU0FBUztnQkFDUEMsVUFBVTtnQkFDVkMsVUFBVTtnQkFDVkMsTUFBTTtnQkFDTkMsUUFBUXJILGtCQUF5QjtZQUNuQztRQUNGO0lBQ0Y7QUFDRixFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXVrdXJ1LWFwcC8uL3NyYy9saWIvYXV0aC50cz82NjkyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBdXRoT3B0aW9ucyB9IGZyb20gJ25leHQtYXV0aCc7XG5pbXBvcnQgS2V5Y2xvYWtQcm92aWRlciBmcm9tICduZXh0LWF1dGgvcHJvdmlkZXJzL2tleWNsb2FrJztcbmltcG9ydCB7IHN0b3JlVG9rZW5TZXNzaW9uLCBnZXRUb2tlblNlc3Npb24sIHVwZGF0ZUFjY2Vzc1Rva2VuIH0gZnJvbSAnLi9yZWRpcy1zZXNzaW9uJztcblxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIHJlZnJlc2ggdG9rZW5zXG5jb25zdCByZWZyZXNoQWNjZXNzVG9rZW4gPSBhc3luYyAodG9rZW46IGFueSwgc2Vzc2lvbklkPzogc3RyaW5nKSA9PiB7XG4gIHRyeSB7XG4gICAgLy8gR2V0IHJlZnJlc2ggdG9rZW4gZnJvbSBSZWRpcyBpZiBzZXNzaW9uSWQgcHJvdmlkZWRcbiAgICBsZXQgcmVmcmVzaFRva2VuID0gdG9rZW4ucmVmcmVzaFRva2VuO1xuICAgIGlmIChzZXNzaW9uSWQpIHtcbiAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRUb2tlblNlc3Npb24oc2Vzc2lvbklkKTtcbiAgICAgIGlmIChzZXNzaW9uKSB7XG4gICAgICAgIHJlZnJlc2hUb2tlbiA9IHNlc3Npb24ucmVmcmVzaFRva2VuO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghcmVmcmVzaFRva2VuKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHJlZnJlc2ggdG9rZW4gYXZhaWxhYmxlJyk7XG4gICAgfVxuXG4gICAgY29uc3QgdG9rZW5VcmwgPSBwcm9jZXNzLmVudi5LRVlDTE9BS19UT0tFTl9VUkwgfHwgXG4gICAgICAgICAgICAgICAgICAgICAnaHR0cHM6Ly9rZXljbG9hay1zdGFnaW5nLmFwcC1zdGcubXVrdXJ1LmlvL3JlYWxtcy9tdWt1cnUvcHJvdG9jb2wvb3BlbmlkLWNvbm5lY3QvdG9rZW4nO1xuICAgIFxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godG9rZW5VcmwsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcsXG4gICAgICB9LFxuICAgICAgYm9keTogbmV3IFVSTFNlYXJjaFBhcmFtcyh7XG4gICAgICAgIGNsaWVudF9pZDogcHJvY2Vzcy5lbnYuS0VZQ0xPQUtfQ0xJRU5UX0lEIHx8ICdreWItY29ubmVjdC1wb3J0YWwnLFxuICAgICAgICBncmFudF90eXBlOiAncmVmcmVzaF90b2tlbicsXG4gICAgICAgIHJlZnJlc2hfdG9rZW46IHJlZnJlc2hUb2tlbixcbiAgICAgICAgY2xpZW50X3NlY3JldDogcHJvY2Vzcy5lbnYuS0VZQ0xPQUtfQ0xJRU5UX1NFQ1JFVCB8fCAnJyxcbiAgICAgIH0pLFxuICAgIH0pO1xuXG4gICAgY29uc3QgcmVmcmVzaGVkVG9rZW5zID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgdGhyb3cgcmVmcmVzaGVkVG9rZW5zO1xuICAgIH1cblxuICAgIGNvbnN0IG5ld0FjY2Vzc1Rva2VuID0gcmVmcmVzaGVkVG9rZW5zLmFjY2Vzc190b2tlbjtcbiAgICBjb25zdCBuZXdSZWZyZXNoVG9rZW4gPSByZWZyZXNoZWRUb2tlbnMucmVmcmVzaF90b2tlbiA/PyByZWZyZXNoVG9rZW47XG4gICAgY29uc3QgbmV3RXhwaXJ5VGltZSA9IERhdGUubm93KCkgKyAocmVmcmVzaGVkVG9rZW5zLmV4cGlyZXNfaW4gKiAxMDAwKTtcblxuICAgIC8vIFVwZGF0ZSBSZWRpcyBpZiBzZXNzaW9uSWQgcHJvdmlkZWRcbiAgICBpZiAoc2Vzc2lvbklkKSB7XG4gICAgICBhd2FpdCB1cGRhdGVBY2Nlc3NUb2tlbihzZXNzaW9uSWQsIG5ld0FjY2Vzc1Rva2VuLCBuZXdFeHBpcnlUaW1lKTtcbiAgICAgIGlmIChuZXdSZWZyZXNoVG9rZW4gIT09IHJlZnJlc2hUb2tlbikge1xuICAgICAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0VG9rZW5TZXNzaW9uKHNlc3Npb25JZCk7XG4gICAgICAgIGlmIChzZXNzaW9uKSB7XG4gICAgICAgICAgYXdhaXQgc3RvcmVUb2tlblNlc3Npb24oc2Vzc2lvbklkLCB7XG4gICAgICAgICAgICAuLi5zZXNzaW9uLFxuICAgICAgICAgICAgcmVmcmVzaFRva2VuOiBuZXdSZWZyZXNoVG9rZW4sXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbjogbmV3QWNjZXNzVG9rZW4sXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbkV4cGlyeVRpbWU6IG5ld0V4cGlyeVRpbWUsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4udG9rZW4sXG4gICAgICBhY2Nlc3NUb2tlbjogbmV3QWNjZXNzVG9rZW4sXG4gICAgICBhY2Nlc3NUb2tlbkV4cGlyeVRpbWU6IG5ld0V4cGlyeVRpbWUsXG4gICAgICByZWZyZXNoVG9rZW46IG5ld1JlZnJlc2hUb2tlbixcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJlZnJlc2hpbmcgYWNjZXNzIHRva2VuJywgZXJyb3IpO1xuICAgIHJldHVybiB7XG4gICAgICAuLi50b2tlbixcbiAgICAgIGVycm9yOiAnUmVmcmVzaEFjY2Vzc1Rva2VuRXJyb3InLFxuICAgIH07XG4gIH1cbn07XG5cbi8vIExvZyBjb25maWd1cmF0aW9uIG9uIHN0YXJ0dXAgZm9yIGRlYnVnZ2luZ1xuY29uc3Qga2V5Y2xvYWtDb25maWcgPSB7XG4gIGNsaWVudElkOiBwcm9jZXNzLmVudi5LRVlDTE9BS19DTElFTlRfSUQgfHwgJ2t5Yi1jb25uZWN0LXBvcnRhbCcsXG4gIGlzc3VlcjogcHJvY2Vzcy5lbnYuS0VZQ0xPQUtfSVNTVUVSIHx8ICdodHRwczovL2tleWNsb2FrLXN0YWdpbmcuYXBwLXN0Zy5tdWt1cnUuaW8vcmVhbG1zL211a3VydScsXG4gIG5leHRBdXRoVXJsOiBwcm9jZXNzLmVudi5ORVhUQVVUSF9VUkwgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCcsXG4gIGV4cGVjdGVkUmVkaXJlY3RVcmk6IGAke3Byb2Nlc3MuZW52Lk5FWFRBVVRIX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDozMDAwJ30vYXBpL2F1dGgvY2FsbGJhY2sva2V5Y2xvYWtgLFxufTtcblxuY29uc29sZS5sb2coJ1tOZXh0QXV0aCBDb25maWddIEtleWNsb2FrIENvbmZpZ3VyYXRpb246Jywge1xuICBjbGllbnRJZDoga2V5Y2xvYWtDb25maWcuY2xpZW50SWQsXG4gIGlzc3Vlcjoga2V5Y2xvYWtDb25maWcuaXNzdWVyLFxuICBuZXh0QXV0aFVybDoga2V5Y2xvYWtDb25maWcubmV4dEF1dGhVcmwsXG4gIGV4cGVjdGVkUmVkaXJlY3RVcmk6IGtleWNsb2FrQ29uZmlnLmV4cGVjdGVkUmVkaXJlY3RVcmksXG4gIGhhc0NsaWVudFNlY3JldDogISFwcm9jZXNzLmVudi5LRVlDTE9BS19DTElFTlRfU0VDUkVULFxufSk7XG5cbi8vIEJ1aWxkIHByb3ZpZGVyIGNvbmZpZyAtIGNvbmRpdGlvbmFsbHkgaW5jbHVkZSBjbGllbnRTZWNyZXQgb25seSBpZiBzZXRcbmNvbnN0IGtleWNsb2FrUHJvdmlkZXJDb25maWc6IGFueSA9IHtcbiAgY2xpZW50SWQ6IGtleWNsb2FrQ29uZmlnLmNsaWVudElkLFxuICBpc3N1ZXI6IGtleWNsb2FrQ29uZmlnLmlzc3VlcixcbiAgYXV0aG9yaXphdGlvbjoge1xuICAgIHBhcmFtczoge1xuICAgICAgLy8gRW5zdXJlIG9wZW5pZCBzY29wZSBpcyBmaXJzdCAtIHJlcXVpcmVkIGZvciBpZF90b2tlblxuICAgICAgc2NvcGU6ICdvcGVuaWQgZW1haWwgcHJvZmlsZScsXG4gICAgICAvLyBSZXF1ZXN0IGFjY2VzcyB0byB0aGUga3liLWNvbm5lY3QgcmVzb3VyY2UgdG8gZ2V0IHJvbGVzXG4gICAgICBhdWRpZW5jZTogJ3Jlc291cmNlOmt5Yi1jb25uZWN0JyxcbiAgICB9LFxuICB9LFxuICB3ZWxsS25vd246IHByb2Nlc3MuZW52LktFWUNMT0FLX1dFTExfS05PV04gfHwgYCR7a2V5Y2xvYWtDb25maWcuaXNzdWVyfS8ud2VsbC1rbm93bi9vcGVuaWQtY29uZmlndXJhdGlvbmAsXG59O1xuXG4vLyBPbmx5IGluY2x1ZGUgY2xpZW50U2VjcmV0IGlmIGl0J3MgYWN0dWFsbHkgc2V0IChmb3IgY29uZmlkZW50aWFsIGNsaWVudHMpXG4vLyBGb3IgcHVibGljIGNsaWVudHMsIG9taXQgaXQgZW50aXJlbHkgYW5kIHVzZSAnbm9uZScgYXV0aGVudGljYXRpb25cbmlmIChwcm9jZXNzLmVudi5LRVlDTE9BS19DTElFTlRfU0VDUkVUICYmIHByb2Nlc3MuZW52LktFWUNMT0FLX0NMSUVOVF9TRUNSRVQudHJpbSgpICE9PSAnJykge1xuICBrZXljbG9ha1Byb3ZpZGVyQ29uZmlnLmNsaWVudFNlY3JldCA9IHByb2Nlc3MuZW52LktFWUNMT0FLX0NMSUVOVF9TRUNSRVQ7XG4gIGNvbnNvbGUubG9nKCdbTmV4dEF1dGggQ29uZmlnXSBVc2luZyBjb25maWRlbnRpYWwgY2xpZW50ICh3aXRoIHNlY3JldCknKTtcbn0gZWxzZSB7XG4gIC8vIEZvciBwdWJsaWMgY2xpZW50cywgY29uZmlndXJlIHRva2VuIGVuZHBvaW50IGF1dGggbWV0aG9kIHRvICdub25lJ1xuICAvLyBUaGlzIHRlbGxzIHRoZSBvcGVuaWQtY2xpZW50IGxpYnJhcnkgdG8gbm90IHNlbmQgY2xpZW50X3NlY3JldFxuICAvLyBUaGUgbGlicmFyeSB3aWxsIHN0aWxsIGhhbmRsZSBQS0NFIGF1dG9tYXRpY2FsbHlcbiAga2V5Y2xvYWtQcm92aWRlckNvbmZpZy5jbGllbnQgPSB7XG4gICAgdG9rZW5fZW5kcG9pbnRfYXV0aF9tZXRob2Q6ICdub25lJyxcbiAgfTtcbiAgY29uc29sZS5sb2coJ1tOZXh0QXV0aCBDb25maWddIFVzaW5nIHB1YmxpYyBjbGllbnQgKG5vIHNlY3JldCwgdG9rZW5fZW5kcG9pbnRfYXV0aF9tZXRob2Q6IG5vbmUpJyk7XG59XG5cbmV4cG9ydCBjb25zdCBhdXRoT3B0aW9uczogTmV4dEF1dGhPcHRpb25zID0ge1xuICBkZWJ1ZzogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcsIC8vIEVuYWJsZSBkZWJ1ZyBsb2dnaW5nIGluIGRldlxuICBsb2dnZXI6IHtcbiAgICBlcnJvcihjb2RlLCBtZXRhZGF0YSkge1xuICAgICAgY29uc29sZS5lcnJvcignW05leHRBdXRoIEVycm9yXScsIGNvZGUsIG1ldGFkYXRhKTtcbiAgICB9LFxuICAgIHdhcm4oY29kZSkge1xuICAgICAgY29uc29sZS53YXJuKCdbTmV4dEF1dGggV2Fybl0nLCBjb2RlKTtcbiAgICB9LFxuICAgIGRlYnVnKGNvZGUsIG1ldGFkYXRhKSB7XG4gICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1tOZXh0QXV0aCBEZWJ1Z10nLCBjb2RlLCBtZXRhZGF0YSk7XG4gICAgICB9XG4gICAgfSxcbiAgfSxcbiAgcHJvdmlkZXJzOiBbXG4gICAgS2V5Y2xvYWtQcm92aWRlcihrZXljbG9ha1Byb3ZpZGVyQ29uZmlnKSxcbiAgXSxcbiAgY2FsbGJhY2tzOiB7XG4gICAgYXN5bmMgc2lnbkluKHsgdXNlciwgYWNjb3VudCwgcHJvZmlsZSB9KSB7XG4gICAgICAvLyBMb2cgc2lnbi1pbiBhdHRlbXB0IGZvciBkZWJ1Z2dpbmdcbiAgICAgIGlmIChhY2NvdW50KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbTmV4dEF1dGhdIFNpZ24taW4gYXR0ZW1wdDonLCB7XG4gICAgICAgICAgcHJvdmlkZXI6IGFjY291bnQucHJvdmlkZXIsXG4gICAgICAgICAgdHlwZTogYWNjb3VudC50eXBlLFxuICAgICAgICAgIGhhc0FjY2Vzc1Rva2VuOiAhIWFjY291bnQuYWNjZXNzX3Rva2VuLFxuICAgICAgICAgIGhhc1JlZnJlc2hUb2tlbjogISFhY2NvdW50LnJlZnJlc2hfdG9rZW4sXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW05leHRBdXRoXSBTaWduLWluIGZhaWxlZCAtIG5vIGFjY291bnQgb2JqZWN0Jyk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgLy8gTm90ZTogUm9sZSB2YWxpZGF0aW9uIGhhcHBlbnMgaW4gSldUIGNhbGxiYWNrIGFmdGVyIHRva2VuIGV4Y2hhbmdlXG4gICAgICAvLyBXZSBkb24ndCB2YWxpZGF0ZSBoZXJlIGJlY2F1c2UgaWRfdG9rZW4gbWlnaHQgbm90IGhhdmUgcmVzb3VyY2VfYWNjZXNzXG4gICAgICAvLyBUaGUgYWNjZXNzX3Rva2VuIHdpbGwgaGF2ZSB0aGUgcm9sZXMgd2UgbmVlZFxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcbiAgICBhc3luYyByZWRpcmVjdCh7IHVybCwgYmFzZVVybCB9KSB7XG4gICAgICAvLyBMb2cgcmVkaXJlY3RzIGZvciBkZWJ1Z2dpbmdcbiAgICAgIGNvbnNvbGUubG9nKCdbTmV4dEF1dGhdIFJlZGlyZWN0OicsIHsgdXJsLCBiYXNlVXJsLCBleHBlY3RlZEJhc2VVcmw6IHByb2Nlc3MuZW52Lk5FWFRBVVRIX1VSTCB9KTtcbiAgICAgIC8vIEFsbG93cyByZWxhdGl2ZSBjYWxsYmFjayBVUkxzXG4gICAgICBpZiAodXJsLnN0YXJ0c1dpdGgoJy8nKSkgcmV0dXJuIGAke2Jhc2VVcmx9JHt1cmx9YDtcbiAgICAgIC8vIEFsbG93cyBjYWxsYmFjayBVUkxzIG9uIHRoZSBzYW1lIG9yaWdpblxuICAgICAgaWYgKG5ldyBVUkwodXJsKS5vcmlnaW4gPT09IGJhc2VVcmwpIHJldHVybiB1cmw7XG4gICAgICByZXR1cm4gYmFzZVVybDtcbiAgICB9LFxuICAgIGFzeW5jIGp3dCh7IHRva2VuLCBhY2NvdW50LCB1c2VyIH0pIHtcbiAgICAgIC8vIEluaXRpYWwgc2lnbiBpbiAtIHN0b3JlIHRva2VucyBpbiBSZWRpc1xuICAgICAgaWYgKGFjY291bnQgJiYgdXNlcikge1xuICAgICAgICBjb25zb2xlLmxvZygnW05leHRBdXRoXSBKV1QgY2FsbGJhY2sgLSBzdG9yaW5nIHRva2VuczonLCB7XG4gICAgICAgICAgaGFzQWNjZXNzVG9rZW46ICEhYWNjb3VudC5hY2Nlc3NfdG9rZW4sXG4gICAgICAgICAgaGFzUmVmcmVzaFRva2VuOiAhIWFjY291bnQucmVmcmVzaF90b2tlbixcbiAgICAgICAgICBleHBpcmVzQXQ6IGFjY291bnQuZXhwaXJlc19hdCxcbiAgICAgICAgICB1c2VyRW1haWw6IHVzZXIuZW1haWwsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHNlc3Npb25JZCA9ICh0b2tlbi5zdWIgYXMgc3RyaW5nKSB8fCAodG9rZW4uanRpIGFzIHN0cmluZykgfHwgYHNlc3Npb24tJHtEYXRlLm5vdygpfS0ke01hdGgucmFuZG9tKCl9YDtcbiAgICAgICAgdG9rZW4uc2Vzc2lvbklkID0gc2Vzc2lvbklkO1xuICAgICAgICB0b2tlbi5hY2Nlc3NUb2tlbkV4cGlyeVRpbWUgPSBhY2NvdW50LmV4cGlyZXNfYXQgPyBhY2NvdW50LmV4cGlyZXNfYXQgKiAxMDAwIDogRGF0ZS5ub3coKSArIDM2MDAgKiAxMDAwO1xuICAgICAgICAvLyBFbnN1cmUgdXNlciBvYmplY3QgaXMgcHJvcGVybHkgc2V0IHdpdGggYWxsIHJlcXVpcmVkIGZpZWxkc1xuICAgICAgICB0b2tlbi51c2VyID0ge1xuICAgICAgICAgIGlkOiB1c2VyLmlkIHx8IHVzZXIuZW1haWwgfHwgc2Vzc2lvbklkLFxuICAgICAgICAgIG5hbWU6IHVzZXIubmFtZSB8fCB1c2VyLmVtYWlsIHx8ICdVc2VyJyxcbiAgICAgICAgICBlbWFpbDogdXNlci5lbWFpbCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgaW1hZ2U6IHVzZXIuaW1hZ2UgfHwgdW5kZWZpbmVkLFxuICAgICAgICB9O1xuICAgICAgICAvLyBBbHNvIHN0b3JlIGVtYWlsIGFuZCBuYW1lIGRpcmVjdGx5IGluIHRva2VuIGZvciBmYWxsYmFja1xuICAgICAgICB0b2tlbi5lbWFpbCA9IHVzZXIuZW1haWw7XG4gICAgICAgIHRva2VuLm5hbWUgPSB1c2VyLm5hbWUgfHwgdXNlci5lbWFpbCB8fCAnVXNlcic7XG4gICAgICAgIFxuICAgICAgICAvLyBTdG9yZSB0b2tlbnMgaW4gUmVkaXMgKG5vdCBpbiBKV1QpXG4gICAgICAgIGlmICghYWNjb3VudC5hY2Nlc3NfdG9rZW4pIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdbTmV4dEF1dGhdIE5vIGFjY2VzcyB0b2tlbiByZWNlaXZlZCBmcm9tIEtleWNsb2FrIC0gdGhpcyB3aWxsIGNhdXNlIENhbGxiYWNrIGVycm9yJyk7XG4gICAgICAgICAgLy8gRG9uJ3QgdGhyb3cgLSBsZXQgTmV4dEF1dGggaGFuZGxlIHRoZSBlcnJvciwgYnV0IGxvZyBpdFxuICAgICAgICAgIHRva2VuLmVycm9yID0gJ05vQWNjZXNzVG9rZW4nO1xuICAgICAgICAgIHJldHVybiB0b2tlbjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gVmFsaWRhdGUgcmVxdWlyZWQgcm9sZSBmcm9tIGFjY2VzcyB0b2tlblxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHRva2VuUGFydHMgPSBhY2NvdW50LmFjY2Vzc190b2tlbi5zcGxpdCgnLicpO1xuICAgICAgICAgIGlmICh0b2tlblBhcnRzLmxlbmd0aCA9PT0gMykge1xuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IEpTT04ucGFyc2UoQnVmZmVyLmZyb20odG9rZW5QYXJ0c1sxXSwgJ2Jhc2U2NCcpLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgY29uc3QgcmVzb3VyY2VBY2Nlc3MgPSBwYXlsb2FkLnJlc291cmNlX2FjY2VzcyB8fCB7fTtcbiAgICAgICAgICAgIGNvbnN0IGt5YkNvbm5lY3RSb2xlcyA9IHJlc291cmNlQWNjZXNzWydyZXNvdXJjZTpreWItY29ubmVjdCddPy5yb2xlcyB8fCBbXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tOZXh0QXV0aF0gVG9rZW4gcGF5bG9hZCByZXNvdXJjZV9hY2Nlc3M6JywgSlNPTi5zdHJpbmdpZnkocmVzb3VyY2VBY2Nlc3MsIG51bGwsIDIpKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbTmV4dEF1dGhdIGt5Yi1jb25uZWN0IHJvbGVzOicsIGt5YkNvbm5lY3RSb2xlcyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICgha3liQ29ubmVjdFJvbGVzLmluY2x1ZGVzKCdidXNpbmVzcy11c2VyJykpIHtcbiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdbTmV4dEF1dGhdIFVzZXIgbWlzc2luZyByZXF1aXJlZCByb2xlOiBidXNpbmVzcy11c2VyJyk7XG4gICAgICAgICAgICAgIGNvbnNvbGUud2FybignW05leHRBdXRoXSBBdmFpbGFibGUgcm9sZXM6Jywga3liQ29ubmVjdFJvbGVzKTtcbiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdbTmV4dEF1dGhdIEZ1bGwgcmVzb3VyY2VfYWNjZXNzOicsIEpTT04uc3RyaW5naWZ5KHJlc291cmNlQWNjZXNzLCBudWxsLCAyKSk7XG4gICAgICAgICAgICAgIC8vIERvbid0IGZhaWwgYXV0aCAtIGp1c3QgbG9nIHdhcm5pbmcgZm9yIG5vd1xuICAgICAgICAgICAgICAvLyBZb3UgY2FuIHVuY29tbWVudCB0aGUgbmV4dCBsaW5lcyB0byBlbmZvcmNlIHJvbGUgcmVxdWlyZW1lbnQ6XG4gICAgICAgICAgICAgIC8vIHRva2VuLmVycm9yID0gJ01pc3NpbmdSb2xlJztcbiAgICAgICAgICAgICAgLy8gcmV0dXJuIHRva2VuO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gU3RvcmUgcm9sZSBpbmZvIGluIHRva2VuIGZvciBzZXNzaW9uXG4gICAgICAgICAgICAgIHRva2VuLnJvbGVzID0ga3liQ29ubmVjdFJvbGVzO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW05leHRBdXRoXSDinIUgVXNlciBoYXMgcmVxdWlyZWQgcm9sZTogYnVzaW5lc3MtdXNlcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdbTmV4dEF1dGhdIEZhaWxlZCB0byBwYXJzZSBhY2Nlc3MgdG9rZW4gZm9yIHJvbGUgdmFsaWRhdGlvbjonLCBlcnJvcik7XG4gICAgICAgICAgLy8gQ29udGludWUgYW55d2F5IC0gZG9uJ3QgYmxvY2sgYXV0aCBvbiBwYXJzaW5nIGVycm9yc1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IHN0b3JlVG9rZW5TZXNzaW9uKHNlc3Npb25JZCwge1xuICAgICAgICAgICAgYWNjZXNzVG9rZW46IGFjY291bnQuYWNjZXNzX3Rva2VuLFxuICAgICAgICAgICAgcmVmcmVzaFRva2VuOiBhY2NvdW50LnJlZnJlc2hfdG9rZW4gfHwgJycsXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbkV4cGlyeVRpbWU6IHRva2VuLmFjY2Vzc1Rva2VuRXhwaXJ5VGltZSB8fCBEYXRlLm5vdygpICsgMzYwMCAqIDEwMDAsXG4gICAgICAgICAgICBwcm92aWRlcjogJ2tleWNsb2FrJyxcbiAgICAgICAgICAgIHVzZXJFbWFpbDogdXNlci5lbWFpbCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICB1c2VySWQ6IHVzZXIuaWQgfHwgdXNlci5lbWFpbCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1tOZXh0QXV0aF0gVG9rZW5zIHN0b3JlZCBpbiBSZWRpcyBzdWNjZXNzZnVsbHknKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdbTmV4dEF1dGhdIEZhaWxlZCB0byBzdG9yZSB0b2tlbnMgaW4gUmVkaXM6JywgZXJyb3IpO1xuICAgICAgICAgIC8vIERvbid0IGZhaWwgdGhlIGF1dGggZmxvdyBpZiBSZWRpcyBmYWlscyAtIGxvZyBpdCBidXQgY29udGludWVcbiAgICAgICAgICAvLyBUaGUgdG9rZW5zIGFyZSBzdGlsbCBpbiB0aGUgYWNjb3VudCBvYmplY3QsIHNvIGF1dGggY2FuIHByb2NlZWRcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gRE8gTk9UIHN0b3JlIGFjY2Vzc1Rva2VuL3JlZnJlc2hUb2tlbiBpbiBKV1QgLSBvbmx5IGluIFJlZGlzXG4gICAgICAgIHJldHVybiB0b2tlbjtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgd2UgbmVlZCB0byByZWZyZXNoIHRva2VuXG4gICAgICBjb25zdCBzZXNzaW9uSWQgPSB0b2tlbi5zZXNzaW9uSWQgYXMgc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgICAgaWYgKHNlc3Npb25JZCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHJlZGlzU2Vzc2lvbiA9IGF3YWl0IGdldFRva2VuU2Vzc2lvbihzZXNzaW9uSWQpO1xuICAgICAgICAgIGlmIChyZWRpc1Nlc3Npb24pIHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHRva2VuIG5lZWRzIHJlZnJlc2hcbiAgICAgICAgICAgIGlmIChyZWRpc1Nlc3Npb24uYWNjZXNzVG9rZW5FeHBpcnlUaW1lICYmIERhdGUubm93KCkgPCByZWRpc1Nlc3Npb24uYWNjZXNzVG9rZW5FeHBpcnlUaW1lIC0gNjAgKiAxMDAwKSB7XG4gICAgICAgICAgICAgIC8vIFRva2VuIHN0aWxsIHZhbGlkXG4gICAgICAgICAgICAgIHJldHVybiB0b2tlbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFRva2VuIGV4cGlyZWQsIHJlZnJlc2ggaXRcbiAgICAgICAgICAgIHJldHVybiByZWZyZXNoQWNjZXNzVG9rZW4odG9rZW4sIHNlc3Npb25JZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tOZXh0QXV0aF0gRmFpbGVkIHRvIGdldCBSZWRpcyBzZXNzaW9uOicsIGVycm9yKTtcbiAgICAgICAgICAvLyBDb250aW51ZSB3aXRoIGZhbGxiYWNrIGxvZ2ljXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gRmFsbGJhY2s6IGlmIG5vIFJlZGlzIHNlc3Npb24sIGNoZWNrIEpXVCBleHBpcnkgKGxlZ2FjeSBzdXBwb3J0KVxuICAgICAgaWYgKHRva2VuLmFjY2Vzc1Rva2VuRXhwaXJ5VGltZSAmJiBEYXRlLm5vdygpIDwgdG9rZW4uYWNjZXNzVG9rZW5FeHBpcnlUaW1lIC0gNjAgKiAxMDAwKSB7XG4gICAgICAgIHJldHVybiB0b2tlbjtcbiAgICAgIH1cblxuICAgICAgLy8gQWNjZXNzIHRva2VuIGhhcyBleHBpcmVkLCB0cnkgdG8gdXBkYXRlIGl0XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gcmVmcmVzaEFjY2Vzc1Rva2VuKHRva2VuLCBzZXNzaW9uSWQpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW05leHRBdXRoXSBGYWlsZWQgdG8gcmVmcmVzaCB0b2tlbjonLCBlcnJvcik7XG4gICAgICAgIC8vIFJldHVybiB0b2tlbiB3aXRoIGVycm9yIGluc3RlYWQgb2YgdGhyb3dpbmdcbiAgICAgICAgdG9rZW4uZXJyb3IgPSAnUmVmcmVzaFRva2VuRXJyb3InO1xuICAgICAgICByZXR1cm4gdG9rZW47XG4gICAgICB9XG4gICAgfSxcbiAgICBhc3luYyBzZXNzaW9uKHsgc2Vzc2lvbiwgdG9rZW4gfSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gRE8gTk9UIGV4cG9zZSBhY2Nlc3NUb2tlbiB0byBmcm9udGVuZCAtIG9ubHkgdXNlciBpbmZvXG4gICAgICAgIHNlc3Npb24udXNlciA9IHRva2VuLnVzZXIgYXMgYW55O1xuICAgICAgICBzZXNzaW9uLmVycm9yID0gdG9rZW4uZXJyb3IgYXMgc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgICAgICAvLyBzZXNzaW9uLmFjY2Vzc1Rva2VuIGlzIHJlbW92ZWQgLSB0b2tlbnMgYXJlIG9ubHkgaW4gUmVkaXNcbiAgICAgICAgXG4gICAgICAgIC8vIExvZyBzZXNzaW9uIGNyZWF0aW9uIGZvciBkZWJ1Z2dpbmdcbiAgICAgICAgY29uc29sZS5sb2coJ1tOZXh0QXV0aF0gU2Vzc2lvbiBjYWxsYmFjazonLCB7XG4gICAgICAgICAgaGFzVXNlcjogISFzZXNzaW9uLnVzZXIsXG4gICAgICAgICAgdXNlckVtYWlsOiBzZXNzaW9uLnVzZXI/LmVtYWlsLFxuICAgICAgICAgIGhhc0Vycm9yOiAhIXNlc3Npb24uZXJyb3IsXG4gICAgICAgICAgZXJyb3I6IHNlc3Npb24uZXJyb3IsXG4gICAgICAgICAgaGFzU2Vzc2lvbklkOiAhIXRva2VuLnNlc3Npb25JZCxcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBFbnN1cmUgdXNlciBpcyBzZXQgLSBpZiBub3QsIHNlc3Npb24gd2lsbCBiZSBpbnZhbGlkXG4gICAgICAgIGlmICghc2Vzc2lvbi51c2VyKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignW05leHRBdXRoXSBTZXNzaW9uIGNhbGxiYWNrOiBObyB1c2VyIGluIHRva2VuISBUb2tlbiBrZXlzOicsIE9iamVjdC5rZXlzKHRva2VuKSk7XG4gICAgICAgICAgLy8gVHJ5IHRvIGdldCB1c2VyIGZyb20gdG9rZW4gZGlyZWN0bHlcbiAgICAgICAgICBpZiAodG9rZW4uZW1haWwgfHwgdG9rZW4ubmFtZSkge1xuICAgICAgICAgICAgc2Vzc2lvbi51c2VyID0ge1xuICAgICAgICAgICAgICBlbWFpbDogdG9rZW4uZW1haWwgYXMgc3RyaW5nLFxuICAgICAgICAgICAgICBuYW1lOiB0b2tlbi5uYW1lIGFzIHN0cmluZyxcbiAgICAgICAgICAgICAgaWQ6IHRva2VuLnN1YiBhcyBzdHJpbmcsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tOZXh0QXV0aF0gU2Vzc2lvbiBjYWxsYmFjazogUmVjb25zdHJ1Y3RlZCB1c2VyIGZyb20gdG9rZW4nKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignW05leHRBdXRoXSBTZXNzaW9uIGNhbGxiYWNrOiBDYW5ub3QgY3JlYXRlIHZhbGlkIHNlc3Npb24gLSBubyB1c2VyIGRhdGEnKTtcbiAgICAgICAgICAgIC8vIFJldHVybiBzZXNzaW9uIGFueXdheSAtIGxldCBOZXh0QXV0aCBoYW5kbGUgaXRcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmICh0b2tlbi5lcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tOZXh0QXV0aF0gU2Vzc2lvbiBlcnJvcjonLCB0b2tlbi5lcnJvcik7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignW05leHRBdXRoXSBUb2tlbiBkZXRhaWxzOicsIHtcbiAgICAgICAgICAgIGhhc1Nlc3Npb25JZDogISF0b2tlbi5zZXNzaW9uSWQsXG4gICAgICAgICAgICBoYXNVc2VyOiAhIXRva2VuLnVzZXIsXG4gICAgICAgICAgICBlcnJvcjogdG9rZW4uZXJyb3IsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBzZXNzaW9uO1xuICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbTmV4dEF1dGhdIFNlc3Npb24gY2FsbGJhY2sgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbTmV4dEF1dGhdIFNlc3Npb24gY2FsbGJhY2sgZXJyb3Igc3RhY2s6JywgZXJyb3I/LnN0YWNrKTtcbiAgICAgICAgLy8gUmV0dXJuIGEgbWluaW1hbCBzZXNzaW9uIHRvIHByZXZlbnQgNTAwIGVycm9yXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgLi4uc2Vzc2lvbixcbiAgICAgICAgICB1c2VyOiB0b2tlbi51c2VyIGFzIGFueSB8fCB7XG4gICAgICAgICAgICBlbWFpbDogdG9rZW4uZW1haWwgYXMgc3RyaW5nLFxuICAgICAgICAgICAgbmFtZTogdG9rZW4ubmFtZSBhcyBzdHJpbmcsXG4gICAgICAgICAgICBpZDogdG9rZW4uc3ViIGFzIHN0cmluZyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yOiAnU2Vzc2lvbkVycm9yJyxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9LFxuICB9LFxuICBwYWdlczoge1xuICAgIHNpZ25JbjogJy9hdXRoL2xvZ2luJyxcbiAgfSxcbiAgc2Vzc2lvbjoge1xuICAgIHN0cmF0ZWd5OiAnand0JyxcbiAgICBtYXhBZ2U6IDcgKiAyNCAqIDYwICogNjAsIC8vIDcgZGF5c1xuICB9LFxuICBjb29raWVzOiB7XG4gICAgc2Vzc2lvblRva2VuOiB7XG4gICAgICBuYW1lOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nIFxuICAgICAgICA/IGBfX1NlY3VyZS1uZXh0LWF1dGguc2Vzc2lvbi10b2tlbmBcbiAgICAgICAgOiBgbmV4dC1hdXRoLnNlc3Npb24tdG9rZW5gLFxuICAgICAgb3B0aW9uczoge1xuICAgICAgICBodHRwT25seTogdHJ1ZSxcbiAgICAgICAgc2FtZVNpdGU6ICdsYXgnLFxuICAgICAgICBwYXRoOiAnLycsXG4gICAgICAgIHNlY3VyZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJyxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSxcbn07XG5cbiJdLCJuYW1lcyI6WyJLZXljbG9ha1Byb3ZpZGVyIiwic3RvcmVUb2tlblNlc3Npb24iLCJnZXRUb2tlblNlc3Npb24iLCJ1cGRhdGVBY2Nlc3NUb2tlbiIsInJlZnJlc2hBY2Nlc3NUb2tlbiIsInRva2VuIiwic2Vzc2lvbklkIiwicmVmcmVzaFRva2VuIiwic2Vzc2lvbiIsIkVycm9yIiwidG9rZW5VcmwiLCJwcm9jZXNzIiwiZW52IiwiS0VZQ0xPQUtfVE9LRU5fVVJMIiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJib2R5IiwiVVJMU2VhcmNoUGFyYW1zIiwiY2xpZW50X2lkIiwiS0VZQ0xPQUtfQ0xJRU5UX0lEIiwiZ3JhbnRfdHlwZSIsInJlZnJlc2hfdG9rZW4iLCJjbGllbnRfc2VjcmV0IiwiS0VZQ0xPQUtfQ0xJRU5UX1NFQ1JFVCIsInJlZnJlc2hlZFRva2VucyIsImpzb24iLCJvayIsIm5ld0FjY2Vzc1Rva2VuIiwiYWNjZXNzX3Rva2VuIiwibmV3UmVmcmVzaFRva2VuIiwibmV3RXhwaXJ5VGltZSIsIkRhdGUiLCJub3ciLCJleHBpcmVzX2luIiwiYWNjZXNzVG9rZW4iLCJhY2Nlc3NUb2tlbkV4cGlyeVRpbWUiLCJlcnJvciIsImNvbnNvbGUiLCJrZXljbG9ha0NvbmZpZyIsImNsaWVudElkIiwiaXNzdWVyIiwiS0VZQ0xPQUtfSVNTVUVSIiwibmV4dEF1dGhVcmwiLCJORVhUQVVUSF9VUkwiLCJleHBlY3RlZFJlZGlyZWN0VXJpIiwibG9nIiwiaGFzQ2xpZW50U2VjcmV0Iiwia2V5Y2xvYWtQcm92aWRlckNvbmZpZyIsImF1dGhvcml6YXRpb24iLCJwYXJhbXMiLCJzY29wZSIsImF1ZGllbmNlIiwid2VsbEtub3duIiwiS0VZQ0xPQUtfV0VMTF9LTk9XTiIsInRyaW0iLCJjbGllbnRTZWNyZXQiLCJjbGllbnQiLCJ0b2tlbl9lbmRwb2ludF9hdXRoX21ldGhvZCIsImF1dGhPcHRpb25zIiwiZGVidWciLCJsb2dnZXIiLCJjb2RlIiwibWV0YWRhdGEiLCJ3YXJuIiwicHJvdmlkZXJzIiwiY2FsbGJhY2tzIiwic2lnbkluIiwidXNlciIsImFjY291bnQiLCJwcm9maWxlIiwicHJvdmlkZXIiLCJ0eXBlIiwiaGFzQWNjZXNzVG9rZW4iLCJoYXNSZWZyZXNoVG9rZW4iLCJyZWRpcmVjdCIsInVybCIsImJhc2VVcmwiLCJleHBlY3RlZEJhc2VVcmwiLCJzdGFydHNXaXRoIiwiVVJMIiwib3JpZ2luIiwiand0IiwiZXhwaXJlc0F0IiwiZXhwaXJlc19hdCIsInVzZXJFbWFpbCIsImVtYWlsIiwic3ViIiwianRpIiwiTWF0aCIsInJhbmRvbSIsImlkIiwibmFtZSIsInVuZGVmaW5lZCIsImltYWdlIiwidG9rZW5QYXJ0cyIsInNwbGl0IiwibGVuZ3RoIiwicGF5bG9hZCIsIkpTT04iLCJwYXJzZSIsIkJ1ZmZlciIsImZyb20iLCJ0b1N0cmluZyIsInJlc291cmNlQWNjZXNzIiwicmVzb3VyY2VfYWNjZXNzIiwia3liQ29ubmVjdFJvbGVzIiwicm9sZXMiLCJzdHJpbmdpZnkiLCJpbmNsdWRlcyIsInVzZXJJZCIsInJlZGlzU2Vzc2lvbiIsImhhc1VzZXIiLCJoYXNFcnJvciIsImhhc1Nlc3Npb25JZCIsIk9iamVjdCIsImtleXMiLCJzdGFjayIsInBhZ2VzIiwic3RyYXRlZ3kiLCJtYXhBZ2UiLCJjb29raWVzIiwic2Vzc2lvblRva2VuIiwib3B0aW9ucyIsImh0dHBPbmx5Iiwic2FtZVNpdGUiLCJwYXRoIiwic2VjdXJlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/redis-session.ts":
/*!**********************************!*\
  !*** ./src/lib/redis-session.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   deleteTokenSession: () => (/* binding */ deleteTokenSession),\n/* harmony export */   getRedisClient: () => (/* binding */ getRedisClient),\n/* harmony export */   getTokenSession: () => (/* binding */ getTokenSession),\n/* harmony export */   storeTokenSession: () => (/* binding */ storeTokenSession),\n/* harmony export */   updateAccessToken: () => (/* binding */ updateAccessToken)\n/* harmony export */ });\n/* harmony import */ var redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! redis */ \"(rsc)/./node_modules/redis/dist/index.js\");\n/* harmony import */ var redis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(redis__WEBPACK_IMPORTED_MODULE_0__);\n\n// Redis client singleton\nlet redisClient = null;\nasync function getRedisClient() {\n    if (redisClient && redisClient.isOpen) {\n        return redisClient;\n    }\n    const redisUrl = process.env.REDIS_URL || \"redis://localhost:6379\";\n    redisClient = (0,redis__WEBPACK_IMPORTED_MODULE_0__.createClient)({\n        url: redisUrl\n    });\n    redisClient.on(\"error\", (err)=>console.error(\"Redis Client Error\", err));\n    redisClient.on(\"connect\", ()=>console.log(\"Redis Client Connected\"));\n    if (!redisClient.isOpen) {\n        await redisClient.connect();\n    }\n    return redisClient;\n}\nconst SESSION_PREFIX = \"session:\";\nconst TTL_SECONDS = 7 * 24 * 60 * 60; // 7 days\n/**\n * Store IdP tokens in Redis, keyed by session ID\n */ async function storeTokenSession(sessionId, tokens) {\n    try {\n        const client = await getRedisClient();\n        const key = `${SESSION_PREFIX}${sessionId}`;\n        await client.setEx(key, TTL_SECONDS, JSON.stringify(tokens));\n        console.log(`[Redis] Stored token session: ${key}`);\n    } catch (error) {\n        console.error(\"[Redis] Failed to store token session:\", error);\n        throw error; // Re-throw so caller knows it failed\n    }\n}\n/**\n * Retrieve IdP tokens from Redis by session ID\n */ async function getTokenSession(sessionId) {\n    try {\n        const client = await getRedisClient();\n        const key = `${SESSION_PREFIX}${sessionId}`;\n        const data = await client.get(key);\n        if (!data) return null;\n        return JSON.parse(data);\n    } catch (error) {\n        console.error(\"[Redis] Failed to get token session:\", error);\n        return null; // Return null instead of throwing\n    }\n}\n/**\n * Delete token session from Redis\n */ async function deleteTokenSession(sessionId) {\n    const client = await getRedisClient();\n    const key = `${SESSION_PREFIX}${sessionId}`;\n    await client.del(key);\n}\n/**\n * Update access token (for refresh scenarios)\n */ async function updateAccessToken(sessionId, accessToken, accessTokenExpiryTime) {\n    const session = await getTokenSession(sessionId);\n    if (!session) {\n        throw new Error(\"Session not found\");\n    }\n    await storeTokenSession(sessionId, {\n        ...session,\n        accessToken,\n        accessTokenExpiryTime\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3JlZGlzLXNlc3Npb24udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFxQztBQUVyQyx5QkFBeUI7QUFDekIsSUFBSUMsY0FBc0Q7QUFFbkQsZUFBZUM7SUFDcEIsSUFBSUQsZUFBZUEsWUFBWUUsTUFBTSxFQUFFO1FBQ3JDLE9BQU9GO0lBQ1Q7SUFFQSxNQUFNRyxXQUFXQyxRQUFRQyxHQUFHLENBQUNDLFNBQVMsSUFBSTtJQUMxQ04sY0FBY0QsbURBQVlBLENBQUM7UUFBRVEsS0FBS0o7SUFBUztJQUUzQ0gsWUFBWVEsRUFBRSxDQUFDLFNBQVMsQ0FBQ0MsTUFBUUMsUUFBUUMsS0FBSyxDQUFDLHNCQUFzQkY7SUFDckVULFlBQVlRLEVBQUUsQ0FBQyxXQUFXLElBQU1FLFFBQVFFLEdBQUcsQ0FBQztJQUU1QyxJQUFJLENBQUNaLFlBQVlFLE1BQU0sRUFBRTtRQUN2QixNQUFNRixZQUFZYSxPQUFPO0lBQzNCO0lBRUEsT0FBT2I7QUFDVDtBQVdBLE1BQU1jLGlCQUFpQjtBQUN2QixNQUFNQyxjQUFjLElBQUksS0FBSyxLQUFLLElBQUksU0FBUztBQUUvQzs7Q0FFQyxHQUNNLGVBQWVDLGtCQUNwQkMsU0FBaUIsRUFDakJDLE1BQW9CO0lBRXBCLElBQUk7UUFDRixNQUFNQyxTQUFTLE1BQU1sQjtRQUNyQixNQUFNbUIsTUFBTSxDQUFDLEVBQUVOLGVBQWUsRUFBRUcsVUFBVSxDQUFDO1FBQzNDLE1BQU1FLE9BQU9FLEtBQUssQ0FBQ0QsS0FBS0wsYUFBYU8sS0FBS0MsU0FBUyxDQUFDTDtRQUNwRFIsUUFBUUUsR0FBRyxDQUFDLENBQUMsOEJBQThCLEVBQUVRLElBQUksQ0FBQztJQUNwRCxFQUFFLE9BQU9ULE9BQU87UUFDZEQsUUFBUUMsS0FBSyxDQUFDLDBDQUEwQ0E7UUFDeEQsTUFBTUEsT0FBTyxxQ0FBcUM7SUFDcEQ7QUFDRjtBQUVBOztDQUVDLEdBQ00sZUFBZWEsZ0JBQ3BCUCxTQUFpQjtJQUVqQixJQUFJO1FBQ0YsTUFBTUUsU0FBUyxNQUFNbEI7UUFDckIsTUFBTW1CLE1BQU0sQ0FBQyxFQUFFTixlQUFlLEVBQUVHLFVBQVUsQ0FBQztRQUMzQyxNQUFNUSxPQUFPLE1BQU1OLE9BQU9PLEdBQUcsQ0FBQ047UUFDOUIsSUFBSSxDQUFDSyxNQUFNLE9BQU87UUFDbEIsT0FBT0gsS0FBS0ssS0FBSyxDQUFDRjtJQUNwQixFQUFFLE9BQU9kLE9BQU87UUFDZEQsUUFBUUMsS0FBSyxDQUFDLHdDQUF3Q0E7UUFDdEQsT0FBTyxNQUFNLGtDQUFrQztJQUNqRDtBQUNGO0FBRUE7O0NBRUMsR0FDTSxlQUFlaUIsbUJBQW1CWCxTQUFpQjtJQUN4RCxNQUFNRSxTQUFTLE1BQU1sQjtJQUNyQixNQUFNbUIsTUFBTSxDQUFDLEVBQUVOLGVBQWUsRUFBRUcsVUFBVSxDQUFDO0lBQzNDLE1BQU1FLE9BQU9VLEdBQUcsQ0FBQ1Q7QUFDbkI7QUFFQTs7Q0FFQyxHQUNNLGVBQWVVLGtCQUNwQmIsU0FBaUIsRUFDakJjLFdBQW1CLEVBQ25CQyxxQkFBNkI7SUFFN0IsTUFBTUMsVUFBVSxNQUFNVCxnQkFBZ0JQO0lBQ3RDLElBQUksQ0FBQ2dCLFNBQVM7UUFDWixNQUFNLElBQUlDLE1BQU07SUFDbEI7SUFDQSxNQUFNbEIsa0JBQWtCQyxXQUFXO1FBQ2pDLEdBQUdnQixPQUFPO1FBQ1ZGO1FBQ0FDO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL211a3VydS1hcHAvLi9zcmMvbGliL3JlZGlzLXNlc3Npb24udHM/M2EzYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdyZWRpcyc7XG5cbi8vIFJlZGlzIGNsaWVudCBzaW5nbGV0b25cbmxldCByZWRpc0NsaWVudDogUmV0dXJuVHlwZTx0eXBlb2YgY3JlYXRlQ2xpZW50PiB8IG51bGwgPSBudWxsO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UmVkaXNDbGllbnQoKSB7XG4gIGlmIChyZWRpc0NsaWVudCAmJiByZWRpc0NsaWVudC5pc09wZW4pIHtcbiAgICByZXR1cm4gcmVkaXNDbGllbnQ7XG4gIH1cblxuICBjb25zdCByZWRpc1VybCA9IHByb2Nlc3MuZW52LlJFRElTX1VSTCB8fCAncmVkaXM6Ly9sb2NhbGhvc3Q6NjM3OSc7XG4gIHJlZGlzQ2xpZW50ID0gY3JlYXRlQ2xpZW50KHsgdXJsOiByZWRpc1VybCB9KTtcblxuICByZWRpc0NsaWVudC5vbignZXJyb3InLCAoZXJyKSA9PiBjb25zb2xlLmVycm9yKCdSZWRpcyBDbGllbnQgRXJyb3InLCBlcnIpKTtcbiAgcmVkaXNDbGllbnQub24oJ2Nvbm5lY3QnLCAoKSA9PiBjb25zb2xlLmxvZygnUmVkaXMgQ2xpZW50IENvbm5lY3RlZCcpKTtcblxuICBpZiAoIXJlZGlzQ2xpZW50LmlzT3Blbikge1xuICAgIGF3YWl0IHJlZGlzQ2xpZW50LmNvbm5lY3QoKTtcbiAgfVxuXG4gIHJldHVybiByZWRpc0NsaWVudDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUb2tlblNlc3Npb24ge1xuICBhY2Nlc3NUb2tlbjogc3RyaW5nO1xuICByZWZyZXNoVG9rZW46IHN0cmluZztcbiAgYWNjZXNzVG9rZW5FeHBpcnlUaW1lOiBudW1iZXI7XG4gIHByb3ZpZGVyOiAnYXp1cmUtYWQnIHwgJ2tleWNsb2FrJztcbiAgdXNlckVtYWlsPzogc3RyaW5nO1xuICB1c2VySWQ/OiBzdHJpbmc7XG59XG5cbmNvbnN0IFNFU1NJT05fUFJFRklYID0gJ3Nlc3Npb246JztcbmNvbnN0IFRUTF9TRUNPTkRTID0gNyAqIDI0ICogNjAgKiA2MDsgLy8gNyBkYXlzXG5cbi8qKlxuICogU3RvcmUgSWRQIHRva2VucyBpbiBSZWRpcywga2V5ZWQgYnkgc2Vzc2lvbiBJRFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc3RvcmVUb2tlblNlc3Npb24oXG4gIHNlc3Npb25JZDogc3RyaW5nLFxuICB0b2tlbnM6IFRva2VuU2Vzc2lvblxuKTogUHJvbWlzZTx2b2lkPiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY2xpZW50ID0gYXdhaXQgZ2V0UmVkaXNDbGllbnQoKTtcbiAgICBjb25zdCBrZXkgPSBgJHtTRVNTSU9OX1BSRUZJWH0ke3Nlc3Npb25JZH1gO1xuICAgIGF3YWl0IGNsaWVudC5zZXRFeChrZXksIFRUTF9TRUNPTkRTLCBKU09OLnN0cmluZ2lmeSh0b2tlbnMpKTtcbiAgICBjb25zb2xlLmxvZyhgW1JlZGlzXSBTdG9yZWQgdG9rZW4gc2Vzc2lvbjogJHtrZXl9YCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1JlZGlzXSBGYWlsZWQgdG8gc3RvcmUgdG9rZW4gc2Vzc2lvbjonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7IC8vIFJlLXRocm93IHNvIGNhbGxlciBrbm93cyBpdCBmYWlsZWRcbiAgfVxufVxuXG4vKipcbiAqIFJldHJpZXZlIElkUCB0b2tlbnMgZnJvbSBSZWRpcyBieSBzZXNzaW9uIElEXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRUb2tlblNlc3Npb24oXG4gIHNlc3Npb25JZDogc3RyaW5nXG4pOiBQcm9taXNlPFRva2VuU2Vzc2lvbiB8IG51bGw+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBnZXRSZWRpc0NsaWVudCgpO1xuICAgIGNvbnN0IGtleSA9IGAke1NFU1NJT05fUFJFRklYfSR7c2Vzc2lvbklkfWA7XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IGNsaWVudC5nZXQoa2V5KTtcbiAgICBpZiAoIWRhdGEpIHJldHVybiBudWxsO1xuICAgIHJldHVybiBKU09OLnBhcnNlKGRhdGEpIGFzIFRva2VuU2Vzc2lvbjtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbUmVkaXNdIEZhaWxlZCB0byBnZXQgdG9rZW4gc2Vzc2lvbjonLCBlcnJvcik7XG4gICAgcmV0dXJuIG51bGw7IC8vIFJldHVybiBudWxsIGluc3RlYWQgb2YgdGhyb3dpbmdcbiAgfVxufVxuXG4vKipcbiAqIERlbGV0ZSB0b2tlbiBzZXNzaW9uIGZyb20gUmVkaXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVRva2VuU2Vzc2lvbihzZXNzaW9uSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBjbGllbnQgPSBhd2FpdCBnZXRSZWRpc0NsaWVudCgpO1xuICBjb25zdCBrZXkgPSBgJHtTRVNTSU9OX1BSRUZJWH0ke3Nlc3Npb25JZH1gO1xuICBhd2FpdCBjbGllbnQuZGVsKGtleSk7XG59XG5cbi8qKlxuICogVXBkYXRlIGFjY2VzcyB0b2tlbiAoZm9yIHJlZnJlc2ggc2NlbmFyaW9zKVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWNjZXNzVG9rZW4oXG4gIHNlc3Npb25JZDogc3RyaW5nLFxuICBhY2Nlc3NUb2tlbjogc3RyaW5nLFxuICBhY2Nlc3NUb2tlbkV4cGlyeVRpbWU6IG51bWJlclxuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRUb2tlblNlc3Npb24oc2Vzc2lvbklkKTtcbiAgaWYgKCFzZXNzaW9uKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdTZXNzaW9uIG5vdCBmb3VuZCcpO1xuICB9XG4gIGF3YWl0IHN0b3JlVG9rZW5TZXNzaW9uKHNlc3Npb25JZCwge1xuICAgIC4uLnNlc3Npb24sXG4gICAgYWNjZXNzVG9rZW4sXG4gICAgYWNjZXNzVG9rZW5FeHBpcnlUaW1lLFxuICB9KTtcbn1cblxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInJlZGlzQ2xpZW50IiwiZ2V0UmVkaXNDbGllbnQiLCJpc09wZW4iLCJyZWRpc1VybCIsInByb2Nlc3MiLCJlbnYiLCJSRURJU19VUkwiLCJ1cmwiLCJvbiIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsImxvZyIsImNvbm5lY3QiLCJTRVNTSU9OX1BSRUZJWCIsIlRUTF9TRUNPTkRTIiwic3RvcmVUb2tlblNlc3Npb24iLCJzZXNzaW9uSWQiLCJ0b2tlbnMiLCJjbGllbnQiLCJrZXkiLCJzZXRFeCIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRUb2tlblNlc3Npb24iLCJkYXRhIiwiZ2V0IiwicGFyc2UiLCJkZWxldGVUb2tlblNlc3Npb24iLCJkZWwiLCJ1cGRhdGVBY2Nlc3NUb2tlbiIsImFjY2Vzc1Rva2VuIiwiYWNjZXNzVG9rZW5FeHBpcnlUaW1lIiwic2Vzc2lvbiIsIkVycm9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/redis-session.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/next-auth","vendor-chunks/@babel","vendor-chunks/@redis","vendor-chunks/jose","vendor-chunks/uuid","vendor-chunks/cluster-key-slot","vendor-chunks/@panva","vendor-chunks/redis","vendor-chunks/openid-client","vendor-chunks/oauth","vendor-chunks/yallist","vendor-chunks/preact-render-to-string","vendor-chunks/preact","vendor-chunks/oidc-token-hash","vendor-chunks/object-hash","vendor-chunks/lru-cache","vendor-chunks/cookie"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&page=%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute.ts&appDir=%2FUsers%2Fmukurusystemsadministrator%2FDesktop%2Fonboarding_kyc%20copy%2Fpartner%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmukurusystemsadministrator%2FDesktop%2Fonboarding_kyc%20copy%2Fpartner&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();