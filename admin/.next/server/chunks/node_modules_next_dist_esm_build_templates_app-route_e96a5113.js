;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="026a9206-87c0-edc3-9297-a3e51e4ffa2e")}catch(e){}}();
module.exports=[290260,e=>{"use strict";var t=e.i(747909),r=e.i(174017),a=e.i(996250),s=e.i(759756),n=e.i(561916),o=e.i(114444),i=e.i(837092),l=e.i(869741),p=e.i(316795),c=e.i(487718),d=e.i(995169),u=e.i(47587),h=e.i(666012),E=e.i(570101),f=e.i(626937),T=e.i(10372),v=e.i(193695);e.i(52474);var R=e.i(600220),A=e.i(89171),w=e.i(79832),y=e.i(811286),m=e.i(846029);let C=process.env.PROXY_TARGET||process.env.ONBOARDING_TARGET||"http://localhost:8001",g=process.env.PROXY_TARGET_AUTH||process.env.AUTH_TARGET||"http://localhost:8090",x=process.env.ENTITY_CONFIG_TARGET||process.env.NEXT_PUBLIC_ENTITY_CONFIG_API_BASE_URL||"http://localhost:8003";async function N(e){let t=function(e,t){let r=e.split("/api/proxy")[1]||"";if(r.startsWith("/api/users")||r.startsWith("/api/v1/users")){let e=r;return r.startsWith("/api/users")&&(e=r.replace("/api/users","/api/v1/users")),`${C}${e}${t}`}if(r.startsWith("/api/roles")||r.startsWith("/api/v1/roles")){let e=r;return r.startsWith("/api/roles")&&(e=r.replace("/api/roles","/api/v1/roles")),`${C}${e}${t}`}return r.startsWith("/api/v1/checklists")||r.startsWith("/api/v1/wizardconfigurations")?`${C}${r}${t}`:r.startsWith("/api/v1/entity-types")||r.startsWith("/api/v1/requirements")||r.startsWith("/api/v1/permissions")?`${x}${r}${t}`:`${C}${r}${t}`}(e.nextUrl.pathname,e.nextUrl.search),r={},a=null;try{let r=await (0,w.auth)();if(r?.user?.id){let s=await (0,y.getAccountTokensFromNextAuth)(r.user.id,"azure-ad");if(s)if((!s.accessTokenExpiryTime||Date.now()>=s.accessTokenExpiryTime-6e4)&&s.refreshToken)try{let e=await fetch("https://login.microsoftonline.com/dd5a90ad-b0ae-463b-bef5-5bae77f1adf2/v2.0/oauth2/v2.0/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:process.env.AZURE_AD_CLIENT_ID,grant_type:"refresh_token",refresh_token:s.refreshToken,client_secret:process.env.AZURE_AD_CLIENT_SECRET})});if(e.ok){let t=await e.json(),n=t.access_token,o=t.refresh_token??s.refreshToken,i=Date.now()+1e3*t.expires_in;await (0,y.updateNextAuthAccountTokens)(r.user.id,"azure-ad",n,o,i),a=n}else a=s.accessToken}catch(r){(0,m.reportApiError)(r,{endpoint:t,method:e.method},{tags:{error_type:"proxy_token_refresh"}}),a=s.accessToken}else a=s.accessToken}}catch(r){(0,m.reportApiError)(r,{endpoint:t,method:e.method},{tags:{error_type:"proxy_token_retrieval"}})}a&&(r.authorization=`Bearer ${a}`,r.Authorization=`Bearer ${a}`);let s=e.headers.get("content-type")||e.headers.get("Content-Type");for(let t of(s?(r["content-type"]=s,r["Content-Type"]=s):(r["content-type"]="application/json",r["Content-Type"]="application/json"),["X-User-Id","X-User-Email","X-User-Name","X-User-Role"])){let a=e.headers.get(t)||e.headers.get(t.toLowerCase());a&&(r[t]=a,r[t.toLowerCase()]=a)}r["user-agent"]="NextJS-Proxy/1.0";let n={method:e.method,headers:r,body:["GET","HEAD"].includes(e.method)?void 0:await e.text(),redirect:"manual"};try{let e=await fetch(t,n),r=await e.arrayBuffer(),a=new Headers;return e.headers.forEach((e,t)=>a.set(t,e)),a.set("Access-Control-Allow-Origin","*"),a.set("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS, PATCH"),a.set("Access-Control-Allow-Headers","Content-Type, Authorization, X-User-Id, X-User-Email, X-User-Name, X-User-Role"),new A.NextResponse(r,{status:e.status,headers:a})}catch(a){(0,m.reportApiError)(a,{endpoint:t,method:e.method},{tags:{error_type:"proxy_request"}});let r=a instanceof Error?a.message:"Unknown error";if(r.includes("ECONNREFUSED")||r.includes("fetch failed")){let a=e.nextUrl.pathname.split("/api/proxy")[1]||"";if(t.includes(g)&&(a.startsWith("/api/roles")||a.startsWith("/api/v1/roles")||a.startsWith("/api/users")||a.startsWith("/api/v1/users"))){let t=a;a.startsWith("/api/roles")?t=a.replace("/api/roles","/api/v1/roles"):a.startsWith("/api/users")&&(t=a.replace("/api/users","/api/v1/users"));let s=`${C}${t}${e.nextUrl.search}`;try{let e=await fetch(s,n),t=await e.arrayBuffer(),r=new Headers;return e.headers.forEach((e,t)=>r.set(t,e)),r.set("Access-Control-Allow-Origin","*"),r.set("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS, PATCH"),r.set("Access-Control-Allow-Headers","Content-Type, Authorization, X-User-Id, X-User-Email, X-User-Name, X-User-Role"),new A.NextResponse(t,{status:e.status,headers:r})}catch(e){return new A.NextResponse(JSON.stringify({error:"Backend service unavailable",details:`Authentication Service (${g}) is not running. Please start the authentication service on port 8090, or ensure the Unified API (${C}) has the roles/users endpoints.`,originalError:r,attemptedFallback:s}),{status:503,headers:{"Content-Type":"application/json"}})}}if(t.includes(x)&&(a.startsWith("/api/v1/requirements")||a.startsWith("/api/v1/entity-types")||a.startsWith("/api/v1/permissions"))){let t=`${C}${a}${e.nextUrl.search}`;try{let e=await fetch(t,n),r=await e.arrayBuffer(),a=new Headers;return e.headers.forEach((e,t)=>a.set(t,e)),a.set("Access-Control-Allow-Origin","*"),a.set("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS, PATCH"),a.set("Access-Control-Allow-Headers","Content-Type, Authorization, X-User-Id, X-User-Email, X-User-Name, X-User-Role"),new A.NextResponse(r,{status:e.status,headers:a})}catch(e){return new A.NextResponse(JSON.stringify({error:"Backend service unavailable",details:`Entity Configuration Service (${x}) is not running. Please start the service on port 8003, or ensure the Unified API (${C}) has the requirements endpoint.`,originalError:r,attemptedFallback:t}),{status:503,headers:{"Content-Type":"application/json"}})}}return new A.NextResponse(JSON.stringify({error:"Backend service unavailable",details:`Cannot connect to ${t}. Please ensure the backend service is running.`,originalError:r}),{status:503,headers:{"Content-Type":"application/json"}})}return new A.NextResponse(JSON.stringify({error:"Proxy request failed",details:r}),{status:502,headers:{"Content-Type":"application/json"}})}}e.s(["DELETE",0,N,"GET",0,N,"OPTIONS",0,N,"PATCH",0,N,"POST",0,N,"PUT",0,N],801785);var _=e.i(801785);let P=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/proxy/[...path]/route",pathname:"/api/proxy/[...path]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/proxy/[...path]/route.ts",nextConfigOutput:"",userland:_}),{workAsyncStorage:U,workUnitAsyncStorage:O,serverHooks:k}=P;function S(){return(0,a.patchFetch)({workAsyncStorage:U,workUnitAsyncStorage:O})}async function $(e,t,a){P.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let A="/api/proxy/[...path]/route";A=A.replace(/\/index$/,"")||"/";let w=await P.prepare(e,t,{srcPage:A,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:y,params:m,nextConfig:C,parsedUrl:g,isDraftMode:x,prerenderManifest:N,routerServerContext:_,isOnDemandRevalidate:U,revalidateOnlyGenerated:O,resolvedPathname:k,clientReferenceManifest:S,serverActionsManifest:$}=w,b=(0,l.normalizeAppPath)(A),I=!!(N.dynamicRoutes[b]||N.routes[k]),H=async()=>((null==_?void 0:_.render404)?await _.render404(e,t,g,!1):t.end("This page could not be found"),null);if(I&&!x){let e=!!N.routes[k],t=N.dynamicRoutes[b];if(t&&!1===t.fallback&&!e){if(C.experimental.adapterPath)return await H();throw new v.NoFallbackError}}let D=null;!I||P.isDev||x||(D="/index"===(D=k)?"/":D);let W=!0===P.isDev||!I,X=I&&!W;$&&S&&(0,o.setReferenceManifestsSingleton)({page:A,clientReferenceManifest:S,serverActionsManifest:$,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:$})});let q=e.method||"GET",M=(0,n.getTracer)(),B=M.getActiveScopeSpan(),G={params:m,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!C.experimental.authInterrupts},cacheComponents:!!C.cacheComponents,supportsDynamicResponse:W,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:C.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>P.onRequestError(e,t,a,_)},sharedContext:{buildId:y}},L=new p.NodeNextRequest(e),j=new p.NodeNextResponse(t),F=c.NextRequestAdapter.fromNodeNextRequest(L,(0,c.signalFromNodeResponse)(t));try{let o=async e=>P.handle(F,G).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=M.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${q} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${A}`)}),i=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var n,l;let p=async({previousCacheEntry:r})=>{try{if(!i&&U&&O&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(s);e.fetchMetrics=G.renderOpts.fetchMetrics;let l=G.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let p=G.renderOpts.collectedTags;if(!I)return await (0,h.sendResponse)(L,j,n,G.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,E.toNodeOutgoingHttpHeaders)(n.headers);p&&(t[T.NEXT_CACHE_TAGS_HEADER]=p),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==G.renderOpts.collectedRevalidate&&!(G.renderOpts.collectedRevalidate>=T.INFINITE_CACHE)&&G.renderOpts.collectedRevalidate,a=void 0===G.renderOpts.collectedExpire||G.renderOpts.collectedExpire>=T.INFINITE_CACHE?void 0:G.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await P.onRequestError(e,t,{routerKind:"App Router",routePath:A,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:X,isOnDemandRevalidate:U})},_),t}},c=await P.handleResponse({req:e,nextConfig:C,cacheKey:D,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:U,revalidateOnlyGenerated:O,responseGenerator:p,waitUntil:a.waitUntil,isMinimalMode:i});if(!I)return null;if((null==c||null==(n=c.value)?void 0:n.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",U?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,E.fromNodeOutgoingHttpHeaders)(c.value.headers);return i&&I||d.delete(T.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,f.getCacheControlHeader)(c.cacheControl)),await (0,h.sendResponse)(L,j,new Response(c.value.body,{headers:d,status:c.value.status||200})),null};B?await l(B):await M.withPropagatedContext(e.headers,()=>M.trace(d.BaseServerSpan.handleRequest,{spanName:`${q} ${A}`,kind:n.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},l))}catch(t){if(t instanceof v.NoFallbackError||await P.onRequestError(e,t,{routerKind:"App Router",routePath:b,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:X,isOnDemandRevalidate:U})}),I)throw t;return await (0,h.sendResponse)(L,j,new Response(null,{status:500})),null}}e.s(["handler",()=>$,"patchFetch",()=>S,"routeModule",()=>P,"serverHooks",()=>k,"workAsyncStorage",()=>U,"workUnitAsyncStorage",()=>O],290260)}];

//# debugId=026a9206-87c0-edc3-9297-a3e51e4ffa2e
//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_e96a5113.js.map