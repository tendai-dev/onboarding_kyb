;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="ca63900f-e4fb-9e73-a2f7-5fe5b6186e75")}catch(e){}}();
module.exports=[158287,a=>{"use strict";var b=a.i(187924),c=a.i(247290),d=a.i(566701),e=a.i(480916),f=a.i(688294),g=a.i(332938),h=a.i(397225),i=a.i(154462),j=a.i(601167);a.i(525985);var k=a.i(790355),l=a.i(831551),m=a.i(492180),n=a.i(259580),o=a.i(832141),p=a.i(138340),q=a.i(652167),r=a.i(898799),s=a.i(200610),t=a.i(937859),u=a.i(727348),v=a.i(155668),w=a.i(572131),x=a.i(992539),y=a.i(305856),z=a.i(173029),A=a.i(968653);a.i(95688);var B=a.i(502868),C=a.i(255145),D=a.i(718402),E=a.i(50944);function F(){let{data:a}=(0,D.useSession)(),F=(0,E.useRouter)(),{condensed:G}=(0,z.useSidebar)(),[H,I]=(0,w.useState)([]),[J,K]=(0,w.useState)(!1),[L,M]=(0,w.useState)(null),[N,O]=(0,w.useState)(""),[P,Q]=(0,w.useState)("ALL"),[R,S]=(0,w.useState)(!1),[T,U]=(0,w.useState)(null),[V,W]=(0,w.useState)(""),[X,Y]=(0,w.useState)(""),[Z,$]=(0,w.useState)(!1),[_,aa]=(0,w.useState)(null),[ab,ac]=(0,w.useState)(0),ad=(0,w.useCallback)(async(a,b)=>{try{K(!0),M(null),console.log("[Risk Review Page] Loading risk assessments with filters:",{riskLevel:a||P,search:b||N});let c=a||P,d={};if("ALL"!==c){let a=c;"CRITICAL"===c||"HIGH"===c?a="High":"MEDIUM"===c?a="Medium":"LOW"===c&&(a="Low"),d.riskLevel=a}b&&b.trim().length>0&&(/^[0-9a-f-]{8,}$/i.test(b.trim())||b.trim().length>=8)&&(d.caseId=b.trim());let e=await A.riskApiService.listRiskAssessments(d),f=[];if("ALL"===c||!c)try{let a=(await (0,B.fetchApplications)(1,1e3,void 0,"SUBMITTED")).items.map(a=>({id:a.id,caseId:a.id,businessLegalName:a.companyName,applicantFirstName:"",applicantLastName:"",type:a.entityType,status:a.status,assignedTo:a.assignedTo,assignedToName:a.assignedTo,submittedAt:a.submittedDate,createdAt:a.submittedDate})),b=new Set(e.map(a=>a.caseId.toLowerCase()));f=a.filter(a=>{let c=(a.caseId||a.id).toLowerCase();return!b.has(c)})}catch(a){C.logger.warn("Failed to fetch cases needing review",{tags:{error_type:"risk_review_fetch_error"},extra:{error:a}})}let g=[...e.map(a=>({...a,needsAssessment:!1})),...f.map(a=>{let b=a.caseId||a.id,c=a.businessLegalName||`${a.applicantFirstName||""} ${a.applicantLastName||""}`.trim()||"Unknown Company";return{id:`pending-${b}`,applicationId:b,caseId:b,companyName:c,entityType:a.type||"Unknown",riskLevel:"UNKNOWN",riskScore:0,status:"PENDING",assignedTo:a.assignedToName||a.assignedTo||"Unassigned",submittedDate:a.submittedAt||a.createdAt,riskFactors:[],recommendations:[],needsAssessment:!0,caseProjection:a}})];I(g)}catch(a){console.error("[Risk Review Page] Failed to load risk assessments:",a),M(a instanceof Error?a.message:"Failed to load risk assessments. Please ensure the backend services are running."),I([])}finally{K(!1)}},[P,N]);(0,w.useEffect)(()=>{ad()},[ad,ab]);let ae=(0,w.useCallback)(a=>{O(a),(0===a.length||a.length>=3)&&ad(P,a)},[P,ad]);(0,w.useEffect)(()=>{ad(P,N)},[P]);let af=a=>{switch(a){case"LOW":return"green";case"MEDIUM":return"orange";case"HIGH":case"CRITICAL":return"red";default:return"gray"}},ag=a=>{switch(a){case"PENDING":return"orange";case"IN_REVIEW":return"blue";case"APPROVED":return"green";case"REJECTED":return"red";default:return"gray"}},ah=H.filter(a=>{let b=N.toLowerCase(),c=N.length>0&&(/^[0-9a-f-]{8,}$/i.test(N.trim())||N.trim().length>=8),d=!0;N.length>0&&!c&&(d=a.companyName.toLowerCase().includes(b)||a.applicationId.toLowerCase().includes(b));let e="ALL"===P||a.riskLevel===P;return d&&e}),ai=H.filter(a=>"CRITICAL"===a.riskLevel).length,aj=H.filter(a=>"HIGH"===a.riskLevel).length,ak=H.filter(a=>{let b="UNKNOWN"===a.riskLevel||!a.riskLevel;return"PENDING"===a.status||b||"IN_REVIEW"===a.status&&b}).length,al=H.filter(a=>"APPROVED"===a.status).length,am=[{field:"companyName",header:"Company Name",width:"200px",minWidth:"200px",render:(a,c)=>(0,b.jsx)(l.Typography,{fontWeight:"medium",color:"gray.800",children:c.companyName})},{field:"applicationId",header:"Application ID",width:"150px",minWidth:"150px",render:(a,c)=>(0,b.jsx)(l.Typography,{color:"gray.600",fontSize:"xs",children:c.applicationId})},{field:"entityType",header:"Entity Type",width:"120px",minWidth:"120px",render:(a,c)=>(0,b.jsx)(l.Typography,{color:"gray.700",children:c.entityType})},{field:"riskLevel",header:"Risk Level",width:"140px",minWidth:"140px",render:(a,c)=>"UNKNOWN"!==c.riskLevel&&c.riskLevel?(0,b.jsx)(n.Tag,{variant:"red"===af(c.riskLevel)?"danger":"orange"===af(c.riskLevel)?"warning":"info",children:c.riskLevel}):(0,b.jsx)(n.Tag,{variant:"inactive",children:"Not Assessed"})},{field:"status",header:"Status",width:"120px",minWidth:"120px",render:(a,c)=>(0,b.jsx)(n.Tag,{variant:"green"===ag(c.status)?"success":"red"===ag(c.status)?"danger":"orange"===ag(c.status)?"warning":"info",children:c.status.replace("_"," ")})},{field:"assignedTo",header:"Assigned To",width:"140px",minWidth:"140px",render:(a,c)=>(0,b.jsx)(l.Typography,{color:"gray.700",fontSize:"xs",children:c.assignedTo})},{field:"submittedDate",header:"Submitted",width:"120px",minWidth:"120px",render:(a,c)=>(0,b.jsx)(l.Typography,{color:"gray.600",fontSize:"xs",children:new Date(c.submittedDate).toLocaleDateString()})},{field:"riskScore",header:"Risk Score",width:"120px",minWidth:"120px",render:(a,d)=>"UNKNOWN"!==d.riskLevel&&d.riskLevel&&d.riskScore>0?(0,b.jsxs)(f.HStack,{gap:"1",align:"center",children:[(0,b.jsxs)(l.Typography,{fontSize:"xs",color:"gray.600",minW:"35px",children:[d.riskScore,"%"]}),(0,b.jsx)(c.Box,{flex:"1",height:"6px",bg:"gray.200",borderRadius:"full",overflow:"hidden",children:(0,b.jsx)(c.Box,{width:`${d.riskScore}%`,height:"100%",bg:d.riskScore>=80?"red.400":d.riskScore>=60?"orange.400":d.riskScore>=40?"yellow.400":"green.400",borderRadius:"full"})})]}):(0,b.jsx)(l.Typography,{fontSize:"xs",color:"gray.400",fontStyle:"italic",children:"N/A"})}];return(0,b.jsxs)(h.Flex,{minH:"100vh",bg:"gray.50",children:[(0,b.jsx)(x.default,{}),(0,b.jsxs)(c.Box,{ml:G?"72px":"280px",mt:"90px",minH:"calc(100vh - 90px)",width:G?"calc(100% - 72px)":"calc(100% - 280px)",bg:"gray.50",overflowX:"hidden",transition:"margin-left 0.3s ease, width 0.3s ease",children:[(0,b.jsx)(y.default,{}),(0,b.jsx)(d.Container,{maxW:"100%",px:"8",py:"6",width:"full",children:(0,b.jsxs)(e.VStack,{gap:"4",align:"stretch",children:[(0,b.jsxs)(h.Flex,{justify:"space-between",align:"center",mb:"4",children:[(0,b.jsxs)(e.VStack,{align:"start",gap:"1",children:[(0,b.jsx)(l.Typography,{fontSize:"3xl",fontWeight:"bold",color:"gray.800",children:"Risk Review"}),(0,b.jsx)(l.Typography,{color:"gray.600",children:"Manually review and classify application risk levels"})]}),(0,b.jsxs)(m.Button,{variant:"secondary",size:"sm",onClick:()=>{ac(a=>a+1)},className:"mukuru-primary-button",children:[(0,b.jsx)(p.IconWrapper,{children:(0,b.jsx)(u.FiFilter,{size:16})}),"Refresh"]})]}),L&&(0,b.jsx)(q.AlertBar,{status:"error",title:"Error loading risk assessments",children:L}),(0,b.jsx)(q.AlertBar,{status:"info",title:"Manual Risk Review Required",children:"All risk classifications must be done manually by authorized personnel. No automatic risk scoring or classification is performed."}),(0,b.jsxs)(g.SimpleGrid,{columns:{base:1,md:4},gap:"4",children:[(0,b.jsx)(r.Card,{bg:"white",p:"4",children:(0,b.jsxs)(h.Flex,{gap:"4",align:"center",children:[(0,b.jsx)(j.Avatar.Root,{bg:"red.100",size:"md",display:"flex",alignItems:"center",justifyContent:"center",children:(0,b.jsx)(p.IconWrapper,{children:(0,b.jsx)(u.FiAlertTriangle,{size:20,color:"#E53E3E"})})}),(0,b.jsxs)(e.VStack,{align:"start",gap:"0",flex:"1",children:[(0,b.jsx)(l.Typography,{fontSize:"sm",color:"gray.600",children:"Critical Risk"}),(0,b.jsx)(l.Typography,{fontSize:"30px",fontWeight:"bold",color:"red.600",fontFamily:"Madera, sans-serif",children:ai})]}),(0,b.jsx)(v.ChevronRightIcon,{})]})}),(0,b.jsx)(r.Card,{bg:"white",p:"4",children:(0,b.jsxs)(h.Flex,{gap:"4",align:"center",children:[(0,b.jsx)(j.Avatar.Root,{bg:"orange.100",size:"md",display:"flex",alignItems:"center",justifyContent:"center",children:(0,b.jsx)(p.IconWrapper,{children:(0,b.jsx)(u.FiFlag,{size:20,color:"#DD6B20"})})}),(0,b.jsxs)(e.VStack,{align:"start",gap:"0",flex:"1",children:[(0,b.jsx)(l.Typography,{fontSize:"sm",color:"gray.600",children:"High Risk"}),(0,b.jsx)(l.Typography,{fontSize:"30px",fontWeight:"bold",color:"orange.600",fontFamily:"Madera, sans-serif",children:aj})]}),(0,b.jsx)(v.ChevronRightIcon,{})]})}),(0,b.jsx)(r.Card,{bg:"white",p:"4",children:(0,b.jsxs)(h.Flex,{gap:"4",align:"center",children:[(0,b.jsx)(j.Avatar.Root,{bg:"blue.100",size:"md",display:"flex",alignItems:"center",justifyContent:"center",children:(0,b.jsx)(p.IconWrapper,{children:(0,b.jsx)(u.FiClock,{size:20,color:"#3182CE"})})}),(0,b.jsxs)(e.VStack,{align:"start",gap:"0",flex:"1",children:[(0,b.jsx)(l.Typography,{fontSize:"sm",color:"gray.600",children:"Pending Manual Review"}),(0,b.jsx)(l.Typography,{fontSize:"30px",fontWeight:"bold",color:"blue.600",fontFamily:"Madera, sans-serif",children:ak})]}),(0,b.jsx)(v.ChevronRightIcon,{})]})}),(0,b.jsx)(r.Card,{bg:"white",p:"4",children:(0,b.jsxs)(h.Flex,{gap:"4",align:"center",children:[(0,b.jsx)(j.Avatar.Root,{bg:"green.100",size:"md",display:"flex",alignItems:"center",justifyContent:"center",children:(0,b.jsx)(p.IconWrapper,{children:(0,b.jsx)(u.FiCheckCircle,{size:20,color:"#38A169"})})}),(0,b.jsxs)(e.VStack,{align:"start",gap:"0",flex:"1",children:[(0,b.jsx)(l.Typography,{fontSize:"sm",color:"gray.600",children:"Approved"}),(0,b.jsx)(l.Typography,{fontSize:"30px",fontWeight:"bold",color:"green.600",fontFamily:"Madera, sans-serif",children:al})]}),(0,b.jsx)(v.ChevronRightIcon,{})]})})]}),(0,b.jsx)(f.HStack,{gap:"2",mb:"2",children:["ALL","CRITICAL","HIGH","MEDIUM","LOW"].map(a=>(0,b.jsx)(m.Button,{variant:"primary",onClick:()=>Q(a),className:"mukuru-primary-button",style:{opacity:P===a?1:.7},children:"ALL"===a?"All":a},a))}),(0,b.jsx)(c.Box,{width:"100%",maxW:"800px",children:(0,b.jsx)(k.Search,{placeholder:"Search by company name or application ID...",onSearchChange:ae})}),(0,b.jsx)(c.Box,{className:"work-queue-table-wrapper",width:"100%",children:(0,b.jsx)(s.DataTable,{data:ah,columns:am,actionColumn:{header:"Actions",width:"200px",render:a=>(0,b.jsxs)(f.HStack,{gap:"2",children:[(0,b.jsx)(t.Tooltip,{content:"Review",children:(0,b.jsxs)("button",{onClick:async()=>{try{let b=a.workItemId||a.applicationId;F.push(`/review/${b}`)}catch(b){console.error("Error navigating to review:",b),F.push(`/applications/${a.applicationId}`)}},style:{padding:"6px 12px",borderRadius:"6px",border:"none",backgroundColor:"#F05423",color:"white",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[(0,b.jsx)(p.IconWrapper,{children:(0,b.jsx)(u.FiShield,{size:14})}),"Review"]})}),a.needsAssessment?(0,b.jsx)(t.Tooltip,{content:"Create Assessment",children:(0,b.jsx)("button",{onClick:async()=>{if(a.caseProjection){aa(a.caseId);try{await A.riskApiService.createRiskAssessment(a.caseId,a.caseProjection.partnerId),ac(a=>a+1)}catch(a){console.error("Failed to create risk assessment:",a),alert("Failed to create risk assessment. Please try again.")}finally{aa(null)}}},disabled:_===a.caseId,style:{padding:"6px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"white",color:"#111827",cursor:_===a.caseId?"not-allowed":"pointer",opacity:_===a.caseId?.5:1},children:"Create Assessment"})}):(0,b.jsx)(t.Tooltip,{content:"UNKNOWN"!==a.riskLevel&&a.riskLevel?"Update":"Classify",children:(0,b.jsxs)("button",{onClick:()=>{U(a),W(a.riskLevel||""),Y(""),S(!0)},style:{padding:"6px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"white",color:"#111827",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[(0,b.jsx)(p.IconWrapper,{children:(0,b.jsx)(u.FiEdit3,{size:14})}),"UNKNOWN"!==a.riskLevel&&a.riskLevel?"Update":"Classify"]})})]})},loading:J})})]})})]}),(0,b.jsxs)(o.Modal,{isOpen:R,onClose:()=>{S(!1),U(null),W(""),Y("")},title:"Classify Risk Level",size:"small",closeOnBackdropClick:!0,closeOnEsc:!0,children:[(0,b.jsx)(o.ModalHeader,{children:(0,b.jsxs)(f.HStack,{gap:"3",align:"center",children:[(0,b.jsx)(p.IconWrapper,{children:(0,b.jsx)(u.FiShield,{size:20,color:"#FB923C"})}),(0,b.jsxs)(e.VStack,{align:"start",gap:"0",children:[(0,b.jsx)(l.Typography,{fontSize:"lg",fontWeight:"700",children:"Classify Risk Level"}),(0,b.jsx)(l.Typography,{fontSize:"sm",color:"gray.600",children:"Manually set the risk classification for this application"})]})]})}),(0,b.jsx)(o.ModalBody,{children:(0,b.jsxs)(e.VStack,{gap:"5",align:"stretch",children:[(0,b.jsxs)(c.Box,{children:[(0,b.jsx)(l.Typography,{fontSize:"sm",fontWeight:"medium",color:"gray.700",mb:"2",children:"Application"}),(0,b.jsx)(l.Typography,{fontSize:"sm",color:"gray.600",children:T?.companyName||T?.applicationId})]}),(0,b.jsxs)(c.Box,{children:[(0,b.jsxs)(l.Typography,{fontSize:"sm",fontWeight:"medium",color:"gray.700",mb:"2",children:["Risk Level ",(0,b.jsx)(l.Typography,{as:"span",color:"red.500",children:"*"})]}),(0,b.jsxs)("select",{value:V,onChange:a=>W(a.target.value),style:{width:"100%",padding:"8px 12px",fontSize:"14px",borderRadius:"6px",border:"1px solid #E2E8F0",backgroundColor:"white",cursor:"pointer"},children:[(0,b.jsx)("option",{value:"",children:"Select risk level"}),(0,b.jsx)("option",{value:"LOW",children:"Low Risk"}),(0,b.jsx)("option",{value:"MEDIUM",children:"Medium Risk"}),(0,b.jsx)("option",{value:"HIGH",children:"High Risk"}),(0,b.jsx)("option",{value:"CRITICAL",children:"Critical Risk"})]})]}),(0,b.jsxs)(c.Box,{children:[(0,b.jsxs)(l.Typography,{fontSize:"sm",fontWeight:"medium",color:"gray.700",mb:"2",children:["Justification ",(0,b.jsx)(l.Typography,{as:"span",color:"red.500",children:"*"})]}),(0,b.jsx)(i.Textarea,{value:X,onChange:a=>Y(a.target.value),placeholder:"Provide justification for this risk classification...",rows:4,resize:"vertical"}),(0,b.jsx)(l.Typography,{fontSize:"xs",color:"gray.500",mt:"1",children:"This justification will be recorded in the audit trail"})]})]})}),(0,b.jsx)(o.ModalFooter,{children:(0,b.jsxs)(f.HStack,{gap:"3",justify:"flex-end",children:[(0,b.jsx)(m.Button,{variant:"secondary",onClick:()=>{S(!1),U(null),W(""),Y("")},children:"Cancel"}),(0,b.jsx)(m.Button,{variant:"primary",className:"mukuru-primary-button",onClick:async()=>{if(T&&V&&X.trim()){$(!0);try{await A.riskApiService.setManualRiskLevel(T.id,V,X),S(!1),U(null),W(""),Y(""),ac(a=>a+1)}catch(a){console.error("Failed to classify risk:",a),alert("Failed to classify risk. Please try again.")}finally{$(!1)}}},disabled:Z||!V||!X.trim(),children:"Classify Risk"})]})})]})]})}a.s(["default",()=>F])}];

//# debugId=ca63900f-e4fb-9e73-a2f7-5fe5b6186e75
//# sourceMappingURL=src_app_risk-review_page_tsx_20cf389b._.js.map