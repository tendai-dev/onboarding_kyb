{
  "version": 3,
  "sources": [],
  "debugId": "fc1093be-fde9-9cce-d308-31b19c981200",
  "sections": [
    {"offset": {"line": 251, "column": 0}, "map": {"version":3,"sources":["file:///Users/mukurusystemsadministrator/Desktop/onboarding_kyc%20copy/admin/src/lib/sentry.ts"],"sourcesContent":["/**\n * Sentry error reporting utilities\n * Use these functions instead of console.error/warn for proper error tracking\n */\n\nimport * as Sentry from \"@sentry/nextjs\";\n\n/**\n * Report an error to Sentry with optional context\n */\nexport function reportError(\n  error: Error | unknown,\n  context?: {\n    tags?: Record<string, string>;\n    extra?: Record<string, unknown>;\n    level?: Sentry.SeverityLevel;\n    user?: {\n      id?: string;\n      email?: string;\n      username?: string;\n    };\n  }\n): void {\n  if (error instanceof Error) {\n    Sentry.captureException(error, {\n      tags: context?.tags,\n      extra: context?.extra,\n      level: context?.level || \"error\",\n      user: context?.user,\n    });\n  } else {\n    // For non-Error objects, create an Error from the value\n    const errorMessage = typeof error === \"string\" ? error : JSON.stringify(error);\n    Sentry.captureException(new Error(errorMessage), {\n      tags: context?.tags,\n      extra: { originalError: error, ...context?.extra },\n      level: context?.level || \"error\",\n      user: context?.user,\n    });\n  }\n}\n\n/**\n * Report a warning to Sentry\n */\nexport function reportWarning(\n  message: string,\n  context?: {\n    tags?: Record<string, string>;\n    extra?: Record<string, unknown>;\n  }\n): void {\n  Sentry.captureMessage(message, {\n    level: \"warning\",\n    tags: context?.tags,\n    extra: context?.extra,\n  });\n}\n\n/**\n * Report an API error with request context\n */\nexport function reportApiError(\n  error: Error | unknown,\n  apiContext: {\n    endpoint: string;\n    method?: string;\n    statusCode?: number;\n    responseBody?: string;\n    requestBody?: unknown;\n  },\n  additionalContext?: {\n    tags?: Record<string, string>;\n    extra?: Record<string, unknown>;\n  }\n): void {\n  const errorMessage = error instanceof Error ? error.message : String(error);\n  \n  reportError(error, {\n    tags: {\n      error_type: \"api_error\",\n      api_endpoint: apiContext.endpoint,\n      api_method: apiContext.method || \"GET\",\n      ...additionalContext?.tags,\n    },\n    extra: {\n      api_endpoint: apiContext.endpoint,\n      api_method: apiContext.method,\n      status_code: apiContext.statusCode,\n      response_body: apiContext.responseBody,\n      request_body: apiContext.requestBody,\n      ...additionalContext?.extra,\n    },\n  });\n}\n\n/**\n * Set user context for Sentry\n */\nexport function setUserContext(user: {\n  id?: string;\n  email?: string;\n  username?: string;\n  name?: string;\n}): void {\n  Sentry.setUser({\n    id: user.id,\n    email: user.email,\n    username: user.username || user.name,\n  });\n}\n\n/**\n * Clear user context (e.g., on logout)\n */\nexport function clearUserContext(): void {\n  Sentry.setUser(null);\n}\n\n/**\n * Add breadcrumb for debugging\n */\nexport function addBreadcrumb(\n  message: string,\n  category?: string,\n  level?: Sentry.SeverityLevel,\n  data?: Record<string, unknown>\n): void {\n  Sentry.addBreadcrumb({\n    message,\n    category: category || \"default\",\n    level: level || \"info\",\n    data,\n  });\n}\n\n/**\n * Wrap an async function to automatically capture errors\n */\nexport function withErrorReporting<T extends (...args: any[]) => Promise<any>>(\n  fn: T,\n  context?: {\n    tags?: Record<string, string>;\n    extra?: Record<string, unknown>;\n  }\n): T {\n  return (async (...args: any[]) => {\n    try {\n      return await fn(...args);\n    } catch (error) {\n      reportError(error, context);\n      throw error; // Re-throw to maintain original behavior\n    }\n  }) as T;\n}\n\n/**\n * Wrap a sync function to automatically capture errors\n */\nexport function withErrorReportingSync<T extends (...args: any[]) => any>(\n  fn: T,\n  context?: {\n    tags?: Record<string, string>;\n    extra?: Record<string, unknown>;\n  }\n): T {\n  return ((...args: any[]) => {\n    try {\n      return fn(...args);\n    } catch (error) {\n      reportError(error, context);\n      throw error; // Re-throw to maintain original behavior\n    }\n  }) as T;\n}\n\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;;;;;;;;;;;AAED;;AAKO,SAAS,YACd,KAAsB,EACtB,OASC;IAED,IAAI,iBAAiB,OAAO;QAC1B,2LAAuB,CAAC,OAAO;YAC7B,MAAM,SAAS;YACf,OAAO,SAAS;YAChB,OAAO,SAAS,SAAS;YACzB,MAAM,SAAS;QACjB;IACF,OAAO;QACL,wDAAwD;QACxD,MAAM,eAAe,OAAO,UAAU,WAAW,QAAQ,KAAK,SAAS,CAAC;QACxE,2LAAuB,CAAC,IAAI,MAAM,eAAe;YAC/C,MAAM,SAAS;YACf,OAAO;gBAAE,eAAe;gBAAO,GAAG,SAAS,KAAK;YAAC;YACjD,OAAO,SAAS,SAAS;YACzB,MAAM,SAAS;QACjB;IACF;AACF;AAKO,SAAS,cACd,OAAe,EACf,OAGC;IAED,yLAAqB,CAAC,SAAS;QAC7B,OAAO;QACP,MAAM,SAAS;QACf,OAAO,SAAS;IAClB;AACF;AAKO,SAAS,eACd,KAAsB,EACtB,UAMC,EACD,iBAGC;IAED,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;IAErE,YAAY,OAAO;QACjB,MAAM;YACJ,YAAY;YACZ,cAAc,WAAW,QAAQ;YACjC,YAAY,WAAW,MAAM,IAAI;YACjC,GAAG,mBAAmB,IAAI;QAC5B;QACA,OAAO;YACL,cAAc,WAAW,QAAQ;YACjC,YAAY,WAAW,MAAM;YAC7B,aAAa,WAAW,UAAU;YAClC,eAAe,WAAW,YAAY;YACtC,cAAc,WAAW,WAAW;YACpC,GAAG,mBAAmB,KAAK;QAC7B;IACF;AACF;AAKO,SAAS,eAAe,IAK9B;IACC,kLAAc,CAAC;QACb,IAAI,KAAK,EAAE;QACX,OAAO,KAAK,KAAK;QACjB,UAAU,KAAK,QAAQ,IAAI,KAAK,IAAI;IACtC;AACF;AAKO,SAAS;IACd,kLAAc,CAAC;AACjB;AAKO,SAAS,cACd,OAAe,EACf,QAAiB,EACjB,KAA4B,EAC5B,IAA8B;IAE9B,wLAAoB,CAAC;QACnB;QACA,UAAU,YAAY;QACtB,OAAO,SAAS;QAChB;IACF;AACF;AAKO,SAAS,mBACd,EAAK,EACL,OAGC;IAED,OAAQ,OAAO,GAAG;QAChB,IAAI;YACF,OAAO,MAAM,MAAM;QACrB,EAAE,OAAO,OAAO;YACd,YAAY,OAAO;YACnB,MAAM,OAAO,yCAAyC;QACxD;IACF;AACF;AAKO,SAAS,uBACd,EAAK,EACL,OAGC;IAED,OAAQ,CAAC,GAAG;QACV,IAAI;YACF,OAAO,MAAM;QACf,EAAE,OAAO,OAAO;YACd,YAAY,OAAO;YACnB,MAAM,OAAO,yCAAyC;QACxD;IACF;AACF"}},
    {"offset": {"line": 364, "column": 0}, "map": {"version":3,"sources":["file:///Users/mukurusystemsadministrator/Desktop/onboarding_kyc%20copy/admin/src/lib/logger.ts"],"sourcesContent":["/**\n * Centralized logging utility\n * Replaces console.log/warn/error with proper logging that can be controlled\n * and integrated with Sentry in production\n */\n\nimport * as Sentry from '@sentry/nextjs';\nimport { reportError, reportWarning, addBreadcrumb } from './sentry';\n\ntype LogLevel = 'debug' | 'info' | 'warn' | 'error';\n\ninterface LogOptions {\n  tags?: Record<string, string>;\n  extra?: Record<string, unknown>;\n  level?: LogLevel;\n}\n\nclass Logger {\n  private isDevelopment = process.env.NODE_ENV === 'development';\n  private isProduction = process.env.NODE_ENV === 'production';\n\n  /**\n   * Log debug messages (only in development)\n   */\n  debug(message: string, ...args: unknown[]): void {\n    if (this.isDevelopment) {\n      // eslint-disable-next-line no-console\n      console.debug(`[DEBUG] ${message}`, ...args);\n    }\n  }\n\n  /**\n   * Log info messages\n   */\n  info(message: string, ...args: unknown[]): void {\n    if (this.isDevelopment) {\n      // eslint-disable-next-line no-console\n      console.info(`[INFO] ${message}`, ...args);\n    }\n    // Add breadcrumb in production for debugging\n    if (this.isProduction) {\n      addBreadcrumb(message, 'info', 'info' as Sentry.SeverityLevel, { args });\n    }\n  }\n\n  /**\n   * Log warning messages\n   */\n  warn(message: string, options?: LogOptions): void {\n    // eslint-disable-next-line no-console\n    console.warn(`[WARN] ${message}`);\n    \n    // Report to Sentry in production\n    if (this.isProduction) {\n      reportWarning(message, {\n        tags: options?.tags,\n        extra: options?.extra,\n      });\n    }\n  }\n\n  /**\n   * Log error messages\n   */\n  error(error: Error | unknown, message?: string, options?: LogOptions): void {\n    const errorMessage = message || (error instanceof Error ? error.message : String(error));\n    \n    // eslint-disable-next-line no-console\n    console.error(`[ERROR] ${errorMessage}`, error);\n    \n    // Map LogLevel to Sentry.SeverityLevel\n    const sentryLevel: Sentry.SeverityLevel = \n      options?.level === 'warn' ? 'warning' : \n      options?.level === 'error' ? 'error' : \n      options?.level === 'info' ? 'info' : \n      'error';\n    \n    // Report to Sentry\n    reportError(error, {\n      tags: options?.tags,\n      extra: options?.extra,\n      level: sentryLevel,\n    });\n  }\n\n  /**\n   * Log with context (replaces console.log with structured logging)\n   */\n  log(message: string, context?: Record<string, unknown>, level: LogLevel = 'info'): void {\n    if (this.isDevelopment) {\n      // eslint-disable-next-line no-console\n      console.log(`[${level.toUpperCase()}] ${message}`, context || '');\n    }\n    \n    // Add breadcrumb in production\n    if (this.isProduction && level !== 'debug') {\n      const sentryLevel: Sentry.SeverityLevel = \n        level === 'warn' ? 'warning' : level === 'error' ? 'error' : 'info';\n      addBreadcrumb(message, 'log', sentryLevel, context);\n    }\n  }\n}\n\n// Export singleton instance\nexport const logger = new Logger();\n\n// Export class for testing\nexport { Logger };\n\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;;;AAGD;;AAUA,MAAM;IACI,gBAAgB,oDAAyB,cAAc;IACvD,eAAe,oDAAyB,aAAa;IAE7D;;GAEC,GACD,MAAM,OAAe,EAAE,GAAG,IAAe,EAAQ;QAC/C,IAAI,IAAI,CAAC,aAAa,EAAE;YACtB,sCAAsC;YACtC,QAAQ,KAAK,CAAC,CAAC,QAAQ,EAAE,SAAS,KAAK;QACzC;IACF;IAEA;;GAEC,GACD,KAAK,OAAe,EAAE,GAAG,IAAe,EAAQ;QAC9C,IAAI,IAAI,CAAC,aAAa,EAAE;YACtB,sCAAsC;YACtC,QAAQ,IAAI,CAAC,CAAC,OAAO,EAAE,SAAS,KAAK;QACvC;QACA,6CAA6C;QAC7C,IAAI,IAAI,CAAC,YAAY,EAAE;YACrB,IAAA,uIAAa,EAAC,SAAS,QAAQ,QAAgC;gBAAE;YAAK;QACxE;IACF;IAEA;;GAEC,GACD,KAAK,OAAe,EAAE,OAAoB,EAAQ;QAChD,sCAAsC;QACtC,QAAQ,IAAI,CAAC,CAAC,OAAO,EAAE,SAAS;QAEhC,iCAAiC;QACjC,IAAI,IAAI,CAAC,YAAY,EAAE;YACrB,IAAA,uIAAa,EAAC,SAAS;gBACrB,MAAM,SAAS;gBACf,OAAO,SAAS;YAClB;QACF;IACF;IAEA;;GAEC,GACD,MAAM,KAAsB,EAAE,OAAgB,EAAE,OAAoB,EAAQ;QAC1E,MAAM,eAAe,WAAW,CAAC,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO,MAAM;QAEvF,sCAAsC;QACtC,QAAQ,KAAK,CAAC,CAAC,QAAQ,EAAE,cAAc,EAAE;QAEzC,uCAAuC;QACvC,MAAM,cACJ,SAAS,UAAU,SAAS,YAC5B,SAAS,UAAU,UAAU,UAC7B,SAAS,UAAU,SAAS,SAC5B;QAEF,mBAAmB;QACnB,IAAA,qIAAW,EAAC,OAAO;YACjB,MAAM,SAAS;YACf,OAAO,SAAS;YAChB,OAAO;QACT;IACF;IAEA;;GAEC,GACD,IAAI,OAAe,EAAE,OAAiC,EAAE,QAAkB,MAAM,EAAQ;QACtF,IAAI,IAAI,CAAC,aAAa,EAAE;YACtB,sCAAsC;YACtC,QAAQ,GAAG,CAAC,CAAC,CAAC,EAAE,MAAM,WAAW,GAAG,EAAE,EAAE,SAAS,EAAE,WAAW;QAChE;QAEA,+BAA+B;QAC/B,IAAI,IAAI,CAAC,YAAY,IAAI,UAAU,SAAS;YAC1C,MAAM,cACJ,UAAU,SAAS,YAAY,UAAU,UAAU,UAAU;YAC/D,IAAA,uIAAa,EAAC,SAAS,OAAO,aAAa;QAC7C;IACF;AACF;AAGO,MAAM,SAAS,IAAI"}},
    {"offset": {"line": 449, "column": 0}, "map": {"version":3,"sources":["file:///Users/mukurusystemsadministrator/Desktop/onboarding_kyc%20copy/admin/src/lib/redis-session.ts"],"sourcesContent":["import { createClient } from 'redis';\nimport { reportError } from './sentry';\nimport { logger } from './logger';\n\n// Redis client singleton\nlet redisClient: ReturnType<typeof createClient> | null = null;\n\nexport async function getRedisClient() {\n  if (redisClient && redisClient.isOpen) {\n    return redisClient;\n  }\n\n  const redisUrl = process.env.REDIS_URL || 'redis://localhost:6379';\n  redisClient = createClient({ url: redisUrl });\n\n  redisClient.on('error', (err) => {\n    reportError(err, {\n      tags: { error_type: 'redis_connection', operation: 'redis_client_error' },\n      level: 'error',\n    });\n  });\n  redisClient.on('connect', () => {\n    // Only log in development\n    if (process.env.NODE_ENV === 'development') {\n      console.log('Redis Client Connected');\n    }\n  });\n\n  if (!redisClient.isOpen) {\n    await redisClient.connect();\n  }\n\n  return redisClient;\n}\n\nexport interface TokenSession {\n  accessToken: string;\n  refreshToken: string;\n  accessTokenExpiryTime: number;\n  provider: 'azure-ad' | 'keycloak';\n  userEmail?: string;\n  userId?: string;\n}\n\nconst SESSION_PREFIX = 'session:';\nconst TTL_SECONDS = 7 * 24 * 60 * 60; // 7 days\n\n/**\n * Store IdP tokens in Redis, keyed by session ID\n */\nexport async function storeTokenSession(\n  sessionId: string,\n  tokens: TokenSession\n): Promise<void> {\n  const client = await getRedisClient();\n  const key = `${SESSION_PREFIX}${sessionId}`;\n  await client.setEx(key, TTL_SECONDS, JSON.stringify(tokens));\n}\n\n/**\n * Retrieve IdP tokens from Redis by session ID\n */\nexport async function getTokenSession(\n  sessionId: string\n): Promise<TokenSession | null> {\n  const client = await getRedisClient();\n  const key = `${SESSION_PREFIX}${sessionId}`;\n  const data = await client.get(key);\n  if (!data) return null;\n  return JSON.parse(data) as TokenSession;\n}\n\n/**\n * Delete token session from Redis\n */\nexport async function deleteTokenSession(sessionId: string): Promise<void> {\n  const client = await getRedisClient();\n  const key = `${SESSION_PREFIX}${sessionId}`;\n  await client.del(key);\n}\n\n/**\n * Update access token (for refresh scenarios)\n */\nexport async function updateAccessToken(\n  sessionId: string,\n  accessToken: string,\n  accessTokenExpiryTime: number\n): Promise<void> {\n  const session = await getTokenSession(sessionId);\n  if (!session) {\n    throw new Error('Session not found');\n  }\n  await storeTokenSession(sessionId, {\n    ...session,\n    accessToken,\n    accessTokenExpiryTime,\n  });\n}\n\n/**\n * Get account tokens from NextAuth Account format\n * Maps NextAuth Account to TokenSession format for compatibility\n */\nexport async function getAccountTokensFromNextAuth(\n  userId: string,\n  provider: string = 'azure-ad'\n): Promise<TokenSession | null> {\n  const client = await getRedisClient();\n  const accountKey = `nextauth:account:user:${userId}:${provider}`;\n  const accountRefKey = await client.get(accountKey);\n  if (!accountRefKey) return null;\n\n  const accountData = await client.get(accountRefKey);\n  if (!accountData) return null;\n\n  const account = JSON.parse(accountData) as {\n    access_token?: string;\n    refresh_token?: string;\n    expires_at?: number;\n    provider: string;\n    providerAccountId: string;\n  };\n\n  if (!account.access_token) return null;\n\n  return {\n    accessToken: account.access_token,\n    refreshToken: account.refresh_token || '',\n    accessTokenExpiryTime: account.expires_at ? account.expires_at * 1000 : Date.now() + 3600 * 1000,\n    provider: account.provider as 'azure-ad' | 'keycloak',\n    userId,\n  };\n}\n\n/**\n * Update NextAuth Account tokens (for refresh scenarios)\n */\nexport async function updateNextAuthAccountTokens(\n  userId: string,\n  provider: string,\n  accessToken: string,\n  refreshToken: string,\n  expiresAt: number\n): Promise<void> {\n  const client = await getRedisClient();\n  const accountKey = `nextauth:account:user:${userId}:${provider}`;\n  const accountRefKey = await client.get(accountKey);\n  if (!accountRefKey) {\n    throw new Error(`Account not found for user ${userId} and provider ${provider}`);\n  }\n\n  const accountData = await client.get(accountRefKey);\n  if (!accountData) {\n    throw new Error(`Account data not found for user ${userId} and provider ${provider}`);\n  }\n\n  const account = JSON.parse(accountData) as {\n    access_token?: string;\n    refresh_token?: string;\n    expires_at?: number;\n    [key: string]: any;\n  };\n\n  const updatedAccount = {\n    ...account,\n    access_token: accessToken,\n    refresh_token: refreshToken,\n    expires_at: Math.floor(expiresAt / 1000), // Convert to seconds\n  };\n\n  await client.setEx(accountRefKey, 30 * 24 * 60 * 60, JSON.stringify(updatedAccount));\n  logger.debug('[RedisSession] Updated NextAuth account tokens', { userId, provider });\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 576, "column": 0}, "map": {"version":3,"sources":["file:///Users/mukurusystemsadministrator/Desktop/onboarding_kyc%20copy/admin/src/lib/redis-adapter.ts"],"sourcesContent":["/**\n * Custom Redis Adapter for NextAuth v5\n * Implements NextAuth's Adapter interface to store sessions, accounts, and users in Redis\n * This enables database strategy with opaque session tokens instead of JWTs\n */\n\nimport type { Adapter, AdapterUser, AdapterSession, AdapterAccount, VerificationToken } from 'next-auth/adapters';\nimport { getRedisClient } from './redis-session';\nimport { logger } from './logger';\n\n// Redis key prefixes\nconst SESSION_PREFIX = 'nextauth:session:';\nconst ACCOUNT_PREFIX = 'nextauth:account:';\nconst USER_PREFIX = 'nextauth:user:';\nconst VERIFICATION_TOKEN_PREFIX = 'nextauth:verification-token:';\n\n// TTLs (in seconds)\nconst SESSION_TTL = 30 * 24 * 60 * 60; // 30 days\nconst ACCOUNT_TTL = 30 * 24 * 60 * 60; // 30 days\nconst USER_TTL = 30 * 24 * 60 * 60; // 30 days\nconst VERIFICATION_TOKEN_TTL = 24 * 60 * 60; // 24 hours\n\n/**\n * Redis Adapter for NextAuth\n * Stores sessions, accounts, and users in Redis with proper TTLs\n */\nexport function RedisAdapter(): Adapter {\n  return {\n    // User operations\n    async createUser(user: Omit<AdapterUser, 'id'>): Promise<AdapterUser> {\n      const client = await getRedisClient();\n      const userId = `user-${Date.now()}-${Math.random().toString(36).substring(7)}`;\n      const adapterUser: AdapterUser = {\n        ...user,\n        id: userId,\n        emailVerified: user.emailVerified || null,\n      };\n\n      const key = `${USER_PREFIX}${userId}`;\n      await client.setEx(key, USER_TTL, JSON.stringify(adapterUser));\n\n      // Also index by email for getUserByEmail\n      if (user.email) {\n        const emailKey = `${USER_PREFIX}email:${user.email}`;\n        await client.setEx(emailKey, USER_TTL, userId);\n      }\n\n      logger.debug('[RedisAdapter] Created user', { userId, email: user.email });\n      return adapterUser;\n    },\n\n    async getUser(id: string): Promise<AdapterUser | null> {\n      const client = await getRedisClient();\n      const key = `${USER_PREFIX}${id}`;\n      const data = await client.get(key);\n      if (!data) return null;\n      return JSON.parse(data) as AdapterUser;\n    },\n\n    async getUserByEmail(email: string): Promise<AdapterUser | null> {\n      const client = await getRedisClient();\n      const emailKey = `${USER_PREFIX}email:${email}`;\n      const userId = await client.get(emailKey);\n      if (!userId) return null;\n      return this.getUser(userId);\n    },\n\n    async getUserByAccount({ providerAccountId, provider }: { providerAccountId: string; provider: string }): Promise<AdapterUser | null> {\n      const client = await getRedisClient();\n      const accountKey = `${ACCOUNT_PREFIX}${provider}:${providerAccountId}`;\n      const accountData = await client.get(accountKey);\n      if (!accountData) return null;\n      const account = JSON.parse(accountData) as AdapterAccount;\n      return this.getUser(account.userId);\n    },\n\n    async updateUser(user: Partial<AdapterUser> & Pick<AdapterUser, 'id'>): Promise<AdapterUser> {\n      const client = await getRedisClient();\n      const existing = await this.getUser(user.id);\n      if (!existing) {\n        throw new Error(`User ${user.id} not found`);\n      }\n\n      const updated: AdapterUser = { ...existing, ...user };\n      const key = `${USER_PREFIX}${user.id}`;\n      await client.setEx(key, USER_TTL, JSON.stringify(updated));\n\n      // Update email index if email changed\n      if (user.email && user.email !== existing.email) {\n        // Remove old email index\n        if (existing.email) {\n          const oldEmailKey = `${USER_PREFIX}email:${existing.email}`;\n          await client.del(oldEmailKey);\n        }\n        // Add new email index\n        const newEmailKey = `${USER_PREFIX}email:${user.email}`;\n        await client.setEx(newEmailKey, USER_TTL, user.id);\n      }\n\n      logger.debug('[RedisAdapter] Updated user', { userId: user.id });\n      return updated;\n    },\n\n    async deleteUser(userId: string): Promise<void> {\n      const client = await getRedisClient();\n      const user = await this.getUser(userId);\n      if (user) {\n        // Delete email index\n        if (user.email) {\n          const emailKey = `${USER_PREFIX}email:${user.email}`;\n          await client.del(emailKey);\n        }\n        // Delete user\n        const key = `${USER_PREFIX}${userId}`;\n        await client.del(key);\n        logger.debug('[RedisAdapter] Deleted user', { userId });\n      }\n    },\n\n    // Session operations\n    async createSession(session: Omit<AdapterSession, 'expires'> & { expires: Date }): Promise<AdapterSession> {\n      const client = await getRedisClient();\n      const key = `${SESSION_PREFIX}${session.sessionToken}`;\n      const sessionData = {\n        ...session,\n        expires: session.expires.toISOString(),\n      };\n      await client.setEx(key, SESSION_TTL, JSON.stringify(sessionData));\n      logger.debug('[RedisAdapter] Created session', { sessionToken: session.sessionToken, userId: session.userId });\n      return session;\n    },\n\n    async getSessionAndUser(sessionToken: string): Promise<{ session: AdapterSession; user: AdapterUser } | null> {\n      const client = await getRedisClient();\n      const key = `${SESSION_PREFIX}${sessionToken}`;\n      const sessionData = await client.get(key);\n      if (!sessionData) return null;\n\n      const session = JSON.parse(sessionData) as { expires: string; [key: string]: any };\n      const adapterSession: AdapterSession = {\n        ...session,\n        expires: new Date(session.expires),\n      };\n\n      const user = await this.getUser(adapterSession.userId);\n      if (!user) return null;\n\n      return { session: adapterSession, user };\n    },\n\n    async updateSession(session: Partial<AdapterSession> & Pick<AdapterSession, 'sessionToken'>): Promise<AdapterSession | null> {\n      const client = await getRedisClient();\n      const key = `${SESSION_PREFIX}${session.sessionToken}`;\n      const existing = await client.get(key);\n      if (!existing) return null;\n\n      const existingSession = JSON.parse(existing) as { expires: string; [key: string]: any };\n      const updated: AdapterSession = {\n        ...existingSession,\n        ...session,\n        expires: session.expires || new Date(existingSession.expires),\n      };\n\n      await client.setEx(key, SESSION_TTL, JSON.stringify({\n        ...updated,\n        expires: updated.expires.toISOString(),\n      }));\n\n      logger.debug('[RedisAdapter] Updated session', { sessionToken: session.sessionToken });\n      return updated;\n    },\n\n    async deleteSession(sessionToken: string): Promise<void> {\n      const client = await getRedisClient();\n      const key = `${SESSION_PREFIX}${sessionToken}`;\n      await client.del(key);\n      logger.debug('[RedisAdapter] Deleted session', { sessionToken });\n    },\n\n    // Account operations\n    async linkAccount(account: AdapterAccount): Promise<void> {\n      const client = await getRedisClient();\n      const accountKey = `${ACCOUNT_PREFIX}${account.provider}:${account.providerAccountId}`;\n      await client.setEx(accountKey, ACCOUNT_TTL, JSON.stringify(account));\n\n      // Also store by userId for account lookup\n      const userAccountKey = `${ACCOUNT_PREFIX}user:${account.userId}:${account.provider}`;\n      await client.setEx(userAccountKey, ACCOUNT_TTL, accountKey);\n\n      logger.debug('[RedisAdapter] Linked account', {\n        userId: account.userId,\n        provider: account.provider,\n        providerAccountId: account.providerAccountId,\n      });\n    },\n\n    async unlinkAccount({ providerAccountId, provider }: { providerAccountId: string; provider: string }): Promise<void> {\n      const client = await getRedisClient();\n      const accountKey = `${ACCOUNT_PREFIX}${provider}:${providerAccountId}`;\n      const accountData = await client.get(accountKey);\n      if (accountData) {\n        const account = JSON.parse(accountData) as AdapterAccount;\n        const userAccountKey = `${ACCOUNT_PREFIX}user:${account.userId}:${provider}`;\n        await client.del(userAccountKey);\n      }\n      await client.del(accountKey);\n      logger.debug('[RedisAdapter] Unlinked account', { provider, providerAccountId });\n    },\n\n    // Verification token operations (for email verification, password reset, etc.)\n    async createVerificationToken(verificationToken: VerificationToken): Promise<VerificationToken> {\n      const client = await getRedisClient();\n      const key = `${VERIFICATION_TOKEN_PREFIX}${verificationToken.identifier}:${verificationToken.token}`;\n      await client.setEx(key, VERIFICATION_TOKEN_TTL, JSON.stringify(verificationToken));\n      logger.debug('[RedisAdapter] Created verification token', { identifier: verificationToken.identifier });\n      return verificationToken;\n    },\n\n    async useVerificationToken({ identifier, token }: { identifier: string; token: string }): Promise<VerificationToken | null> {\n      const client = await getRedisClient();\n      const key = `${VERIFICATION_TOKEN_PREFIX}${identifier}:${token}`;\n      const data = await client.get(key);\n      if (!data) return null;\n      await client.del(key); // Delete after use (one-time token)\n      logger.debug('[RedisAdapter] Used verification token', { identifier });\n      return JSON.parse(data) as VerificationToken;\n    },\n  };\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 805, "column": 0}, "map": {"version":3,"sources":["file:///Users/mukurusystemsadministrator/Desktop/onboarding_kyc%20copy/admin/src/lib/auth.ts"],"sourcesContent":["// @ts-expect-error - NextAuth v5 beta compatibility - types not fully available yet\nimport type { NextAuthOptions } from 'next-auth';\nimport NextAuth from 'next-auth';\nimport AzureADProvider from 'next-auth/providers/azure-ad';\nimport { RedisAdapter } from './redis-adapter';\nimport { updateNextAuthAccountTokens, getAccountTokensFromNextAuth } from './redis-session';\nimport { reportError } from './sentry';\nimport { logger } from './logger';\n\n// Helper function to refresh tokens for NextAuth Account\nconst refreshAccessTokenForAccount = async (userId: string, provider: string = 'azure-ad') => {\n  try {\n    // Get account tokens from NextAuth Account storage\n    const accountTokens = await getAccountTokensFromNextAuth(userId, provider);\n    if (!accountTokens || !accountTokens.refreshToken) {\n      throw new Error('No refresh token available');\n    }\n\n    const issuer = process.env.NEXT_PUBLIC_AZURE_AD_ISSUER || `https://login.microsoftonline.com/${process.env.AZURE_AD_TENANT_ID}/v2.0`;\n    \n    const response = await fetch(`${issuer}/oauth2/v2.0/token`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: new URLSearchParams({\n        client_id: process.env.AZURE_AD_CLIENT_ID!,\n        grant_type: 'refresh_token',\n        refresh_token: accountTokens.refreshToken,\n        client_secret: process.env.AZURE_AD_CLIENT_SECRET!,\n      }),\n    });\n\n    const refreshedTokens = await response.json();\n\n    if (!response.ok) {\n      throw refreshedTokens;\n    }\n\n    const newAccessToken = refreshedTokens.access_token;\n    const newRefreshToken = refreshedTokens.refresh_token ?? accountTokens.refreshToken;\n    const newExpiryTime = Date.now() + refreshedTokens.expires_in * 1000;\n\n    // Update NextAuth Account in Redis\n    await updateNextAuthAccountTokens(\n      userId,\n      provider,\n      newAccessToken,\n      newRefreshToken,\n      newExpiryTime\n    );\n\n    return {\n      accessToken: newAccessToken,\n      refreshToken: newRefreshToken,\n      expiresAt: Math.floor(newExpiryTime / 1000), // Convert to seconds\n    };\n  } catch (error) {\n    reportError(error, {\n      tags: { error_type: 'token_refresh', operation: 'refresh_access_token' },\n      extra: { userId, provider },\n      level: 'error',\n    });\n    throw error;\n  }\n};\n\n// Validate required environment variables\nconst requiredEnvVars = {\n  AZURE_AD_CLIENT_ID: process.env.AZURE_AD_CLIENT_ID,\n  AZURE_AD_CLIENT_SECRET: process.env.AZURE_AD_CLIENT_SECRET,\n  AZURE_AD_TENANT_ID: process.env.AZURE_AD_TENANT_ID,\n  NEXTAUTH_URL: process.env.NEXTAUTH_URL,\n  NEXTAUTH_SECRET: process.env.NEXTAUTH_SECRET,\n};\n\nconst missingVars = Object.entries(requiredEnvVars)\n  .filter(([_, value]) => !value)\n  .map(([key]) => key);\n\nif (missingVars.length > 0) {\n  // eslint-disable-next-line no-console\n  console.error('[NextAuth] Missing required environment variables:', missingVars);\n}\n\n// Log Azure AD configuration for debugging\nif (process.env.NODE_ENV === 'development') {\n  const issuer = process.env.NEXT_PUBLIC_AZURE_AD_ISSUER || `https://login.microsoftonline.com/${process.env.AZURE_AD_TENANT_ID}/v2.0`;\n  // eslint-disable-next-line no-console\n  console.log('[NextAuth Config] Azure AD Configuration:', {\n    clientId: process.env.AZURE_AD_CLIENT_ID,\n    tenantId: process.env.AZURE_AD_TENANT_ID,\n    issuer,\n    nextAuthUrl: process.env.NEXTAUTH_URL,\n    expectedCallbackUrl: `${process.env.NEXTAUTH_URL}/api/auth/callback/azure-ad`,\n    hasClientSecret: !!process.env.AZURE_AD_CLIENT_SECRET,\n  });\n}\n\nexport const authOptions: NextAuthOptions = {\n  debug: process.env.NODE_ENV === 'development', // Enable debug logging in development\n  adapter: RedisAdapter(), // Use Redis adapter for database strategy\n  providers: [\n    AzureADProvider({\n      clientId: process.env.AZURE_AD_CLIENT_ID!,\n      clientSecret: process.env.AZURE_AD_CLIENT_SECRET!,\n      // @ts-expect-error - tenantId is valid but not in types for v5 beta - will be fixed in stable release\n      tenantId: process.env.AZURE_AD_TENANT_ID!,\n      // Explicitly set issuer to ensure correct URL construction\n      issuer: process.env.NEXT_PUBLIC_AZURE_AD_ISSUER || `https://login.microsoftonline.com/${process.env.AZURE_AD_TENANT_ID}/v2.0`,\n      authorization: {\n        params: {\n          // Using only the absolute minimum permissions that don't require admin consent:\n          // - openid: Sign users in (Delegated, no admin consent)\n          // - email: View users' email address (Delegated, no admin consent)\n          // Note: Removed 'profile' and 'offline_access' as they may require admin consent\n          // depending on Azure AD app registration settings\n          scope: 'openid email',\n        },\n      },\n      profile(profile: any) {\n        return {\n          id: profile.sub || profile.oid || profile.id,\n          name: profile.name || profile.displayName || (profile.given_name && profile.family_name ? `${profile.given_name} ${profile.family_name}` : null) || profile.preferred_username || profile.email,\n          email: profile.email || profile.preferred_username || profile.upn,\n          image: profile.picture || undefined,\n        };\n      },\n    }),\n  ],\n  callbacks: {\n    // With database strategy, NextAuth handles account linking automatically via adapter\n    // We only need to handle user registration and session data\n    async signIn({ user, account, profile }: any) {\n      try {\n        // Log sign-in for debugging\n        if (process.env.NODE_ENV === 'development') {\n          logger.debug('[NextAuth] Sign in event', {\n            userId: user?.id,\n            userEmail: user?.email,\n            provider: account?.provider,\n            hasAccessToken: !!account?.access_token,\n          });\n        }\n\n        // Automatically save user email to backend (fire and forget)\n        // NextAuth adapter automatically stores account tokens via linkAccount\n        if (user?.email && account?.access_token) {\n          try {\n            const entityConfigApiBaseUrl = process.env.NEXT_PUBLIC_ENTITY_CONFIG_API_BASE_URL || 'http://localhost:8003';\n            await fetch(`${entityConfigApiBaseUrl}/api/v1/users`, {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${account.access_token}`,\n                'X-User-Email': user.email,\n              },\n              body: JSON.stringify({\n                email: user.email,\n                name: user.name || null,\n              }),\n            }).catch(err => {\n              // Silently fail - don't block login if user creation fails\n              reportError(err, {\n                tags: { error_type: 'user_registration', operation: 'register_user_on_login' },\n                extra: { userEmail: user.email },\n                level: 'warning',\n              });\n            });\n          } catch (err) {\n            // Silently fail - don't block login if user creation fails\n            reportError(err, {\n              tags: { error_type: 'user_registration', operation: 'register_user_on_login' },\n              extra: { userEmail: user.email },\n              level: 'warning',\n            });\n          }\n        }\n\n        return true;\n      } catch (error: any) {\n        logger.error(error, '[NextAuth] Sign in callback error', {\n          tags: { error_type: 'signin_callback' },\n          extra: { stack: error?.stack }\n        });\n        // Allow sign-in to proceed even if callbacks fail\n        return true;\n      }\n    },\n    async session({ session, user }: any) {\n      try {\n        // With database strategy, user is provided directly from adapter\n        // No need to extract from token - NextAuth handles this\n        if (user) {\n          session.user = {\n            id: user.id || undefined,\n            name: user.name || undefined,\n            email: user.email || undefined,\n            image: user.image || undefined,\n          };\n        }\n\n        // Log session for debugging\n        if (process.env.NODE_ENV === 'development') {\n          logger.debug('[NextAuth] Session callback', {\n            hasUser: !!session.user,\n            userName: session.user?.name,\n            userEmail: session.user?.email,\n          });\n        }\n\n        // Update user last login (fire and forget) - use proxy endpoint instead\n        if (session.user?.email) {\n          try {\n            // This will go through proxy which will inject token from NextAuth Account\n            fetch('/api/proxy/api/v1/users', {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n                'X-User-Email': session.user.email,\n              },\n              body: JSON.stringify({\n                email: session.user.email,\n                name: session.user.name || null,\n              }),\n            }).catch(err => {\n              // Silently fail - don't block session if update fails\n              reportError(err, {\n                tags: { error_type: 'user_update', operation: 'update_user_last_login' },\n                extra: { userEmail: session.user?.email },\n                level: 'warning',\n              });\n            });\n          } catch (err) {\n            // Silently fail - don't block session if update fails\n            reportError(err, {\n              tags: { error_type: 'user_update', operation: 'update_user_last_login' },\n              extra: { userEmail: session.user?.email },\n              level: 'warning',\n            });\n          }\n        }\n\n        return session;\n      } catch (error: any) {\n        logger.error(error, '[NextAuth] Session callback error', {\n          tags: { error_type: 'session_callback' },\n          extra: { stack: error?.stack }\n        });\n        reportError(error, {\n          tags: { error_type: 'session_callback', operation: 'session_callback' },\n          extra: { \n            hasUser: !!user,\n            userId: user?.id,\n          },\n          level: 'error',\n        });\n        // Return session anyway to prevent complete failure\n        return session;\n      }\n    },\n    async redirect({ url, baseUrl }: any) {\n      // Handle redirect after successful authentication\n      logger.debug('NextAuth redirect callback', { url, baseUrl });\n      \n      // If url is the sign-in page, redirect to dashboard instead\n      if (url === `${baseUrl}/` || url === baseUrl || url === '/') {\n        logger.debug('Redirecting from sign-in page to dashboard');\n        return `${baseUrl}/dashboard`;\n      }\n      \n      // If url is a relative path, prepend baseUrl\n      if (url.startsWith('/')) {\n        return `${baseUrl}${url}`;\n      }\n      \n      // If url is on the same origin, allow it\n      try {\n      if (new URL(url).origin === baseUrl) {\n        return url;\n        }\n      } catch (e) {\n        // URL parsing failed, fall through to default\n      }\n      \n      // Default to dashboard\n      return `${baseUrl}/dashboard`;\n    },\n  },\n  pages: {\n    signIn: '/',\n    error: '/', // Redirect errors back to sign-in page\n  },\n  events: {\n    async signIn({ user, account, profile }: any) {\n      if (process.env.NODE_ENV === 'development') {\n        logger.debug('[NextAuth] Sign in event', {\n          userId: user?.id,\n          userEmail: user?.email,\n          provider: account?.provider,\n        });\n      }\n      return true;\n    },\n    async signOut({ session, token }: any) {\n      if (process.env.NODE_ENV === 'development') {\n        logger.debug('[NextAuth] Sign out event');\n      }\n    },\n    async error({ error, message }: any) {\n      logger.error(error || new Error(message), '[NextAuth] Error event', {\n        tags: { error_type: 'nextauth_error_event' },\n        extra: {\n          message,\n          errorType: error?.type,\n          errorStack: error?.stack,\n        }\n      });\n      reportError(error || new Error(message), {\n        tags: { error_type: 'nextauth_error', operation: 'nextauth_error_event' },\n        extra: { message, errorType: error?.type },\n        level: 'error',\n      });\n    },\n  },\n  session: {\n    strategy: 'database', // Use database strategy with Redis adapter\n    maxAge: 30 * 24 * 60 * 60, // 30 days\n  },\n  // Ensure proper base URL for callbacks\n  trustHost: true, // Trust the host header (useful for development)\n};\n\n// Export auth function for NextAuth v5 beta\n// This replaces getServerSession from v4\nexport const { auth } = NextAuth(authOptions);\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1172, "column": 0}, "map": {"version":3,"sources":["file:///Users/mukurusystemsadministrator/Desktop/onboarding_kyc%20copy/admin/src/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import NextAuth from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { NextRequest, NextResponse } from 'next/server';\nimport { logger } from '@/lib/logger';\n\n// NextAuth v5 beta - handler returns route handlers\nconst { handlers } = NextAuth(authOptions);\n\n// Wrap handlers with error logging\nconst GET = async (req: NextRequest) => {\n  try {\n    return await handlers.GET(req);\n  } catch (error: any) {\n    logger.error(error, '[NextAuth] GET handler error', {\n      tags: { error_type: 'nextauth_handler_error' },\n      extra: {\n        url: req.url,\n      }\n    });\n    // Re-throw to let NextAuth handle the error response\n    throw error;\n  }\n};\n\nconst POST = async (req: NextRequest) => {\n  try {\n    return await handlers.POST(req);\n  } catch (error: any) {\n    logger.error(error, '[NextAuth] POST handler error', {\n      tags: { error_type: 'nextauth_handler_error' },\n      extra: {\n        url: req.url,\n      }\n    });\n    // Re-throw to let NextAuth handle the error response\n    throw error;\n  }\n};\n\nexport { GET, POST };\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAEA;;;;AAEA,oDAAoD;AACpD,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,kKAAQ,EAAC,mIAAW;AAEzC,mCAAmC;AACnC,MAAM,MAAM,OAAO;IACjB,IAAI;QACF,OAAO,MAAM,SAAS,GAAG,CAAC;IAC5B,EAAE,OAAO,OAAY;QACnB,gIAAM,CAAC,KAAK,CAAC,OAAO,gCAAgC;YAClD,MAAM;gBAAE,YAAY;YAAyB;YAC7C,OAAO;gBACL,KAAK,IAAI,GAAG;YACd;QACF;QACA,qDAAqD;QACrD,MAAM;IACR;AACF;AAEA,MAAM,OAAO,OAAO;IAClB,IAAI;QACF,OAAO,MAAM,SAAS,IAAI,CAAC;IAC7B,EAAE,OAAO,OAAY;QACnB,gIAAM,CAAC,KAAK,CAAC,OAAO,iCAAiC;YACnD,MAAM;gBAAE,YAAY;YAAyB;YAC7C,OAAO;gBACL,KAAK,IAAI,GAAG;YACd;QACF;QACA,qDAAqD;QACrD,MAAM;IACR;AACF"}}]
}